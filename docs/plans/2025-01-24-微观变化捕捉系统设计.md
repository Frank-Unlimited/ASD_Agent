# ���观变化捕捉系统设计文档

**模块名称**：微观变化捕捉系统（Micro-Observation Capture System）
**文档日期**：2025-01-24
**文档版本**：v1.0
**所属项目**：ASD儿童地板时光家庭干预辅助系统

---

## 目录

1. [问题背景](#1-问题背景)
2. [核心设计理念](#2-核心设计理念)
3. [功能设计](#3-功能设计)
4. [技术实现](#4-技术实现)
5. [工作流集成](#5-工作流集成)
6. [用户界面设计](#6-用户界面设计)

---

## 1. 问题背景

### 1.1 核心痛点

在地板时光干预实施过程中，家长面临的首要难题是：**不知道孩子对什么感兴趣**。

具体表现：
- 孩子对常规玩具"没反应"，家长不知道从哪里开始
- 孩子的兴趣表现隐蔽、重复、感官导向（盯着风扇、转车轮、摸材质）
- 家长能观察到孩子的行为，但**不知道如何描述**
- 家长记录了很多零散片段，但**看不到规律和趋势**
- 家长观察到变化，但**不知道这是进步还是需要关注**

### 1.2 系统定位

本模块的核心定位是：**在家长已经与孩子建立情感联结的基础上，作为敏锐的记录者和专业分析师**。

**AI的角色边界**：
- ✅ **记录**：把家长的口语化描述转化为专业记录
- ✅ **分析**：用专业知识识别肉眼看不到的规律
- ✅ **提醒**：提示家长可能遗漏的观察维度
- ❌ **不替代**：不替代家长的观察和情感联结
- ❌ **不主导**：不主动"诊断"或"下结论"

---

## 2. 核心设计理念

### 2.1 价值链

```
家长建立情感联结（核心，人做的）
    ↓
家长在互动中观察孩子（人做的，但需要引导）
    ↓
系统记录+专业分析（AI做的，辅助价值）
    ↓
让家长看到他们肉眼看不到的规律和进步（AI的价值）
```

### 2.2 核心价值主张

1. **轻松记录**：从"说不清楚"到"精准描述"
2. **看到规律**：从零散片段到成长轨迹
3. **理解意义**：从模糊感觉到专业判断
4. **知道行动**：从观察记录到干预建议

---

## 3. 功能设计

### 3.1 三种记录方式

#### 方式1：语音记录（最推荐）

**适用场景**：游戏刚结束、日常生活瞬间

**交互流程**：
```
家长：点击"记录观察" → 说出观察 → AI自动转化

家长说：
"今天玩积木的时候，辰辰突然抬头看了我一眼，大概有2秒钟"

AI生成结构化记录：
{
  timestamp: "2024-01-24 14:32",
  context: "积木游戏中",
  behavior: "主动眼神接触",
  duration: "约2秒",
  significance: "首次主动发起",
  tags: ["眼神接触", "主动互动", "突破"],
  suggestedFollowUp: "下次游戏可以观察是否会在其他活动中也主动看家长"
}
```

**AI的核心价值**：
- 从口语化描述中提取关键要素（时间、场景、行为、意义）
- 补充家长没提到的专业维度
- 自动关联历史记录，识别是否为首次出现

#### 方式2：智能引导式记录

**适用场景**：家长观察到变化，但不知道怎么说

**交互流程**：
```
系统：今天有什么想记录的吗？
家长：感觉孩子今天有点不一样
系统：能回忆一下是在什么场景下吗？
家长：洗澡的时候
系统：孩子在洗澡时有什么具体表现？
[展示选项，家长多选]
☐ 主动碰水/玩水
☐ 看着家长
☐ 发出声音
☐ 情绪变化（哭/笑）
系统：你注意到的是"主动碰水+看着家长"，对吗？
家长：对！
系统：好的，让我记录一下...
```

**AI的核心价值**：
- 通过追问帮家长理清思路
- 提供专业选项，降低描述门槛
- 验证理解是否准确

#### 方式3：快捷标记（零门槛）

**适用场景**：忙碌时、游戏过程中

**设计**：
```
游戏界面底部常驻4-6个快捷按钮：
[😊 微笑] [👀 眼神] [🗣️ 出声] [🤝 互动] [😢 情绪]
```

家长点击 → AI自动记录时间戳和上下文
```
家长点击[👀 眼神] →
AI记录：14:35 出现眼神接触（游戏进行到第8分钟）
```

### 3.2 三种分析能力

#### 分析1：首次出现检测（里程碑识别）

**场景**：家长每天记录，但不知道哪些是"突破"

**AI分析**：
```javascript
// 输入：30天的观察记录
[
  {date: "01-01", behavior: "被动眼神接触", ...},
  {date: "01-15", behavior: "被动眼神接触", ...},
  {date: "01-23", behavior: "主动眼神接触", ...}  // AI识别这是里程碑！
]

// AI输出：
{
  milestoneDetected: {
    behavior: "主动眼神接触",
    firstOccurrence: "2024-01-23",
    significance: "breakthrough",
    context: "积木游戏中，递积木时看向家长",
    comparison: "此前30天只有被动眼神接触",
    celebrationMessage: "🌟 这是孩子的第一次主动眼神接触！这是情感联结的重要突破"
  }
}
```

**呈现给家长**：
```
┌─────────────────────────────────┐
│ 🎉 今天有个重要发现！           │
├─────────────────────────────────┤
│ 辰辰第一次主动和你眼神接触了！   │
│                                 │
│ 这是我们记录的第15次游戏，      │
│ 此前他都是被动看你，            │
│ 今天他主动看向你——              │
│ 这是情感联结的重要突破！🌟      │
│                                 │
│ [查看历史记录] [分享给医生]     │
└─────────────────────────────────┘
```

#### 分析2：频率与趋势分析

**场景**：家长觉得"孩子好像没什么变化"

**AI分析**：
```javascript
// AI对比时间序列数据
{
  metric: "主动微笑",
  timeline: [
    {week1: 平均0.5次/游戏},
    {week2: 平均1.2次/游戏},
    {week3: 平均2.1次/游戏},
    {week4: 平均3.5次/游戏}
  ],
  trend: "improving",
  growthRate: "+140% over 4 weeks",
  insight: "微笑频率每周稳定增长，孩子的情绪表达能力正在快速提升"
}
```

**呈现给家长**：
```
┌─────────────────────────────────┐
│ 📈 孩子正在进步！                │
├─────────────────────────────────┤
│ 主动微笑                        │
│ Week 1  ▓░░░░  0.5次/游戏       │
│ Week 2  ▓▓░░░  1.2次/游戏       │
│ Week 3  ▓▓▓▓░  2.1次/游戏       │
│ Week 4  ▓▓▓▓▓  3.5次/游戏       │
│                                 │
│ 🌟 4周内增长了140%！            │
│ 孩子的情绪表达能力正在提升      │
│                                 │
│ [查看详细数据]                  │
└─────────────────────────────────┘
```

#### 分析3：关联分析（识别因果）

**场景**：家长不知道某种行为为什么出现/消失

**AI分析**：
```javascript
// AI发现规律
{
  correlation: {
    when: ["游戏时间<15分钟", "上午时段"],
    then: "孩子更容易出现主动互动",
    confidence: 0.82,
    insight: "孩子在上午精力充沛时，且游戏时长不超过15分钟时，互动意愿更强",
    suggestion: "可以尝试将重点游戏安排在上午，控制在15分钟内"
  }
}
```

**呈现给家长**：
```
┌─────────────────────────────────┐
│ 💡 发现了一个规律！              │
├─────────────────────────────────┤
│ 当游戏在上午进行，且不超过15分钟 │
│ 时，辰辰的主动互动会增加60%      │
│                                 │
│ 建议：                          │
│ • 把重点游戏安排在上午          │
│ • 单次游戏控制在15分钟内        │
│                                 │
│ [采纳建议] [继续观察]           │
└─────────────────────────────────┘
```

### 3.3 行动建议闭环

#### 场景1：发现进步 → 保持动能

**触发条件**：AI检测到某个维度有显著改善

**系统建议**：
```javascript
{
  observation: {
    metric: "主动眼神接触",
    trend: "快速提升",
    data: "从0次/游戏 → 3.5次/游戏（4周）"
  },
  recommendation: {
    action: "maintain_momentum",
    reasoning: "主动眼神接触正在快速发展，应该保持当前干预方式，巩固这一进步",
    specificActions: [
      "继续使用积木传递类游戏（这是引发眼神接触的核心游戏）",
      "每次眼神接触时给予积极回应（微笑、语言鼓励）",
      "下周可尝试在其他活动中也引导眼神接触"
    ],
    watchFor: "如果连续2周没有新突破，再调整策略"
  }
}
```

**呈现给家长**：
```
┌─────────────────────────────────┐
│ 🎯 下一步建议                    │
├─────────────────────────────────┤
│ 眼神接触正在快速进步！继续保持   │
│                                 │
│ 本周安排：                      │
│ ✅ 继续积木传递游戏（3次/周）   │
│ ✅ 每次眼神接触时微笑回应        │
│ ✅ 尝试在游戏中增加等待时间      │
│    （给孩子主动发起的机会）      │
│                                 │
│ 预期目标：                      │
│ 主动眼神接触达到5次/游戏        │
│                                 │
│ [采纳建议] [自定义计划]          │
└─────────────────────────────────┘
```

#### 场景2：发现平台期 → 调整策略

**触发条件**：某个维度连续3周无明显变化

**系统建议**：
```javascript
{
  observation: {
    metric: "双向沟通",
    trend: "stable",
    data: "1.2次/游戏，持续3周无明显变化"
  },
  recommendation: {
    action: "change_strategy",
    reasoning: "当前游戏类型对双向沟通的刺激不足，需要更换游戏方式",
    alternativeGames: [
      {
        name: "躲猫猫游戏",
        reason: "利用孩子对'消失-出现'的兴趣，引导他发出声音或动作来寻找你",
        priority: "high",
        howToPlay: "用手遮脸突然移开，说'找到你了！'，观察孩子是否模仿或期待"
      },
      {
        name: "传递物品游戏",
        reason: "通过'递过来-还给我'的循环，建立双向沟通的基础模式",
        priority: "medium",
        howToPlay: "递给孩子玩具，等待他递回来，一开始可能需要手把手辅助"
      }
    ]
  }
}
```

**呈现给家长**：
```
┌─────────────────────────────────┐
│ ⚠️ 双向沟通进入平台期            │
├─────────────────────────────────┤
│ 过去3周保持在1.2次/游戏，        │
│ 建议尝试新游戏类型               │
│                                 │
│ 推荐游戏1：躲猫猫游戏 ⭐优先     │
│ 原理：利用孩子对'消失-出现'的    │
│       兴趣，引导他主动参与       │
│                                 │
│ [查看玩法] [加入计划]            │
│                                 │
│ 推荐游戏2：传递物品游戏          │
│ 原理：建立'递过来-还给我'的      │
│       双向沟通模式               │
│                                 │
│ [查看玩法] [加入计划]            │
└─────────────────────────────────┘
```

#### 场景3：发现新兴趣点 → 立即利用

**触发条件**：识别到新的、稳定出现的兴趣信号

**系统建议**：
```javascript
{
  observation: {
    newInterest: "对水流感兴趣",
    evidence: [
      "洗澡时盯着水龙头看5秒+",
      "用手接水，重复3次",
      "关水后表现出不舍（哭闹）"
    ],
    confidence: 0.85,
    discoveredAt: "2024-01-23"
  },
  recommendation: {
    action: "incorporate_into_games",
    reasoning: "对水流的兴趣是强烈的感官偏好，可以作为游戏素材",
    gameSuggestions: [
      {
        name: "水上漂流游戏",
        targetSkill: "共同注意力",
        howToPlay: "在浴缸放漂浮玩具，一起推玩具、看它移动",
        materials: "塑料小船、积木、乒乓球"
      },
      {
        name: "水声模仿游戏",
        targetSkill: "声音互动",
        howToPlay: "制造不同的水声（滴水、冲水），引导孩子模仿或期待",
        materials: "水瓶、吸管"
      }
    ],
    caution: "注意孩子是否有玩水过敏（恐水），观察情绪反应"
  }
}
```

**呈现给家长**：
```
┌─────────────────────────────────┐
│ ✨ 发现新兴趣：水流！            │
├─────────────────────────────────┤
│ 从最近的记录中，我们发现辰辰    │
│ 对水流表现出强烈且稳定的兴趣    │
│                                 │
│ 证据：                          │
│ • 洗澡时盯着水龙头5秒+          │
│ • 用手接水，重复3次             │
│ • 关水后哭闹                    │
│                                 │
│ 建议利用这一兴趣：              │
│                                 │
│ 🎮 水上漂流游戏                 │
│ 目标：培养共同注意力            │
│ 玩法：在浴缸放漂浮玩具，一起    │
│       推玩具、看它移动          │
│                                 │
│ [加入下周计划]                  │
└─────────────────────────────────┘
```

---

## 4. 技术实现

### 4.1 数据结构设计

```typescript
interface InterventionState {
  // ... 现有字段 ...

  // 新增：微观观察模块
  microObservation: {
    // 记录队列（待分析）
    pendingRecords: ObservationRecord[];

    // 已分析记录
    analyzedRecords: AnalyzedObservation[];

    // 实时检测到的里程碑
    detectedMilestones: Milestone[];

    // 兴趣点图谱（动态更新）
    interestProfile: {
      // 确认的兴趣
      confirmed: InterestPoint[];

      // 潜在兴趣（待验证）
      potential: InterestPoint[];

      // 兴趣变化趋势
      evolution: InterestChange[];
    };

    // 当前建议
    activeSuggestions: ObservationSuggestion[];
  };
}

interface ObservationRecord {
  recordId: string;
  timestamp: string;
  source: 'voice' | 'quick_button' | 'guided' | 'video_ai';
  rawInput: string; // 家长的原始描述
  context: {
    sessionId?: string;
    activity?: string;
    location?: string;
    timeOfDay?: string;
  };
}

interface AnalyzedObservation {
  observationId: string;
  originalRecord: ObservationRecord;

  // AI提取的结构化信息
  extracted: {
    behavior: string;
    category: string; // 'eye_contact' | 'verbal' | 'emotional' | 'social'
    significance: 'breakthrough' | 'improvement' | 'normal' | 'concern';
    confidence: number;
  };

  // 关联分析
  correlations: {
    relatedObservations: string[]; // 相关的观察记录ID
    possibleCauses: string[];
    patternDetected: boolean;
  };

  // 标签（便于检索）
  tags: string[];
}

interface Milestone {
  milestoneId: string;
  behavior: string;
  firstOccurrence: string;
  significance: 'breakthrough' | 'first_time';
  context: string;
  comparisonWithBaseline: string;
  celebrationMessage: string;
  relatedObservations: string[];
}

interface InterestPoint {
  interestId: string;
  name: string;
  category: 'visual' | 'auditory' | 'tactile' | 'proprioceptive';
  strength: 'high' | 'medium' | 'low';
  duration: string; // "2周"
  status: 'confirmed' | 'potential' | 'declining';
  evidence: string[];
  firstSeenAt: string;
  lastConfirmedAt: string;
}
```

### 4.2 核心API设计

```typescript
// ===== 观察记录 =====
POST   /api/observations/voice           // 语音记录上传
POST   /api/observations/guided          // 引导式记录会话
POST   /api/observations/quick           // 快捷按钮记录

// ===== 观察分析 =====
GET    /api/observations/analysis/latest // 获取最新分析
GET    /api/observations/milestones      // 获取里程碑列表
GET    /api/observations/trends/:metric  // 获取趋势分析

// ===== 兴趣图谱 =====
GET    /api/interests/profile            // 获取兴趣画像
POST   /api/interests/confirm            // 确认潜在兴趣
GET    /api/interests/suggestions        // 获取基于兴趣的游戏建议

// ===== 实时提示 =====
GET    /api/observations/prompts         // 获取观察提醒（今天该关注什么）
WebSocket /api/ws/observations           // 实时观察推送
```

---

## 5. 工作流集成

### 5.1 新增Agent：微观观察捕获Agent

**职责**：在现有工作流中，负责记录、分析、提醒观察

**与现有Agent的协作**：

```
┌─────────────────────────────────────────────────┐
│ 现有工作流中的新角色                             │
├─────────────────────────────────────────────────┤
│                                                 │
│ 1. 游戏推荐前 → 观察捕获Agent提供上下文          │
│    └─ "最近发现孩子对旋转物体兴趣增强"           │
│    └─ 推荐Agent据此调整游戏                      │
│                                                 │
│ 2. 游戏进行中 → 观察捕获Agent后台运行            │
│    └─ 家长点击快捷按钮 → 实时记录                │
│    └─ 实时指引Agent结合观察结果调整提示          │
│                                                 │
│ 3. 游戏结束后 → 观察捕获Agent汇总分析            │
│    └─ 结合快捷记录 + 语音记录 + 视频分析          │
│    └─ 输出：本次观察总结                         │
│                                                 │
│ 4. 记忆更新时 → 观察捕获Agent识别里程碑          │
│    └─ 对比历史数据，检测首次出现/趋势变化         │
│    └─ 自动标记重要事件                           │
│                                                 │
│ 5. 再评估时 → 观察捕获Agent提供证据              │
│    └─ "基于15次观察记录，眼神接触提升140%"       │
│    └─ 让再评估结论有数据支撑                     │
│                                                 │
│ 6. 可视化时 → 观察捕获Agent提供微观数据          │
│    └─ 热力图、时间线、里程碑标记                 │
│    └─ 让家长直观看到"肉眼看不到的进步"           │
│                                                 │
└─────────────────────────────────────────────────┘
```

### 5.2 LangGraph节点设计

```typescript
// 新增节点
workflow.addNode('capture_observation', observationCaptureAgent);
workflow.addNode('analyze_observation', observationAnalysisAgent);
workflow.addNode('detect_milestone', milestoneDetectionAgent);
workflow.addNode('update_interest_profile', interestProfileAgent);
workflow.addNode('generate_observation_prompt', observationPromptAgent);

// 与现有节点的连接
workflow.addEdge('recommend_games', 'capture_observation'); // 推荐前获取最新观察
workflow.addEdge('realtime_guidance', 'analyze_observation'); // 游戏中实时分析
workflow.addEdge('session_summary', 'detect_milestone'); // 会话后检测里程碑
workflow.addEdge('update_memory', 'update_interest_profile'); // 记忆更新时同步兴趣图谱
```

---

## 6. 用户界面设计

### 6.1 三个关键界面

#### 界面1：快速记录入口（无处不在）

```typescript
// 游戏页面底部常驻
<GameSession>
  <GameContent />
  <QuickRecordBar>
    <RecordButton icon="😊" label="微笑" />
    <RecordButton icon="👀" label="眼神" />
    <RecordButton icon="🗣️" label="出声" />
    <RecordButton icon="🤝" label="互动" />
    <VoiceRecordButton />
  </QuickRecordBar>
</GameSession>

// 任何页面可悬浮调用
<FloatingActionButton onClick={openRecordModal}>
  📝 记录观察
</FloatingActionButton>
```

#### 界面2：观察洞察推送（主动告知）

```typescript
// 首页动态展示
<Dashboard>
  <InsightCard type="milestone">
    🎉 辰辰第一次主动眼神接触！
    <TimeStamp>2小时前</TimeStamp>
    <Button>查看详情</Button>
  </InsightCard>

  <InsightCard type="trend">
    📈 主动微笑频率提升140%
    <TimeRange>过去4周</TimeRange>
    <Button>查看趋势</Button>
  </InsightCard>

  <InsightCard type="suggestion">
    💡 发现新兴趣：水流
    <Button>查看游戏建议</Button>
  </InsightCard>
</Dashboard>
```

#### 界面3：观察历史与趋势（深度分析）

```typescript
<ObservationTimeline>
  <TimeRangeSelector />

  <MilestoneTimeline>
    <Milestone date="2024-01-23" type="breakthrough">
      首次主动眼神接触
      <VideoClip src="..." />
      <RelatedContext>积木游戏中</RelatedContext>
    </Milestone>
  </MilestoneTimeline>

  <MetricChart metric="eye_contact">
    <TrendLine data={...} />
    <Annotations>
      <Annotation date="01-15">开始躲猫猫游戏</Annotation>
      <Annotation date="01-23">突破性进展</Annotation>
    </Annotations>
  </MetricChart>

  <InterestProfile>
    <Interest name="旋转物体" strength="high" duration="2个月" />
    <Interest name="水流" strength="medium" duration="1周" status="new" />
  </InterestProfile>
</ObservationTimeline>
```

---

## 7. 实施计划

### 7.1 MVP阶段（3个月）

**核心功能**：
- ✅ 语音记录 + AI分析
- ✅ 快捷按钮记录
- ✅ 首次出现检测（里程碑）
- ✅ 基础趋势分析
- ✅ 兴趣点识别（简单版）

**暂不实现**：
- ❌ 引导式记录（V1.0）
- ❌ 复杂关联分析（V1.0）

### 7.2 V1.0阶段（6个月）

**新增功能**：
- ✅ 引导式记录
- ✅ 关联分析和因果推断
- ✅ 兴趣演变追踪
- ✅ 智能观察提醒（"今天该关注什么"）

---

## 附录：核心设计原则总结

1. **家长是主角，AI是助手**
   - 家长建立情感联结，AI负责记录和分析
   - AI不会"自说自话"下结论，而是呈现证据让家长判断

2. **记录门槛极低**
   - 语音、快捷按钮、引导式，多种方式适配不同场景
   - 哪怕只有一个模糊印象，也能开始记录

3. **让看不见的变可见**
   - 首次出现检测 → 让家长知道这是里程碑
   - 趋势分析 → 让家长看到"没变化"其实是"慢速进步"
   - 关联分析 → 让家长发现肉眼看不到的规律

4. **从记录到行动的闭环**
   - 不是为了记录而记录
   - 每个分析都导向具体的下一步建议
   - 让观察真正服务于干预

---

**文档结束**

本设计文档详细描述了"微观变化捕捉系统"的完整设计方案，从问题分析到功能设计，从技术实现到用户界面，形成了一个完整的闭环。系统的核心理念是**在家长与孩子建立情感联结的基础上，作为敏锐的记录者和专业分析师，让家长看到肉眼看不到的进步和规律**。
