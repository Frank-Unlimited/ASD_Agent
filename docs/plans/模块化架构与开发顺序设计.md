# ASDåœ°æ¿æ—¶å…‰å¹²é¢„è¾…åŠ©ç³»ç»Ÿ - æ¨¡å—åŒ–æ¶æ„ä¸å¼€å‘é¡ºåºè®¾è®¡

**æ–‡æ¡£æ—¥æœŸ**: 2026-01-26ï¼ˆ2026-01-27æ›´æ–°ï¼‰
**ç‰ˆæœ¬**: v2.1 (Pythonç‰ˆ)
**ç›®æ ‡**: é¡¶å±‚æ¨¡å—åˆ’åˆ†ï¼Œæ˜ç¡®èŒè´£ä¸è°ƒç”¨å…³ç³»
**æŠ€æœ¯æ ˆ**: åç«¯ç»Ÿä¸€ä½¿ç”¨ Python

---

## ç›®å½•

1. [æ¶æ„è®¾è®¡åŸåˆ™](#1-æ¶æ„è®¾è®¡åŸåˆ™)
2. [æ ¸å¿ƒæ¨¡å—åˆ’åˆ†](#2-æ ¸å¿ƒæ¨¡å—åˆ’åˆ†)
3. [æ¨¡å—è°ƒç”¨å…³ç³»å›¾](#3-æ¨¡å—è°ƒç”¨å…³ç³»å›¾)
4. [å¼€å‘é¡ºåºä¸å¹¶è¡Œç­–ç•¥](#4-å¼€å‘é¡ºåºä¸å¹¶è¡Œç­–ç•¥)
5. [LangGraphé›†æˆæ–¹æ¡ˆ](#5-langgraphé›†æˆæ–¹æ¡ˆ)

---

## 1. æ¶æ„è®¾è®¡åŸåˆ™

### 1.1 è®¾è®¡ç›®æ ‡

- **é«˜å†…èšä½è€¦åˆ**: ç›¸å…³åŠŸèƒ½èšåˆåœ¨ä¸€èµ·ï¼Œæ¨¡å—é—´é€šè¿‡æ¸…æ™°æ¥å£é€šä¿¡
- **é¢å‘æ¥å£ç¼–ç¨‹**: å…ˆå®šä¹‰æ¥å£ï¼Œå†å®ç°Mockï¼Œæœ€åæ›¿æ¢çœŸå®å®ç°
- **å¹¶è¡Œå¼€å‘**: æ¡†æ¶ç»„å’Œæ¨¡å—ç»„å¯ä»¥å¹¶è¡Œå¼€å‘ï¼Œäº’ä¸é˜»å¡
- **æ¸è¿›å¼å¼€å‘**: å…ˆç”¨Mockè·‘é€šæµç¨‹ï¼Œå†é€æ­¥æ›¿æ¢çœŸå®æ¨¡å—
- **æ˜“äºé›†æˆ**: æ‰€æœ‰æ¨¡å—æœ€ç»ˆé›†æˆåˆ°LangGraphæ¡†æ¶

### 1.2 ä¸‰å±‚æ¶æ„

```
ç¬¬ä¸‰å±‚: LangGraphå·¥ä½œæµå±‚
  - ç¼–æ’æ‰€æœ‰æ¨¡å—ï¼Œå®ç°å®Œæ•´ä¸šåŠ¡æµç¨‹
  - åªä¾èµ–æ¥å£ï¼Œä¸ä¾èµ–å…·ä½“å®ç°
  
ç¬¬äºŒå±‚: ä¸šåŠ¡é€»è¾‘å±‚
  - å®ç°æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼Œè°ƒç”¨åŸºç¡€è®¾æ–½å±‚
  - æä¾›æ¥å£å®šä¹‰ + Mockå®ç° + çœŸå®å®ç°
  
ç¬¬ä¸€å±‚: åŸºç¡€è®¾æ–½å±‚
  - æä¾›æ•°æ®å­˜å‚¨ã€AIèƒ½åŠ›ç­‰åŸºç¡€æœåŠ¡
  - æä¾›æ¥å£å®šä¹‰ + Mockå®ç° + çœŸå®å®ç°
```

### 1.3 é¢å‘æ¥å£ç¼–ç¨‹ç­–ç•¥

**å¼€å‘æµç¨‹**:
```
1. å®šä¹‰æ‰€æœ‰æ¨¡å—æ¥å£ï¼ˆPython ABCæŠ½è±¡åŸºç±»ï¼‰
2. å®ç°æ‰€æœ‰Mockç‰ˆæœ¬ï¼ˆè¿”å›å‡æ•°æ®ï¼‰
3. LangGraphè°ƒç”¨æ¥å£ï¼ˆä¸å…³å¿ƒMockè¿˜æ˜¯çœŸå®ï¼‰
4. è·‘é€šå®Œæ•´æµç¨‹ï¼ˆå…¨Mockï¼‰
5. é€ä¸ªæ›¿æ¢çœŸå®å®ç°
6. é€šè¿‡é…ç½®åˆ‡æ¢Mock/çœŸå®
```

**ä¼˜åŠ¿**:
- âœ… ç¬¬1å‘¨å°±èƒ½è·‘é€šå®Œæ•´æµç¨‹
- âœ… å¿«é€ŸéªŒè¯æ¶æ„è®¾è®¡
- âœ… æ¡†æ¶ç»„å’Œæ¨¡å—ç»„å¹¶è¡Œå¼€å‘
- âœ… é™ä½é£é™©ï¼Œéšæ—¶å¯å›é€€
- âœ… æ˜“äºæµ‹è¯•å’Œè°ƒè¯•

---

## 2. æ ¸å¿ƒæ¨¡å—åˆ’åˆ†

**è¯´æ˜**: æ¯ä¸ªæ¨¡å—åŒ…å«ä¸‰éƒ¨åˆ†ï¼šæ¥å£å®šä¹‰ã€Mockå®ç°ã€çœŸå®å®ç°

### ç¬¬ä¸€å±‚: åŸºç¡€è®¾æ–½å±‚ï¼ˆ6ä¸ªæ¨¡å—ï¼‰

---

#### æ¨¡å—1: SQLiteæ•°æ®ç®¡ç†æ¨¡å—

**æ¥å£å®šä¹‰**:
```python
from abc import ABC, abstractmethod
from typing import Optional

class ISQLiteService(ABC):
    @abstractmethod
    async def get_child(self, child_id: str) -> Optional[ChildProfile]:
        pass

    @abstractmethod
    async def save_child(self, profile: ChildProfile) -> None:
        pass

    @abstractmethod
    async def create_session(self, child_id: str, game_id: str) -> str:
        pass

    @abstractmethod
    async def get_session(self, session_id: str) -> Optional[Session]:
        pass

    @abstractmethod
    async def save_weekly_plan(self, plan: WeeklyPlan) -> str:
        pass

    @abstractmethod
    async def get_weekly_plan(self, plan_id: str) -> Optional[WeeklyPlan]:
        pass
```

**Mockå®ç°**:
- è¿”å›ç¡¬ç¼–ç çš„å‡æ•°æ®
- æ•°æ®å­˜åœ¨å†…å­˜ä¸­
- å¿«é€Ÿå“åº”ï¼Œä¾¿äºæµ‹è¯•

**çœŸå®å®ç°**:
- è¿æ¥SQLiteæ•°æ®åº“
- çœŸå®çš„CRUDæ“ä½œ
- äº‹åŠ¡ç®¡ç†

**èŒè´£**: 
ç®¡ç†æ‰€æœ‰ç»“æ„åŒ–æ•°æ®çš„å­˜å‚¨å’ŒæŸ¥è¯¢

**æ ¸å¿ƒåŠŸèƒ½**:
- å­©å­æ¡£æ¡ˆçš„å¢åˆ æ”¹æŸ¥
- å¹²é¢„ä¼šè¯è®°å½•çš„å­˜å‚¨å’ŒæŸ¥è¯¢
- å‘¨è®¡åˆ’å’Œæ—¥å†äº‹ä»¶çš„ç®¡ç†
- è§‚å¯Ÿè®°å½•çš„å­˜å‚¨

**è¢«è°è°ƒç”¨**: 
æ‰€æœ‰éœ€è¦æŒä¹…åŒ–æ•°æ®çš„ä¸šåŠ¡æ¨¡å—

**ä¾èµ–**: 
æ— 

---

#### æ¨¡å—2: Graphitiè®°å¿†ç½‘ç»œæ¨¡å—

**æ¥å£å®šä¹‰**:
```python
from abc import ABC, abstractmethod
from typing import List

class IGraphitiService(ABC):
    @abstractmethod
    async def save_memories(self, child_id: str, memories: List[Memory]) -> None:
        pass

    @abstractmethod
    async def get_recent_memories(self, child_id: str, days: int) -> List[Memory]:
        pass

    @abstractmethod
    async def analyze_trends(self, child_id: str, dimension: str) -> TrendAnalysis:
        pass

    @abstractmethod
    async def detect_milestones(self, child_id: str) -> List[Milestone]:
        pass

    @abstractmethod
    async def build_context(self, child_id: str) -> ContextData:
        pass
```

**Mockå®ç°**:
- è¿”å›å‡çš„è¶‹åŠ¿æ•°æ®ï¼ˆå¦‚"improving"ï¼‰
- è¿”å›å‡çš„é‡Œç¨‹ç¢‘åˆ—è¡¨
- ä¸å®é™…å­˜å‚¨æ•°æ®

**çœŸå®å®ç°**:
- è¿æ¥Graphitiç½‘ç»œ
- æ‰¹é‡å†™å…¥è®°å¿†èŠ‚ç‚¹
- çœŸå®çš„æ—¶åºåˆ†æ

**èŒè´£**: 
ç®¡ç†é•¿æœŸæ—¶åºè®°å¿†ï¼Œæä¾›è¶‹åŠ¿åˆ†æå’Œé‡Œç¨‹ç¢‘æ£€æµ‹

**æ ¸å¿ƒåŠŸèƒ½**:
- å°†è§‚å¯Ÿäº‹ä»¶å†™å…¥è®°å¿†ç½‘ç»œï¼ˆæ‰¹é‡å†™å…¥ï¼‰
- æŸ¥è¯¢å­©å­çš„å†å²è®°å¿†
- åˆ†æå„ç»´åº¦çš„æ—¶åºè¶‹åŠ¿
- æ£€æµ‹é‡Œç¨‹ç¢‘äº‹ä»¶
- æ£€æµ‹å¹³å°æœŸ
- æ„å»ºå½“å‰ä¸Šä¸‹æ–‡ï¼ˆæœ€è¿‘è¶‹åŠ¿ã€å…³æ³¨ç‚¹ç­‰ï¼‰

**è¢«è°è°ƒç”¨**: 
è®°å¿†æ›´æ–°æ¨¡å—ã€å†è¯„ä¼°æ¨¡å—ã€å¯¹è¯åŠ©æ‰‹æ¨¡å—

**ä¾èµ–**: 
æ— 

---

#### æ¨¡å—3: çŸ¥è¯†åº“ä¸RAGæ¨¡å—

**æ¥å£å®šä¹‰**:
```python
from abc import ABC, abstractmethod
from typing import List, Optional, Any

class IKnowledgeRAGService(ABC):
    # åˆ†å±‚æ£€ç´¢
    @abstractmethod
    async def search_methodology(self, query: str, top_k: int) -> List[Knowledge]:
        pass

    @abstractmethod
    async def search_games(self, query: str, filters: GameFilters, top_k: int) -> List[Game]:
        pass

    @abstractmethod
    async def search_scale(self, query: str, top_k: int) -> List[Knowledge]:
        pass

    @abstractmethod
    async def search_cases(self, query: str, top_k: int) -> List[Case]:
        pass

    # è·¨å±‚æ£€ç´¢
    @abstractmethod
    async def search_across_layers(self, query: str, layers: List[str], top_k: int) -> List[Knowledge]:
        pass

    # æŒ‰ç»´åº¦æ£€ç´¢ï¼ˆæ¸¸æˆä¸“ç”¨ï¼‰
    @abstractmethod
    async def search_games_by_dimension(self, dimension: str, difficulty: str, top_k: int) -> List[Game]:
        pass

    @abstractmethod
    async def search_games_by_interest(self, interest: str, top_k: int) -> List[Game]:
        pass

    # æ··åˆæ£€ç´¢
    @abstractmethod
    async def hybrid_search(self, query: str, filters: Any, top_k: int) -> List[Any]:
        pass

    # è·å–è¯¦æƒ…
    @abstractmethod
    async def get_game(self, game_id: str) -> Optional[Game]:
        pass

    @abstractmethod
    async def get_knowledge(self, knowledge_id: str) -> Optional[Knowledge]:
        pass
```

**èŒè´£**: 
ç®¡ç†åˆ†å±‚çŸ¥è¯†åº“ï¼Œæä¾›åŸºäºRAGçš„çŸ¥è¯†æ£€ç´¢å’Œæ¨è

---

### RAGæŠ€æœ¯é€‰å‹ä¸æ¶æ„è®¾è®¡

#### 1. çŸ¥è¯†åº“åˆ†å±‚ç»“æ„

**ç¬¬ä¸€å±‚: æ–¹æ³•è®ºçŸ¥è¯†åº“ï¼ˆç†è®ºå±‚ï¼‰**
- å†…å®¹ç±»å‹: é•¿æ–‡æ¡£ã€ç†è®ºæ–‡ç« ã€ä¸“ä¸šä¹¦ç±ç« èŠ‚
- æ•°æ®é‡: 100-200ç¯‡æ–‡æ¡£
- ç‰¹ç‚¹: å†…å®¹æ·±åº¦é«˜ã€ç»“æ„åŒ–ç¨‹åº¦ä½ã€éœ€è¦ç†è§£ä¸Šä¸‹æ–‡
- ç¤ºä¾‹:
  - åœ°æ¿æ—¶å…‰å…­å¤§æƒ…ç»ªå‘å±•é‡Œç¨‹ç¢‘è¯¦è§£
  - DIRæ¨¡å‹ç†è®ºåŸºç¡€
  - å¹²é¢„åŸåˆ™å’Œç¦å¿Œ
  - è§‚å¯Ÿæ¡†æ¶å’Œè¯„ä¼°æ–¹æ³•
  - å®¶é•¿æŒ‡å¯¼æ‰‹å†Œ

**ç¬¬äºŒå±‚: æ¸¸æˆçŸ¥è¯†åº“ï¼ˆå®è·µå±‚ï¼‰**
- å†…å®¹ç±»å‹: ç»“æ„åŒ–æ¸¸æˆæ•°æ®
- æ•°æ®é‡: MVPé˜¶æ®µ50ä¸ªæ¸¸æˆï¼ŒåæœŸæ‰©å±•åˆ°200+
- ç‰¹ç‚¹: é«˜åº¦ç»“æ„åŒ–ã€å…ƒæ•°æ®ä¸°å¯Œã€éœ€è¦ç²¾ç¡®åŒ¹é…
- æ•°æ®ç»“æ„:
  ```
  æ¸¸æˆ {
    åŸºæœ¬ä¿¡æ¯: {åç§°, æè¿°, é€‚ç”¨å¹´é¾„, æ‰€éœ€é“å…·}
    ç›®æ ‡ç»´åº¦: [eye_contact, two_way_communication, ...]
    éš¾åº¦ç­‰çº§: easy/medium/hard
    ç©æ³•æ­¥éª¤: [{step, instruction, tips}, ...]
    æ¸¸æˆå˜ä½“: [{name, description, difficulty_change}, ...]
    æ³¨æ„äº‹é¡¹: [...]
    æˆåŠŸæ¡ˆä¾‹: [...]
  }
  ```

**ç¬¬ä¸‰å±‚: é‡è¡¨çŸ¥è¯†åº“ï¼ˆè¯„ä¼°å±‚ï¼‰**
- å†…å®¹ç±»å‹: æ ‡å‡†åŒ–é‡è¡¨é¢˜ç›®å’Œè§£è¯»
- æ•°æ®é‡: 3å¥—é‡è¡¨ï¼ˆCARS-2ã€ADOS-2ã€ATECï¼‰
- ç‰¹ç‚¹: é«˜åº¦æ ‡å‡†åŒ–ã€éœ€è¦ç²¾ç¡®æ£€ç´¢
- æ•°æ®ç»“æ„:
  ```
  é‡è¡¨ {
    é‡è¡¨ç±»å‹: CARS-2/ADOS-2/ATEC
    é¢˜ç›®ç¼–å·: 1-50
    é¢˜ç›®å†…å®¹: "..."
    è¯„åˆ†æ ‡å‡†: {1åˆ†: "...", 2åˆ†: "...", ...}
    è§£è¯»è¯´æ˜: "..."
    ç›¸å…³ç»´åº¦: [...]
  }
  ```

**ç¬¬å››å±‚: æ¡ˆä¾‹çŸ¥è¯†åº“ï¼ˆç»éªŒå±‚ï¼Œå¯é€‰ï¼‰**
- å†…å®¹ç±»å‹: è„±æ•åçš„çœŸå®æ¡ˆä¾‹
- æ•°æ®é‡: åæœŸç§¯ç´¯ï¼ŒåˆæœŸå¯æ— 
- ç‰¹ç‚¹: æƒ…å¢ƒåŒ–ã€éœ€è¦ç›¸ä¼¼åº¦åŒ¹é…
- æ•°æ®ç»“æ„:
  ```
  æ¡ˆä¾‹ {
    å­©å­å¹´é¾„: 3å²
    é—®é¢˜ç±»å‹: "çœ¼ç¥æ¥è§¦å›°éš¾"
    å¹²é¢„æ–¹æ³•: "ç§¯æœ¨ä¼ é€’æ¸¸æˆ"
    å¹²é¢„å‘¨æœŸ: 4å‘¨
    å¹²é¢„ç»“æœ: "çœ¼ç¥æ¥è§¦ä»0æ¬¡/å¤©æå‡åˆ°5æ¬¡/å¤©"
    å…³é”®ç»éªŒ: [...]
  }
  ```

---

#### 2. RAGæŠ€æœ¯é€‰å‹å¯¹æ¯”

**æ–¹æ¡ˆA: ä¼ ç»ŸRAGï¼ˆæ¨èç”¨äºMVPï¼‰**

æŠ€æœ¯æ ˆ:
- å‘é‡æ•°æ®åº“: PostgreSQL + pgvector
- Embeddingæ¨¡å‹: é€šä¹‰åƒé—®Embedding / OpenAI text-embedding-3
- æ£€ç´¢ç­–ç•¥: å‘é‡ç›¸ä¼¼åº¦ + å…ƒæ•°æ®è¿‡æ»¤

ä¼˜åŠ¿:
- âœ… ç®€å•æ˜“å®ç°
- âœ… æˆæœ¬ä½
- âœ… é€‚åˆç»“æ„åŒ–æ•°æ®ï¼ˆæ¸¸æˆåº“ï¼‰
- âœ… æŸ¥è¯¢é€Ÿåº¦å¿«

åŠ£åŠ¿:
- âš ï¸ å¯¹é•¿æ–‡æ¡£ç†è§£æœ‰é™
- âš ï¸ ç¼ºä¹çŸ¥è¯†å›¾è°±å…³ç³»

é€‚ç”¨åœºæ™¯:
- æ¸¸æˆçŸ¥è¯†åº“ï¼ˆé«˜åº¦ç»“æ„åŒ–ï¼‰
- é‡è¡¨çŸ¥è¯†åº“ï¼ˆæ ‡å‡†åŒ–ï¼‰
- MVPå¿«é€ŸéªŒè¯

---

**æ–¹æ¡ˆB: GraphRAGï¼ˆæ¨èç”¨äºæ–¹æ³•è®ºçŸ¥è¯†åº“ï¼‰**

æŠ€æœ¯æ ˆ:
- çŸ¥è¯†å›¾è°±: Neo4j / è‡ªå»ºå›¾ç»“æ„
- å®ä½“æå–: LLMæå–å®ä½“å’Œå…³ç³»
- æ£€ç´¢ç­–ç•¥: å›¾éå† + å‘é‡æ£€ç´¢

ä¼˜åŠ¿:
- âœ… ç†è§£å®ä½“é—´å…³ç³»
- âœ… é€‚åˆå¤æ‚ç†è®ºæ–‡æ¡£
- âœ… å¯ä»¥å›ç­”"ä¸ºä»€ä¹ˆ"ç±»é—®é¢˜
- âœ… æ”¯æŒå¤šè·³æ¨ç†

åŠ£åŠ¿:
- âš ï¸ å®ç°å¤æ‚
- âš ï¸ æˆæœ¬é«˜ï¼ˆéœ€è¦LLMæå–å®ä½“ï¼‰
- âš ï¸ æ„å»ºçŸ¥è¯†å›¾è°±è€—æ—¶

é€‚ç”¨åœºæ™¯:
- æ–¹æ³•è®ºçŸ¥è¯†åº“ï¼ˆç†è®ºæ–‡æ¡£ï¼‰
- éœ€è¦ç†è§£æ¦‚å¿µé—´å…³ç³»
- åæœŸä¼˜åŒ–é˜¶æ®µ

---

**æ–¹æ¡ˆC: æ··åˆRAGï¼ˆæ¨èçš„æœ€ç»ˆæ–¹æ¡ˆï¼‰**

æ¶æ„è®¾è®¡:
```
æŸ¥è¯¢ â†’ æŸ¥è¯¢åˆ†ç±»å™¨
         â†“
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
    â†“         â†“
ä¼ ç»ŸRAG    GraphRAG
(æ¸¸æˆ/é‡è¡¨) (æ–¹æ³•è®º)
    â†“         â†“
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
         â†“
      ç»“æœèåˆ
```

åˆ†å±‚ç­–ç•¥:
- ç¬¬ä¸€å±‚ï¼ˆæ–¹æ³•è®ºï¼‰: GraphRAGï¼ˆç†è§£æ¦‚å¿µå…³ç³»ï¼‰
- ç¬¬äºŒå±‚ï¼ˆæ¸¸æˆï¼‰: ä¼ ç»ŸRAGï¼ˆç²¾ç¡®åŒ¹é…ï¼‰
- ç¬¬ä¸‰å±‚ï¼ˆé‡è¡¨ï¼‰: ä¼ ç»ŸRAGï¼ˆæ ‡å‡†åŒ–æ£€ç´¢ï¼‰
- ç¬¬å››å±‚ï¼ˆæ¡ˆä¾‹ï¼‰: ä¼ ç»ŸRAGï¼ˆç›¸ä¼¼åº¦åŒ¹é…ï¼‰

ä¼˜åŠ¿:
- âœ… å„å–æ‰€é•¿
- âœ… çµæ´»æ‰©å±•
- âœ… æ€§èƒ½å’Œæ•ˆæœå¹³è¡¡

---

#### 3. MVPé˜¶æ®µæ¨èæ–¹æ¡ˆ

**é‡‡ç”¨ä¼ ç»ŸRAG + åˆ†å±‚ç®¡ç†**

ç†ç”±:
1. å¿«é€Ÿå®ç°ï¼Œ2-3å‘¨å¯å®Œæˆ
2. æˆæœ¬å¯æ§
3. æ»¡è¶³MVPéœ€æ±‚
4. åæœŸå¯å‡çº§åˆ°æ··åˆRAG

æŠ€æœ¯æ ˆ:
- å‘é‡æ•°æ®åº“: PostgreSQL + pgvector
- Embedding: é€šä¹‰åƒé—®Embeddingï¼ˆæ€§ä»·æ¯”é«˜ï¼‰
- æ£€ç´¢ç­–ç•¥: å‘é‡æ£€ç´¢ + å…ƒæ•°æ®è¿‡æ»¤ + é‡æ’åº

æ•°æ®åº“è®¾è®¡:
```sql
-- æ–¹æ³•è®ºçŸ¥è¯†è¡¨
CREATE TABLE methodology_knowledge (
  id VARCHAR(50) PRIMARY KEY,
  title VARCHAR(500),
  content TEXT,
  category VARCHAR(50), -- ç†è®º/åŸåˆ™/è§‚å¯Ÿ/æŒ‡å¯¼
  tags TEXT[],
  embedding vector(1536), -- pgvector
  metadata JSONB,
  created_at TIMESTAMP
);

-- æ¸¸æˆçŸ¥è¯†è¡¨
CREATE TABLE game_knowledge (
  id VARCHAR(50) PRIMARY KEY,
  name VARCHAR(200),
  description TEXT,
  age_range VARCHAR(20), -- "2-3å²"
  target_dimensions TEXT[], -- ["eye_contact", ...]
  difficulty VARCHAR(20), -- easy/medium/hard
  required_props TEXT[],
  steps JSONB, -- [{step, instruction, tips}, ...]
  variations JSONB,
  tips TEXT[],
  embedding vector(1536),
  metadata JSONB,
  created_at TIMESTAMP
);

-- é‡è¡¨çŸ¥è¯†è¡¨
CREATE TABLE scale_knowledge (
  id VARCHAR(50) PRIMARY KEY,
  scale_type VARCHAR(20), -- CARS-2/ADOS-2/ATEC
  item_number INTEGER,
  question TEXT,
  scoring_criteria JSONB,
  interpretation TEXT,
  related_dimensions TEXT[],
  embedding vector(1536),
  created_at TIMESTAMP
);

-- å‘é‡ç´¢å¼•
CREATE INDEX ON methodology_knowledge USING ivfflat (embedding vector_cosine_ops);
CREATE INDEX ON game_knowledge USING ivfflat (embedding vector_cosine_ops);
CREATE INDEX ON scale_knowledge USING ivfflat (embedding vector_cosine_ops);
```

---

#### 4. æ£€ç´¢ç­–ç•¥è®¾è®¡

**ç­–ç•¥1: å•å±‚ç²¾ç¡®æ£€ç´¢ï¼ˆæ¸¸æˆåº“ï¼‰**

é€‚ç”¨åœºæ™¯: å‘¨è®¡åˆ’æ¨èã€æŒ‰ç»´åº¦æŸ¥æ‰¾æ¸¸æˆ

æµç¨‹:
```
1. æ„å»ºæŸ¥è¯¢å‘é‡ï¼ˆEmbeddingï¼‰
2. å‘é‡ç›¸ä¼¼åº¦æ£€ç´¢ï¼ˆpgvectorï¼‰
3. å…ƒæ•°æ®è¿‡æ»¤ï¼ˆå¹´é¾„ã€éš¾åº¦ã€ç»´åº¦ï¼‰
4. é‡æ’åºï¼ˆè€ƒè™‘å­©å­ç”»åƒï¼‰
5. è¿”å›Top K
```

ç¤ºä¾‹:
```python
async def search_games_by_dimension(self, dimension: str, difficulty: str, top_k: int) -> List[Game]:
    # 1. æ„å»ºæŸ¥è¯¢
    query = f"é€‚åˆæå‡{dimension}èƒ½åŠ›çš„{difficulty}éš¾åº¦æ¸¸æˆ"
    query_embedding = await self.embed(query)

    # 2. å‘é‡æ£€ç´¢ + å…ƒæ•°æ®è¿‡æ»¤
    results = await self.db.fetch_all("""
        SELECT *, 1 - (embedding <=> $1) as similarity
        FROM game_knowledge
        WHERE $2 = ANY(target_dimensions)
          AND difficulty = $3
        ORDER BY embedding <=> $1
        LIMIT $4
    """, query_embedding, dimension, difficulty, top_k)

    return results
```

---

**ç­–ç•¥2: è·¨å±‚èåˆæ£€ç´¢ï¼ˆå¯¹è¯åŠ©æ‰‹ï¼‰**

é€‚ç”¨åœºæ™¯: å®¶é•¿æé—®ï¼Œä¸ç¡®å®šæŸ¥å“ªä¸ªåº“

æµç¨‹:
```
1. æŸ¥è¯¢åˆ†ç±»ï¼ˆLLMåˆ¤æ–­é—®é¢˜ç±»å‹ï¼‰
2. å¹¶è¡Œæ£€ç´¢å¤šä¸ªçŸ¥è¯†åº“
3. ç»“æœåŠ æƒèåˆ
4. å»é‡å’Œé‡æ’åº
5. è¿”å›Top K
```

ç¤ºä¾‹:
```python
async def search_across_layers(self, query: str, layers: List[str], top_k: int) -> List[Knowledge]:
    # 1. æŸ¥è¯¢åˆ†ç±»
    query_type = await self.classify_query(query)  # "theory" | "game" | "scale"

    # 2. å¹¶è¡Œæ£€ç´¢
    tasks = []
    if 'methodology' in layers:
        tasks.append(self.search_methodology(query, top_k))
    if 'game' in layers:
        tasks.append(self.search_games(query, {}, top_k))
    if 'scale' in layers:
        tasks.append(self.search_scale(query, top_k))

    results = await asyncio.gather(*tasks)
    flat_results = [item for sublist in results for item in sublist]

    # 3. åŠ æƒèåˆï¼ˆæ ¹æ®æŸ¥è¯¢ç±»å‹è°ƒæ•´æƒé‡ï¼‰
    weights = {
        "theory": {"methodology": 0.7, "game": 0.2, "scale": 0.1},
        "game": {"methodology": 0.1, "game": 0.8, "scale": 0.1},
        "scale": {"methodology": 0.1, "game": 0.1, "scale": 0.8}
    }

    weighted = [
        {**r, "score": r["similarity"] * weights[query_type][r["layer"]]}
        for r in flat_results
    ]

    # 4. æ’åºå’Œå»é‡
    weighted.sort(key=lambda x: x["score"], reverse=True)
    return weighted[:top_k]
```

---

**ç­–ç•¥3: æ··åˆæ£€ç´¢ï¼ˆç²¾ç¡®+è¯­ä¹‰ï¼‰**

é€‚ç”¨åœºæ™¯: éœ€è¦ç²¾ç¡®åŒ¹é…æŸäº›æ¡ä»¶

æµç¨‹:
```
1. å…³é”®è¯ç²¾ç¡®åŒ¹é…ï¼ˆSQL LIKEï¼‰
2. å‘é‡è¯­ä¹‰æ£€ç´¢
3. ç»“æœåˆå¹¶ï¼ˆRRFç®—æ³•ï¼‰
4. è¿”å›Top K
```

ç¤ºä¾‹:
```python
async def hybrid_search(self, query: str, filters: Any, top_k: int) -> List[Any]:
    # 1. å…³é”®è¯æ£€ç´¢
    keyword_results = await self.db.fetch_all("""
        SELECT *, 1.0 as keyword_score
        FROM game_knowledge
        WHERE name ILIKE $1 OR description ILIKE $1
    """, f"%{query}%")

    # 2. å‘é‡æ£€ç´¢
    embedding = await self.embed(query)
    vector_results = await self.db.fetch_all("""
        SELECT *, 1 - (embedding <=> $1) as vector_score
        FROM game_knowledge
        ORDER BY embedding <=> $1
        LIMIT $2
    """, embedding, top_k * 2)

    # 3. RRFèåˆ
    merged = self.merge_with_rrf(keyword_results, vector_results)

    return merged[:top_k]
```

---

#### 5. Mockå®ç°

**Mockå®ç°**:
```python
class MockRAGService(IKnowledgeRAGService):
    def __init__(self):
        self.mock_games = [
            {
                "id": "game-001",
                "name": "ç§¯æœ¨ä¼ é€’æ¸¸æˆ",
                "description": "é€šè¿‡ä¼ é€’ç§¯æœ¨å»ºç«‹çœ¼ç¥æ¥è§¦",
                "target_dimensions": ["eye_contact", "two_way_communication"],
                "difficulty": "easy",
                "age_range": "2-3å²",
                "steps": [
                    {"step": 1, "instruction": "ååœ¨å­©å­å¯¹é¢ï¼Œæ‹¿èµ·ä¸€å—ç§¯æœ¨"},
                    {"step": 2, "instruction": "ç­‰å¾…å­©å­çœ‹å‘ä½ ï¼Œç„¶åé€’ç»™ä»–"},
                    {"step": 3, "instruction": "é¼“åŠ±å­©å­é€’å›æ¥"}
                ]
            },
            # ... æ›´å¤šå‡æ¸¸æˆ
        ]

    async def search_games(self, query: str, filters: GameFilters, top_k: int) -> List[Game]:
        print(f"[Mock RAG] æ£€ç´¢æ¸¸æˆ: {query}")
        return self.mock_games[:top_k]

    async def search_games_by_dimension(self, dimension: str, difficulty: str, top_k: int) -> List[Game]:
        print(f"[Mock RAG] æŒ‰ç»´åº¦æ£€ç´¢: {dimension}, {difficulty}")
        result = [
            g for g in self.mock_games
            if dimension in g["target_dimensions"] and g["difficulty"] == difficulty
        ]
        return result[:top_k]
```

---

#### 6. çœŸå®å®ç°

**çœŸå®å®ç°**:
- PostgreSQL + pgvector
- é€šä¹‰åƒé—®Embedding API
- å‘é‡æ£€ç´¢ + å…ƒæ•°æ®è¿‡æ»¤
- é‡æ’åºç®—æ³•

---

#### 7. åæœŸä¼˜åŒ–æ–¹å‘

**é˜¶æ®µ1ï¼ˆMVPï¼‰**: ä¼ ç»ŸRAG + åˆ†å±‚ç®¡ç†
**é˜¶æ®µ2ï¼ˆ3ä¸ªæœˆåï¼‰**: å¼•å…¥GraphRAGå¤„ç†æ–¹æ³•è®ºçŸ¥è¯†åº“
**é˜¶æ®µ3ï¼ˆ6ä¸ªæœˆåï¼‰**: æ··åˆRAG + æŸ¥è¯¢è·¯ç”±ä¼˜åŒ–
**é˜¶æ®µ4ï¼ˆ1å¹´åï¼‰**: ä¸ªæ€§åŒ–RAG + ç”¨æˆ·åé¦ˆå­¦ä¹ 

---

**è¢«è°è°ƒç”¨**: 
å‘¨è®¡åˆ’æ¨èæ¨¡å—ã€å®æ—¶æŒ‡å¼•æ¨¡å—ã€å¯¹è¯åŠ©æ‰‹æ¨¡å—ã€åˆå§‹è¯„ä¼°æ¨¡å—

**ä¾èµ–**: 
æ— 

---

#### æ¨¡å—4: AIè§†é¢‘è§£ææ¨¡å—

**æ¥å£å®šä¹‰**:
```python
from abc import ABC, abstractmethod

class IVideoAnalysisService(ABC):
    @abstractmethod
    async def analyze_video(self, video_path: str, context: AnalysisContext) -> VideoAnalysisResult:
        pass
```

**Mockå®ç°**:
- è¿”å›å‡çš„åˆ†æç»“æœ
- å‡è£…æ£€æµ‹åˆ°3æ¬¡å¾®ç¬‘ã€5æ¬¡çœ¼ç¥æ¥è§¦
- ä¸å®é™…åˆ†æè§†é¢‘

**çœŸå®å®ç°**:
- è°ƒç”¨DeepSeek-Vision
- çœŸå®çš„è§†é¢‘å¸§æå–å’Œåˆ†æ
- è¡¨æƒ…ã€çœ¼ç¥ã€åŠ¨ä½œè¯†åˆ«

**èŒè´£**: 
åˆ†ææ¸¸æˆè§†é¢‘ï¼Œè¯†åˆ«å­©å­çš„è¡¨æƒ…ã€çœ¼ç¥ã€åŠ¨ä½œã€å£°éŸ³

**è¢«è°è°ƒç”¨**: 
è§†é¢‘åˆ†æä¸éªŒè¯æ¨¡å—

**ä¾èµ–**: 
æ— 

---

#### æ¨¡å—5: è¯­éŸ³å¤„ç†æ¨¡å—

**æ¥å£å®šä¹‰**:
```python
from abc import ABC, abstractmethod

class ISpeechService(ABC):
    @abstractmethod
    async def speech_to_text(self, audio_path: str) -> str:
        pass

    @abstractmethod
    async def text_to_speech(self, text: str) -> str:
        """è¿”å›éŸ³é¢‘è·¯å¾„"""
        pass
```

**Mockå®ç°**:
- STTè¿”å›"è¿™æ˜¯æµ‹è¯•æ–‡å­—"
- TTSè¿”å›å‡çš„éŸ³é¢‘è·¯å¾„
- ä¸å®é™…è°ƒç”¨è¯­éŸ³API

**çœŸå®å®ç°**:
- è°ƒç”¨é˜¿é‡Œäº‘è¯­éŸ³è¯†åˆ«API
- è°ƒç”¨é˜¿é‡Œäº‘è¯­éŸ³åˆæˆAPI
- çœŸå®çš„éŸ³é¢‘å¤„ç†

**èŒè´£**: 
å¤„ç†è¯­éŸ³è¯†åˆ«å’Œåˆæˆ

**è¢«è°è°ƒç”¨**: 
è§‚å¯Ÿæ•è·æ¨¡å—ã€å®æ—¶æŒ‡å¼•æ¨¡å—

**ä¾èµ–**: 
æ— 

---

#### æ¨¡å—6: æ–‡æ¡£è§£ææ¨¡å—

**æ¥å£å®šä¹‰**:
```python
from abc import ABC, abstractmethod
from typing import Literal

class IDocumentParserService(ABC):
    @abstractmethod
    async def parse_report(self, file_path: str, file_type: Literal["pdf", "image"]) -> ParsedReport:
        pass

    @abstractmethod
    async def parse_scale(self, scale_data: ScaleData, scale_type: str) -> ScaleResult:
        pass
```

**Mockå®ç°**:
- è¿”å›å‡çš„æŠ¥å‘Šè§£æç»“æœ
- å‡è£…æå–äº†è¯Šæ–­ã€èƒ½åŠ›è¯„ä¼°ç­‰
- ä¸å®é™…åšOCRå’ŒLLMæå–

**çœŸå®å®ç°**:
- OCRè¯†åˆ«æ–‡å­—
- è°ƒç”¨LLMç»“æ„åŒ–æå–
- çœŸå®çš„æŠ¥å‘Šè§£æ

**èŒè´£**: 
è§£æåŒ»é™¢æŠ¥å‘Šå’Œé‡è¡¨æ•°æ®

**è¢«è°è°ƒç”¨**: 
åˆå§‹è¯„ä¼°æ¨¡å—

**ä¾èµ–**: 
æ— 

---

### ç¬¬äºŒå±‚: ä¸šåŠ¡é€»è¾‘å±‚ï¼ˆ10ä¸ªæ¨¡å—ï¼‰

**è¯´æ˜**: ä¸šåŠ¡æ¨¡å—åŒæ ·éµå¾ªæ¥å£å®šä¹‰ + Mockå®ç° + çœŸå®å®ç°çš„æ¨¡å¼

---

#### æ¨¡å—7-16: ä¸šåŠ¡é€»è¾‘æ¨¡å—

ä¸ºç®€æ´èµ·è§ï¼Œä¸šåŠ¡é€»è¾‘å±‚çš„10ä¸ªæ¨¡å—ï¼ˆåˆå§‹è¯„ä¼°ã€å‘¨è®¡åˆ’æ¨èã€å®æ—¶æŒ‡å¼•ã€è§‚å¯Ÿæ•è·ã€è§†é¢‘åˆ†æéªŒè¯ã€æ€»ç»“ç”Ÿæˆã€è®°å¿†æ›´æ–°ã€å†è¯„ä¼°ã€å¯¹è¯åŠ©æ‰‹ã€å¯è§†åŒ–æŠ¥å‘Šï¼‰éƒ½éµå¾ªç›¸åŒçš„æ¨¡å¼ï¼š

**æ¥å£å®šä¹‰**: å®šä¹‰æ¸…æ™°çš„æ–¹æ³•ç­¾å
**Mockå®ç°**: è¿”å›å‡æ•°æ®ï¼Œå¿«é€ŸéªŒè¯æµç¨‹
**çœŸå®å®ç°**: è°ƒç”¨åŸºç¡€è®¾æ–½å±‚ï¼Œå®ç°çœŸå®ä¸šåŠ¡é€»è¾‘

è¯¦ç»†çš„æ¥å£å®šä¹‰å’ŒèŒè´£æè¿°ä¿æŒåŸæ–‡æ¡£å†…å®¹ä¸å˜ã€‚

---

#### æ¨¡å—7: åˆå§‹è¯„ä¼°æ¨¡å—

**èŒè´£**: 
å¤„ç†å­©å­çš„åˆå§‹è¯„ä¼°ï¼Œæ„å»ºåˆå§‹ç”»åƒ

**æ ¸å¿ƒåŠŸèƒ½**:
- æ¥æ”¶åŒ»é™¢æŠ¥å‘Šæˆ–é‡è¡¨æ•°æ®
- è°ƒç”¨æ–‡æ¡£è§£ææ¨¡å—è§£ææ•°æ®
- è°ƒç”¨å¤§æ¨¡å‹èåˆæŠ¥å‘Šå’Œé‡è¡¨æ•°æ®
- ç”Ÿæˆå­©å­çš„åˆå§‹ç”»åƒï¼ˆ6å¤§ç»´åº¦è¯„åˆ†ã€ä¼˜åŠ¿ã€çŸ­æ¿ã€å…´è¶£ã€è§‚å¯Ÿæ¡†æ¶ï¼‰
- ä¿å­˜åˆ°SQLite

**è¾“å…¥**: 
æŠ¥å‘Šæ–‡ä»¶è·¯å¾„æˆ–é‡è¡¨æ•°æ®

**è¾“å‡º**: 
å­©å­ç”»åƒï¼ˆåŒ…å«6å¤§ç»´åº¦ã€è‡ªå®šä¹‰ç»´åº¦ã€ä¼˜åŠ¿ã€çŸ­æ¿ã€å…´è¶£ã€è§‚å¯Ÿæ¡†æ¶ã€å…³æ³¨ç‚¹ï¼‰

**è°ƒç”¨å…³ç³»**:
- è°ƒç”¨: æ–‡æ¡£è§£ææ¨¡å—ã€SQLiteæ•°æ®ç®¡ç†æ¨¡å—
- è¢«è°ƒç”¨: LangGraphå·¥ä½œæµ

**ä¾èµ–**: 
æ–‡æ¡£è§£ææ¨¡å—ã€SQLiteæ•°æ®ç®¡ç†æ¨¡å—

---

#### æ¨¡å—8: å‘¨è®¡åˆ’æ¨èæ¨¡å—

**èŒè´£**: 
ç”Ÿæˆä¸ªæ€§åŒ–çš„å‘¨æ¸¸æˆè®¡åˆ’

**æ ¸å¿ƒåŠŸèƒ½**:
- ä»SQLiteè·å–å­©å­ç”»åƒ
- ä»Graphitiè·å–å½“å‰è¶‹åŠ¿å’Œå…³æ³¨ç‚¹
- åˆ†æéœ€è¦é‡ç‚¹æå‡çš„ç»´åº¦ï¼ˆæœ€å¤š2ä¸ªï¼‰
- è®¾å®šæœ¬å‘¨æ€»ç›®æ ‡ï¼ˆå…·ä½“ã€å¯è¡¡é‡ã€æ¸è¿›å¼ï¼‰
- è°ƒç”¨æ¸¸æˆçŸ¥è¯†åº“RAGæ£€ç´¢å€™é€‰æ¸¸æˆ
- ç”Ÿæˆ7å¤©æ¸¸æˆåºåˆ—ï¼ˆæ¸è¿›å¼éš¾åº¦ã€é‡å¤ç»ƒä¹ ã€åœºæ™¯åˆ‡æ¢ï¼‰
- ä¸ºæ¯å¤©è®¾å®šå°ç›®æ ‡ï¼ˆæ•°å€¼åŒ–ã€å¯éªŒè¯ï¼‰
- ä¿å­˜å‘¨è®¡åˆ’åˆ°SQLite

**è¾“å…¥**: 
å­©å­IDã€å‘¨å¼€å§‹æ—¥æœŸã€ä¸Šå‘¨å®Œæˆæƒ…å†µï¼ˆå¯é€‰ï¼‰

**è¾“å‡º**: 
å‘¨è®¡åˆ’ï¼ˆåŒ…å«æœ¬å‘¨æ€»ç›®æ ‡ã€7ä¸ªæ¯æ—¥è®¡åˆ’ã€æ¨èç†ç”±ï¼‰

**è°ƒç”¨å…³ç³»**:
- è°ƒç”¨: SQLiteæ•°æ®ç®¡ç†æ¨¡å—ã€Graphitiè®°å¿†ç½‘ç»œæ¨¡å—ã€æ¸¸æˆçŸ¥è¯†åº“ä¸RAGæ¨¡å—
- è¢«è°ƒç”¨: LangGraphå·¥ä½œæµ

**ä¾èµ–**: 
SQLiteã€Graphitiã€æ¸¸æˆçŸ¥è¯†åº“

---

#### æ¨¡å—9: å®æ—¶æŒ‡å¼•æ¨¡å—

**èŒè´£**: 
åœ¨æ¸¸æˆè¿›è¡Œä¸­æä¾›åˆ†æ­¥æŒ‡å¼•å’Œè¯æœ¯æ¨è

**æ ¸å¿ƒåŠŸèƒ½**:
- ä»æ¸¸æˆçŸ¥è¯†åº“è·å–æ¸¸æˆè¯¦ç»†ç©æ³•
- æ ¹æ®å½“å‰æ­¥éª¤ç”ŸæˆæŒ‡å¼•æ–‡æœ¬
- è°ƒç”¨è¯­éŸ³åˆæˆç”Ÿæˆè¯­éŸ³æŒ‡å¼•
- æ ¹æ®å­©å­ç”»åƒæ¨èè¯æœ¯
- æé†’ç¦å¿Œè¯æœ¯

**è¾“å…¥**: 
æ¸¸æˆIDã€å½“å‰æ­¥éª¤ã€å­©å­ç”»åƒã€å½“å‰æƒ…å†µ

**è¾“å‡º**: 
æ­¥éª¤æŒ‡å¼•ï¼ˆæ–‡å­—ã€è¯­éŸ³ï¼‰ã€è¯æœ¯æ¨èã€ç¦å¿Œæé†’

**è°ƒç”¨å…³ç³»**:
- è°ƒç”¨: æ¸¸æˆçŸ¥è¯†åº“ä¸RAGæ¨¡å—ã€è¯­éŸ³å¤„ç†æ¨¡å—
- è¢«è°ƒç”¨: LangGraphå·¥ä½œæµ

**ä¾èµ–**: 
æ¸¸æˆçŸ¥è¯†åº“ã€è¯­éŸ³å¤„ç†æ¨¡å—

---

#### æ¨¡å—10: è§‚å¯Ÿæ•è·æ¨¡å—

**èŒè´£**: 
å¤„ç†å®¶é•¿çš„è§‚å¯Ÿè®°å½•ï¼ˆå¿«æ·æŒ‰é’®ã€è¯­éŸ³è®°å½•ï¼‰

**æ ¸å¿ƒåŠŸèƒ½**:
- æ¥æ”¶å¿«æ·æŒ‰é’®è®°å½•ï¼ˆğŸ˜ŠğŸ‘€ğŸ—£ï¸ğŸ¤ğŸ˜¢ï¼‰å¹¶æ‰“ä¸Šæ—¶é—´æˆ³
- æ¥æ”¶è¯­éŸ³è®°å½•ï¼Œè°ƒç”¨è¯­éŸ³è¯†åˆ«è½¬æ–‡å­—
- è°ƒç”¨å¤§æ¨¡å‹ç»“æ„åŒ–æå–è§‚å¯Ÿå†…å®¹
- ä¿å­˜åˆ°å½“å‰ä¼šè¯

**è¾“å…¥**: 
- å¿«æ·è®°å½•: ä¼šè¯IDã€è§‚å¯Ÿç±»å‹ã€æ—¶é—´æˆ³
- è¯­éŸ³è®°å½•: ä¼šè¯IDã€éŸ³é¢‘æ–‡ä»¶è·¯å¾„

**è¾“å‡º**: 
ç»“æ„åŒ–çš„è§‚å¯Ÿè®°å½•ï¼ˆæ—¶é—´æˆ³ã€ç±»å‹ã€æè¿°ã€ä¸Šä¸‹æ–‡ï¼‰

**è°ƒç”¨å…³ç³»**:
- è°ƒç”¨: è¯­éŸ³å¤„ç†æ¨¡å—ã€SQLiteæ•°æ®ç®¡ç†æ¨¡å—
- è¢«è°ƒç”¨: LangGraphå·¥ä½œæµ

**ä¾èµ–**: 
è¯­éŸ³å¤„ç†æ¨¡å—ã€SQLite

---

#### æ¨¡å—11: è§†é¢‘åˆ†æä¸éªŒè¯æ¨¡å—

**èŒè´£**: 
åˆ†æè§†é¢‘å¹¶äº¤å‰éªŒè¯å®¶é•¿çš„å¿«æ·è®°å½•

**æ ¸å¿ƒåŠŸèƒ½**:
- è°ƒç”¨AIè§†é¢‘è§£ææ¨¡å—åˆ†æè§†é¢‘
- å¯¹æ¯”å®¶é•¿çš„å¿«æ·è®°å½•å’ŒAIåˆ†æç»“æœ
- è¯†åˆ«ä¸€è‡´ã€å†²çªã€é—æ¼çš„è§‚å¯Ÿ
- ç”ŸæˆéªŒè¯æŠ¥å‘Šï¼ˆä¸ç›´æ¥ä¿®æ”¹å®¶é•¿è®°å½•ï¼Œå‘ˆç°è¯æ®è®©å®¶é•¿åˆ¤æ–­ï¼‰

**è¾“å…¥**: 
ä¼šè¯IDã€è§†é¢‘æ–‡ä»¶è·¯å¾„ã€å®¶é•¿çš„å¿«æ·è®°å½•

**è¾“å‡º**: 
- è§†é¢‘åˆ†æç»“æœ
- éªŒè¯ç»“æœï¼ˆå·²éªŒè¯çš„è§‚å¯Ÿã€å†²çªåˆ—è¡¨ã€å®¶é•¿é—æ¼çš„è§‚å¯Ÿï¼‰

**è°ƒç”¨å…³ç³»**:
- è°ƒç”¨: AIè§†é¢‘è§£ææ¨¡å—ã€SQLiteæ•°æ®ç®¡ç†æ¨¡å—
- è¢«è°ƒç”¨: LangGraphå·¥ä½œæµ

**ä¾èµ–**: 
AIè§†é¢‘è§£ææ¨¡å—ã€SQLite

---

#### æ¨¡å—12: æ€»ç»“ç”Ÿæˆæ¨¡å—

**èŒè´£**: 
ç”Ÿæˆæ¸¸æˆæ€»ç»“å’Œæ™ºèƒ½åé¦ˆè¡¨

**æ ¸å¿ƒåŠŸèƒ½**:
- èåˆå·²éªŒè¯çš„è§‚å¯Ÿè®°å½•ã€è¯­éŸ³è®°å½•ã€è§†é¢‘åˆ†æç»“æœ
- ç”Ÿæˆåˆæ­¥æ€»ç»“ï¼ˆäº®ç‚¹ã€éœ€è¦å…³æ³¨çš„åœ°æ–¹ï¼‰
- å¯¹æ¯”ä¸Šæ¬¡æ¸¸æˆå’Œå†å²å¹³å‡æ°´å¹³
- åŸºäºåˆæ­¥æ€»ç»“åŠ¨æ€ç”Ÿæˆ3-5ä¸ªåé¦ˆé—®é¢˜
- æ¥æ”¶å®¶é•¿åé¦ˆåï¼Œèåˆæ‰€æœ‰æ•°æ®ç”Ÿæˆæœ€ç»ˆæ€»ç»“
- ç”Ÿæˆå¯è§†åŒ–æ€»ç»“å¡ç‰‡

**è¾“å…¥**: 
- åˆæ­¥æ€»ç»“: ä¼šè¯ID
- åé¦ˆè¡¨ç”Ÿæˆ: åˆæ­¥æ€»ç»“
- æœ€ç»ˆæ€»ç»“: ä¼šè¯IDã€å®¶é•¿åé¦ˆ

**è¾“å‡º**: 
- åˆæ­¥æ€»ç»“
- æ™ºèƒ½åé¦ˆè¡¨ï¼ˆ3-5ä¸ªé—®é¢˜ï¼‰
- æœ€ç»ˆæ€»ç»“ï¼ˆå®Œæ•´çš„æ¸¸æˆæ€»ç»“ã€é‡Œç¨‹ç¢‘æ ‡æ³¨ã€ä¸‹ä¸€æ­¥å»ºè®®ï¼‰

**è°ƒç”¨å…³ç³»**:
- è°ƒç”¨: SQLiteæ•°æ®ç®¡ç†æ¨¡å—ã€Graphitiè®°å¿†ç½‘ç»œæ¨¡å—ï¼ˆè¯»å–å†å²æ•°æ®ï¼‰
- è¢«è°ƒç”¨: LangGraphå·¥ä½œæµ

**ä¾èµ–**: 
SQLiteã€Graphiti

---

#### æ¨¡å—13: è®°å¿†æ›´æ–°æ¨¡å—

**èŒè´£**: 
å°†ä¼šè¯æ•°æ®å†™å…¥Graphitiè®°å¿†ç½‘ç»œ

**æ ¸å¿ƒåŠŸèƒ½**:
- èåˆæ‰€æœ‰ä¼šè¯æ•°æ®ï¼ˆè§‚å¯Ÿè®°å½•ã€è§†é¢‘åˆ†æã€å®¶é•¿åé¦ˆã€æœ€ç»ˆæ€»ç»“ï¼‰
- æ‰¹é‡åˆ›å»ºè®°å¿†èŠ‚ç‚¹ï¼ˆæ¯ä¸ªè§‚å¯Ÿäº‹ä»¶ä¸€ä¸ªèŠ‚ç‚¹ï¼‰
- å»ºç«‹äº‹ä»¶é—´çš„å…³ç³»ï¼ˆå› æœã€æ—¶åºï¼‰
- æ›´æ–°æ—¶åºæŒ‡æ ‡æ•°æ®
- é‡æ–°æ„å»ºå½“å‰ä¸Šä¸‹æ–‡

**è¾“å…¥**: 
ä¼šè¯IDã€ä¼šè¯å®Œæ•´æ•°æ®

**è¾“å‡º**: 
- å†™å…¥æˆåŠŸ/å¤±è´¥çŠ¶æ€
- æ›´æ–°åçš„ä¸Šä¸‹æ–‡æ•°æ®
- æ›´æ–°åçš„æ—¶åºæŒ‡æ ‡

**è°ƒç”¨å…³ç³»**:
- è°ƒç”¨: Graphitiè®°å¿†ç½‘ç»œæ¨¡å—ã€SQLiteæ•°æ®ç®¡ç†æ¨¡å—
- è¢«è°ƒç”¨: LangGraphå·¥ä½œæµ

**ä¾èµ–**: 
Graphitiã€SQLite

**å…³é”®ä¼˜åŒ–**: 
ä½¿ç”¨Graphitiçš„æ‰¹é‡APIï¼Œä¸€æ¬¡æ€§å†™å…¥æ‰€æœ‰èŠ‚ç‚¹å’Œè¾¹ï¼Œå‡å°‘è°ƒç”¨æ¬¡æ•°

---

#### æ¨¡å—14: å†è¯„ä¼°æ¨¡å—

**èŒè´£**: 
åŸºäºæ–°æ•°æ®é‡æ–°è¯„ä¼°å­©å­ï¼Œæ›´æ–°ç”»åƒ

**æ ¸å¿ƒåŠŸèƒ½**:
- ä»Graphitiæ£€æµ‹é‡Œç¨‹ç¢‘äº‹ä»¶
- æ£€æµ‹å¹³å°æœŸï¼ˆè¿ç»­3å‘¨æ— å˜åŒ–ï¼‰
- å¯¹æ¯”åŸºçº¿æ•°æ®ï¼Œç”Ÿæˆè¿›å±•æŠ¥å‘Š
- æ›´æ–°å­©å­ç”»åƒï¼ˆå„ç»´åº¦å½“å‰æ°´å¹³ã€å…´è¶£åå¥½ã€å¹²é¢„é‡ç‚¹ï¼‰
- åˆ¤æ–­æ˜¯å¦éœ€è¦è°ƒæ•´å‘¨è®¡åˆ’

**è¾“å…¥**: 
å­©å­IDã€æ–°ä¼šè¯æ•°æ®

**è¾“å‡º**: 
- é‡Œç¨‹ç¢‘åˆ—è¡¨
- å¹³å°æœŸé¢„è­¦
- æ›´æ–°åçš„å­©å­ç”»åƒ
- ä¸‹ä¸€æ­¥å»ºè®®
- æ˜¯å¦éœ€è¦è°ƒæ•´è®¡åˆ’çš„æ ‡å¿—

**è°ƒç”¨å…³ç³»**:
- è°ƒç”¨: Graphitiè®°å¿†ç½‘ç»œæ¨¡å—ã€SQLiteæ•°æ®ç®¡ç†æ¨¡å—
- è¢«è°ƒç”¨: LangGraphå·¥ä½œæµ

**ä¾èµ–**: 
Graphitiã€SQLite

---

#### æ¨¡å—15: å¯¹è¯åŠ©æ‰‹æ¨¡å—

**èŒè´£**: 
å¤„ç†å®¶é•¿çš„å¯¹è¯æŸ¥è¯¢ï¼Œæä¾›ä¸ªæ€§åŒ–å›ç­”

**æ ¸å¿ƒåŠŸèƒ½**:
- ç†è§£å®¶é•¿çš„é—®é¢˜
- æ ¹æ®é—®é¢˜ç±»å‹è·¯ç”±åˆ°ä¸åŒçŸ¥è¯†æºï¼š
  - ä¸“ä¸šé—®é¢˜ â†’ æŸ¥è¯¢åœ°æ¿æ—¶å…‰ä¸“ä¸šçŸ¥è¯†åº“ï¼ˆRAGï¼‰
  - æ¸¸æˆé—®é¢˜ â†’ æŸ¥è¯¢æ¸¸æˆçŸ¥è¯†åº“ï¼ˆRAGï¼‰
  - å­©å­è¿›æ­¥é—®é¢˜ â†’ æŸ¥è¯¢Graphitiè®°å¿†ç½‘ç»œ
- èåˆå­©å­çš„å®é™…æ•°æ®ç”Ÿæˆä¸ªæ€§åŒ–å›ç­”
- å¼•ç”¨çŸ¥è¯†æ¥æºå’Œç›¸å…³è®°å¿†

**è¾“å…¥**: 
å­©å­IDã€ç”¨æˆ·æ¶ˆæ¯ã€å¯¹è¯å†å²

**è¾“å‡º**: 
å›ç­”æ–‡æœ¬ã€çŸ¥è¯†æ¥æºã€ç›¸å…³è®°å¿†

**è°ƒç”¨å…³ç³»**:
- è°ƒç”¨: æ¸¸æˆçŸ¥è¯†åº“ä¸RAGæ¨¡å—ã€Graphitiè®°å¿†ç½‘ç»œæ¨¡å—ã€SQLiteæ•°æ®ç®¡ç†æ¨¡å—
- è¢«è°ƒç”¨: ç‹¬ç«‹çš„å¯¹è¯APIï¼ˆä¸åœ¨ä¸»å·¥ä½œæµä¸­ï¼‰

**ä¾èµ–**: 
æ¸¸æˆçŸ¥è¯†åº“ã€Graphitiã€SQLite

**è¯´æ˜**: 
å¯¹è¯åŠ©æ‰‹æ˜¯ç‹¬ç«‹æµç¨‹ï¼Œä¸åœ¨ä¸»å·¥ä½œæµä¸­ï¼Œé€šè¿‡ç‹¬ç«‹çš„APIè°ƒç”¨

---

#### æ¨¡å—16: å¯è§†åŒ–ä¸æŠ¥å‘Šæ¨¡å—

**èŒè´£**: 
ç”Ÿæˆå¯è§†åŒ–å›¾è¡¨å’ŒæŠ¥å‘Š

**æ ¸å¿ƒåŠŸèƒ½**:
- ä»SQLiteå’ŒGraphitiè·å–æ•°æ®
- ç”Ÿæˆå¤šç»´åº¦é›·è¾¾å›¾
- ç”Ÿæˆé‡Œç¨‹ç¢‘æ—¶é—´çº¿
- ç”Ÿæˆè¶‹åŠ¿å›¾
- ç”Ÿæˆæ—¥å†çƒ­åŠ›å›¾
- ç”Ÿæˆå®¶é•¿ç‰ˆæŠ¥å‘Šï¼ˆPDFï¼‰
- ç”ŸæˆåŒ»ç”Ÿç‰ˆæŠ¥å‘Šï¼ˆPDFï¼‰

**è¾“å…¥**: 
å­©å­IDã€æ—¶é—´èŒƒå›´ã€æŠ¥å‘Šç±»å‹

**è¾“å‡º**: 
å¯è§†åŒ–æ•°æ®ã€PDFæŠ¥å‘Šæ–‡ä»¶

**è°ƒç”¨å…³ç³»**:
- è°ƒç”¨: SQLiteæ•°æ®ç®¡ç†æ¨¡å—ã€Graphitiè®°å¿†ç½‘ç»œæ¨¡å—
- è¢«è°ƒç”¨: å‰ç«¯é¡µé¢ã€æŠ¥å‘Šç”ŸæˆAPI

**ä¾èµ–**: 
SQLiteã€Graphiti

---

### ç¬¬ä¸‰å±‚: LangGraphå·¥ä½œæµå±‚ï¼ˆ1ä¸ªæ¨¡å—ï¼‰

---

#### æ¨¡å—17: LangGraphä¸»å·¥ä½œæµ

**èŒè´£**: 
ç¼–æ’æ‰€æœ‰ä¸šåŠ¡æ¨¡å—ï¼Œå®ç°å®Œæ•´çš„7æ­¥é—­ç¯æµç¨‹

**æ ¸å¿ƒåŠŸèƒ½**:
- å®šä¹‰Stateç»“æ„ï¼ˆå­©å­ä¿¡æ¯ã€ä¼šè¯æ•°æ®ã€ä¸Šä¸‹æ–‡ã€æŒ‡æ ‡ã€å·¥ä½œæµçŠ¶æ€ï¼‰
- å®šä¹‰èŠ‚ç‚¹ï¼ˆæ¯ä¸ªèŠ‚ç‚¹è°ƒç”¨ä¸€ä¸ªæˆ–å¤šä¸ªä¸šåŠ¡æ¨¡å—ï¼‰
- å®šä¹‰è¾¹ï¼ˆèŠ‚ç‚¹é—´çš„æµè½¬é€»è¾‘ï¼‰
- å®ç°HITLæš‚åœç‚¹ï¼ˆç­‰å¾…å®¶é•¿å¡«å†™åé¦ˆè¡¨ï¼‰
- å®ç°Checkpointæœºåˆ¶ï¼ˆæ”¯æŒæš‚åœå’Œæ¢å¤ï¼‰
- å®ç°æ¡ä»¶è·¯ç”±ï¼ˆå¦‚æ˜¯å¦ä¸Šä¼ è§†é¢‘ã€æ˜¯å¦éœ€è¦è°ƒæ•´è®¡åˆ’ï¼‰

**ä¸»è¦æµç¨‹**:
```
1. åˆå§‹è¯„ä¼° â†’ æ„å»ºç”»åƒ
2. ç”Ÿæˆå‘¨è®¡åˆ’ â†’ åŠ å…¥æ—¥å†
3. å¼€å§‹æ¸¸æˆ â†’ å®æ—¶æŒ‡å¼• â†’ è§‚å¯Ÿæ•è·
4. ç»“æŸæ¸¸æˆ â†’ è§†é¢‘åˆ†æï¼ˆå¯é€‰ï¼‰â†’ è§‚å¯ŸéªŒè¯
5. ç”Ÿæˆåˆæ­¥æ€»ç»“ â†’ ç”Ÿæˆåé¦ˆè¡¨
6. [HITLæš‚åœ] ç­‰å¾…å®¶é•¿å¡«å†™åé¦ˆ
7. ç”Ÿæˆæœ€ç»ˆæ€»ç»“ â†’ è®°å¿†æ›´æ–° â†’ å†è¯„ä¼°
8. åˆ¤æ–­æ˜¯å¦éœ€è¦è°ƒæ•´ â†’ è¿”å›æ­¥éª¤2æˆ–ç»“æŸ
```

**Stateç®¡ç†**:
- å­©å­ç”»åƒï¼ˆä»SQLiteåŠ è½½ï¼Œç¼“å­˜åœ¨Stateï¼‰
- å½“å‰ä¼šè¯æ•°æ®ï¼ˆå®æ—¶æ›´æ–°ï¼‰
- Graphitiä¸Šä¸‹æ–‡ï¼ˆä»GraphitiåŠ è½½ï¼Œç¼“å­˜åœ¨Stateï¼Œé¿å…é‡å¤æŸ¥è¯¢ï¼‰
- æ—¶åºæŒ‡æ ‡ï¼ˆä»GraphitiåŠ è½½ï¼Œç¼“å­˜åœ¨Stateï¼‰
- ä¼šè¯å†å²ï¼ˆä»SQLiteåŠ è½½ï¼Œç¼“å­˜åœ¨Stateï¼‰
- å·¥ä½œæµæ§åˆ¶ä¿¡æ¯ï¼ˆå½“å‰èŠ‚ç‚¹ã€æ˜¯å¦æš‚åœã€Checkpoint IDï¼‰

**è°ƒç”¨å…³ç³»**:
- è°ƒç”¨: æ‰€æœ‰ä¸šåŠ¡é€»è¾‘å±‚æ¨¡å—
- è¢«è°ƒç”¨: å‰ç«¯API

**ä¾èµ–**: 
æ‰€æœ‰ä¸šåŠ¡é€»è¾‘å±‚æ¨¡å—

**å…³é”®è®¾è®¡**:
- å°½é‡å°‘çš„function call: ä¼˜å…ˆä½¿ç”¨Stateä¸­å·²æœ‰çš„æ•°æ®
- å¤šç”¨Stateæ•°æ®: é¿å…é‡å¤æŸ¥è¯¢Graphitiå’ŒSQLite
- Graphitiå†™å…¥ç­–ç•¥: ä»…åœ¨è®°å¿†æ›´æ–°èŠ‚ç‚¹ç»Ÿä¸€å†™å…¥ï¼Œè€Œéå¤šæ¬¡è°ƒç”¨

---


## 3. æ¨¡å—è°ƒç”¨å…³ç³»å›¾

### 3.1 æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç¬¬ä¸‰å±‚: LangGraphå·¥ä½œæµå±‚                      â”‚
â”‚                                                                 â”‚
â”‚                   æ¨¡å—17: LangGraphä¸»å·¥ä½œæµ                      â”‚
â”‚                  (ç¼–æ’æ‰€æœ‰æ¨¡å—ï¼Œå®ç°7æ­¥é—­ç¯)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â”‚ è°ƒç”¨æ‰€æœ‰ä¸šåŠ¡æ¨¡å—
                             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ç¬¬äºŒå±‚: ä¸šåŠ¡é€»è¾‘å±‚                          â”‚
â”‚                                                                 â”‚
â”‚  æ¨¡å—7: åˆå§‹è¯„ä¼°        æ¨¡å—8: å‘¨è®¡åˆ’æ¨è      æ¨¡å—9: å®æ—¶æŒ‡å¼•   â”‚
â”‚  æ¨¡å—10: è§‚å¯Ÿæ•è·       æ¨¡å—11: è§†é¢‘åˆ†æéªŒè¯   æ¨¡å—12: æ€»ç»“ç”Ÿæˆ  â”‚
â”‚  æ¨¡å—13: è®°å¿†æ›´æ–°       æ¨¡å—14: å†è¯„ä¼°         æ¨¡å—15: å¯¹è¯åŠ©æ‰‹  â”‚
â”‚  æ¨¡å—16: å¯è§†åŒ–æŠ¥å‘Š                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â”‚ è°ƒç”¨åŸºç¡€è®¾æ–½
                             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ç¬¬ä¸€å±‚: åŸºç¡€è®¾æ–½å±‚                           â”‚
â”‚                                                                 â”‚
â”‚  æ¨¡å—1: SQLiteæ•°æ®ç®¡ç†    æ¨¡å—2: Graphitiè®°å¿†ç½‘ç»œ               â”‚
â”‚  æ¨¡å—3: çŸ¥è¯†åº“RAG          æ¨¡å—4: AIè§†é¢‘è§£æ                     â”‚
â”‚  æ¨¡å—5: è¯­éŸ³å¤„ç†           æ¨¡å—6: æ–‡æ¡£è§£æ                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 3.2 è¯¦ç»†è°ƒç”¨å…³ç³»

#### åˆå§‹è¯„ä¼°æµç¨‹

```
LangGraphå·¥ä½œæµ
    â†“
æ¨¡å—7: åˆå§‹è¯„ä¼°
    â”œâ†’ æ¨¡å—6: æ–‡æ¡£è§£æ (è§£ææŠ¥å‘Š/é‡è¡¨)
    â””â†’ æ¨¡å—1: SQLite (ä¿å­˜ç”»åƒ)
```

---

#### å‘¨è®¡åˆ’æ¨èæµç¨‹

```
LangGraphå·¥ä½œæµ
    â†“
æ¨¡å—8: å‘¨è®¡åˆ’æ¨è
    â”œâ†’ æ¨¡å—1: SQLite (è·å–å­©å­ç”»åƒ)
    â”œâ†’ æ¨¡å—2: Graphiti (è·å–è¶‹åŠ¿å’Œå…³æ³¨ç‚¹)
    â”œâ†’ æ¨¡å—3: çŸ¥è¯†åº“RAG (æ£€ç´¢æ¸¸æˆçŸ¥è¯†åº“å±‚)
    â””â†’ æ¨¡å—1: SQLite (ä¿å­˜å‘¨è®¡åˆ’)
```

---

#### æ¸¸æˆå®æ–½æµç¨‹

```
LangGraphå·¥ä½œæµ
    â†“
æ¨¡å—9: å®æ—¶æŒ‡å¼•
    â”œâ†’ æ¨¡å—3: çŸ¥è¯†åº“RAG (æ£€ç´¢æ¸¸æˆçŸ¥è¯†åº“å±‚+æ–¹æ³•è®ºçŸ¥è¯†åº“å±‚)
    â””â†’ æ¨¡å—5: è¯­éŸ³å¤„ç† (ç”Ÿæˆè¯­éŸ³æŒ‡å¼•)

åŒæ—¶å¹¶è¡Œ:

æ¨¡å—10: è§‚å¯Ÿæ•è·
    â”œâ†’ æ¨¡å—5: è¯­éŸ³å¤„ç† (è¯­éŸ³è½¬æ–‡å­—)
    â””â†’ æ¨¡å—1: SQLite (ä¿å­˜è§‚å¯Ÿè®°å½•)
```

---

#### è§†é¢‘åˆ†ææµç¨‹

```
LangGraphå·¥ä½œæµ
    â†“
æ¨¡å—11: è§†é¢‘åˆ†æä¸éªŒè¯
    â”œâ†’ æ¨¡å—4: AIè§†é¢‘è§£æ (åˆ†æè§†é¢‘)
    â”œâ†’ æ¨¡å—1: SQLite (è·å–å¿«æ·è®°å½•)
    â””â†’ æ¨¡å—1: SQLite (ä¿å­˜éªŒè¯ç»“æœ)
```

---

#### æ€»ç»“ç”Ÿæˆæµç¨‹

```
LangGraphå·¥ä½œæµ
    â†“
æ¨¡å—12: æ€»ç»“ç”Ÿæˆ
    â”œâ†’ æ¨¡å—1: SQLite (è·å–ä¼šè¯æ•°æ®)
    â”œâ†’ æ¨¡å—2: Graphiti (è·å–å†å²æ•°æ®ï¼Œä»Stateè¯»å–)
    â””â†’ æ¨¡å—1: SQLite (ä¿å­˜æ€»ç»“)
```

---

#### è®°å¿†æ›´æ–°æµç¨‹

```
LangGraphå·¥ä½œæµ
    â†“
æ¨¡å—13: è®°å¿†æ›´æ–°
    â”œâ†’ æ¨¡å—1: SQLite (è·å–ä¼šè¯å®Œæ•´æ•°æ®)
    â”œâ†’ æ¨¡å—2: Graphiti (æ‰¹é‡å†™å…¥è®°å¿†èŠ‚ç‚¹å’Œå…³ç³»)
    â””â†’ æ¨¡å—2: Graphiti (é‡æ–°æ„å»ºä¸Šä¸‹æ–‡)
```

---

#### å†è¯„ä¼°æµç¨‹

```
LangGraphå·¥ä½œæµ
    â†“
æ¨¡å—14: å†è¯„ä¼°
    â”œâ†’ æ¨¡å—2: Graphiti (æ£€æµ‹é‡Œç¨‹ç¢‘ã€å¹³å°æœŸ)
    â”œâ†’ æ¨¡å—1: SQLite (è·å–åŸºçº¿æ•°æ®)
    â””â†’ æ¨¡å—1: SQLite (æ›´æ–°ç”»åƒ)
```

---

#### å¯¹è¯åŠ©æ‰‹æµç¨‹ï¼ˆç‹¬ç«‹ï¼‰

```
å‰ç«¯å¯¹è¯API
    â†“
æ¨¡å—15: å¯¹è¯åŠ©æ‰‹
    â”œâ†’ æ¨¡å—3: çŸ¥è¯†åº“RAG (è·¨å±‚æ£€ç´¢: æ–¹æ³•è®º/æ¸¸æˆ/é‡è¡¨çŸ¥è¯†åº“)
    â”œâ†’ æ¨¡å—2: Graphiti (æŸ¥è¯¢å­©å­è®°å¿†)
    â””â†’ æ¨¡å—1: SQLite (è·å–å­©å­ç”»åƒ)
```

---

#### å¯è§†åŒ–æŠ¥å‘Šæµç¨‹ï¼ˆç‹¬ç«‹ï¼‰

```
å‰ç«¯é¡µé¢/æŠ¥å‘ŠAPI
    â†“
æ¨¡å—16: å¯è§†åŒ–ä¸æŠ¥å‘Š
    â”œâ†’ æ¨¡å—1: SQLite (è·å–ä¼šè¯æ•°æ®ã€å‘¨è®¡åˆ’)
    â””â†’ æ¨¡å—2: Graphiti (è·å–æ—¶åºæ•°æ®ã€é‡Œç¨‹ç¢‘)
```

---

### 3.3 æ¨¡å—ä¾èµ–çŸ©é˜µ

| æ¨¡å— | ä¾èµ–çš„æ¨¡å— |
|------|-----------|
| æ¨¡å—1: SQLite | æ—  |
| æ¨¡å—2: Graphiti | æ—  |
| æ¨¡å—3: çŸ¥è¯†åº“RAG | æ—  |
| æ¨¡å—4: AIè§†é¢‘è§£æ | æ—  |
| æ¨¡å—5: è¯­éŸ³å¤„ç† | æ—  |
| æ¨¡å—6: æ–‡æ¡£è§£æ | æ—  |
| æ¨¡å—7: åˆå§‹è¯„ä¼° | æ¨¡å—1, æ¨¡å—6 |
| æ¨¡å—8: å‘¨è®¡åˆ’æ¨è | æ¨¡å—1, æ¨¡å—2, æ¨¡å—3 |
| æ¨¡å—9: å®æ—¶æŒ‡å¼• | æ¨¡å—3, æ¨¡å—5 |
| æ¨¡å—10: è§‚å¯Ÿæ•è· | æ¨¡å—1, æ¨¡å—5 |
| æ¨¡å—11: è§†é¢‘åˆ†æéªŒè¯ | æ¨¡å—1, æ¨¡å—4 |
| æ¨¡å—12: æ€»ç»“ç”Ÿæˆ | æ¨¡å—1, æ¨¡å—2 |
| æ¨¡å—13: è®°å¿†æ›´æ–° | æ¨¡å—1, æ¨¡å—2 |
| æ¨¡å—14: å†è¯„ä¼° | æ¨¡å—1, æ¨¡å—2 |
| æ¨¡å—15: å¯¹è¯åŠ©æ‰‹ | æ¨¡å—1, æ¨¡å—2, æ¨¡å—3 |
| æ¨¡å—16: å¯è§†åŒ–æŠ¥å‘Š | æ¨¡å—1, æ¨¡å—2 |
| æ¨¡å—17: LangGraphå·¥ä½œæµ | æ¨¡å—7-16 |

---

## 4. å¼€å‘é¡ºåºä¸å¹¶è¡Œç­–ç•¥ï¼ˆé¢å‘æ¥å£ï¼‰

### 4.1 æ–°çš„å¼€å‘ç­–ç•¥

#### ç¬¬1å‘¨ï¼šæ¥å£å®šä¹‰ + å…¨Mock + LangGraphæ¡†æ¶

**ç›®æ ‡**: è·‘é€šå®Œæ•´æµç¨‹ï¼ˆå…¨Mockï¼‰

**ä»»åŠ¡**:
1. å®šä¹‰æ‰€æœ‰17ä¸ªæ¨¡å—çš„æ¥å£ï¼ˆPython ABCæŠ½è±¡åŸºç±»ï¼‰
2. å®ç°æ‰€æœ‰æ¨¡å—çš„Mockç‰ˆæœ¬
3. æ­å»ºLangGraphåŸºç¡€æ¡†æ¶
4. å®ç°ä¾èµ–æ³¨å…¥å®¹å™¨
5. å®ç°æ ¸å¿ƒèŠ‚ç‚¹ï¼ˆè°ƒç”¨æ¥å£ï¼‰
6. è·‘é€šå®Œæ•´7æ­¥é—­ç¯ï¼ˆå…¨Mockæ•°æ®ï¼‰

**æˆæœ**: 
- ä¸€ä¸ªèƒ½è·‘çš„å®Œæ•´ç³»ç»Ÿï¼ˆè™½ç„¶éƒ½æ˜¯å‡æ•°æ®ï¼‰
- éªŒè¯äº†æ¶æ„è®¾è®¡
- å›¢é˜Ÿå¯¹æµç¨‹æœ‰æ¸…æ™°è®¤è¯†

**å¹¶è¡Œå¼€å‘**:
- 1äººï¼šå®šä¹‰æ¥å£ + æ­å»ºæ¡†æ¶
- 2-3äººï¼šå®ç°Mockæ¨¡å—

---

#### ç¬¬2-4å‘¨ï¼šæ›¿æ¢ç¬¬ä¸€æ‰¹çœŸå®å®ç°

**ç›®æ ‡**: æ ¸å¿ƒåŠŸèƒ½å¯ç”¨

**ä¼˜å…ˆæ›¿æ¢**:
- âœ… æ¨¡å—1: SQLiteçœŸå®å®ç°ï¼ˆLangGraph Checkpointéœ€è¦ï¼‰
- âœ… æ¨¡å—6: æ–‡æ¡£è§£æçœŸå®å®ç°ï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼‰
- âœ… æ¨¡å—3: RAGçœŸå®å®ç°ï¼ˆè‡³å°‘æ¸¸æˆåº“ï¼‰
- âœ… æ¨¡å—7: åˆå§‹è¯„ä¼°çœŸå®å®ç°

**ä¿æŒMock**:
- æ¨¡å—2: Graphitiï¼ˆæš‚æ—¶ç”¨SQLiteå­˜å†å²ï¼‰
- æ¨¡å—4: è§†é¢‘åˆ†æï¼ˆå…ˆè·³è¿‡ï¼‰
- æ¨¡å—5: è¯­éŸ³å¤„ç†ï¼ˆå…ˆç”¨æ–‡å­—ï¼‰
- å…¶ä»–ä¸šåŠ¡æ¨¡å—

**æˆæœ**: 
- èƒ½çœŸå®ä¸Šä¼ æŠ¥å‘Šå¹¶ç”Ÿæˆç”»åƒ
- èƒ½çœŸå®æ£€ç´¢æ¸¸æˆå¹¶ç”Ÿæˆå‘¨è®¡åˆ’

**å¹¶è¡Œå¼€å‘**:
- æ¡†æ¶ç»„ï¼šç»§ç»­å®Œå–„LangGraph
- æ¨¡å—ç»„ï¼š4ä¸ªæ¨¡å—å¯å¹¶è¡Œå¼€å‘

---

#### ç¬¬5-8å‘¨ï¼šæ›¿æ¢ç¬¬äºŒæ‰¹çœŸå®å®ç°

**ç›®æ ‡**: æ¸¸æˆæµç¨‹å¯ç”¨

**ä¼˜å…ˆæ›¿æ¢**:
- âœ… æ¨¡å—5: è¯­éŸ³å¤„ç†çœŸå®å®ç°
- âœ… æ¨¡å—8: å‘¨è®¡åˆ’æ¨èçœŸå®å®ç°
- âœ… æ¨¡å—9: å®æ—¶æŒ‡å¼•çœŸå®å®ç°
- âœ… æ¨¡å—10: è§‚å¯Ÿæ•è·çœŸå®å®ç°
- âœ… æ¨¡å—12: æ€»ç»“ç”ŸæˆçœŸå®å®ç°

**ä¿æŒMock**:
- æ¨¡å—2: Graphitiï¼ˆç»§ç»­Mockï¼‰
- æ¨¡å—4: è§†é¢‘åˆ†æï¼ˆç»§ç»­Mockï¼‰
- æ¨¡å—11: è§†é¢‘éªŒè¯ï¼ˆç»§ç»­Mockï¼‰

**æˆæœ**: 
- èƒ½å®Œæ•´ç©ä¸€æ¬¡æ¸¸æˆ
- èƒ½è¯­éŸ³è®°å½•è§‚å¯Ÿ
- èƒ½ç”Ÿæˆæ€»ç»“

**å¹¶è¡Œå¼€å‘**:
- 5ä¸ªæ¨¡å—å¯å¹¶è¡Œå¼€å‘

---

#### ç¬¬9-12å‘¨ï¼šæ›¿æ¢ç¬¬ä¸‰æ‰¹çœŸå®å®ç°

**ç›®æ ‡**: å®Œæ•´é—­ç¯

**ä¼˜å…ˆæ›¿æ¢**:
- âœ… æ¨¡å—2: GraphitiçœŸå®å®ç°
- âœ… æ¨¡å—13: è®°å¿†æ›´æ–°çœŸå®å®ç°
- âœ… æ¨¡å—14: å†è¯„ä¼°çœŸå®å®ç°

**ä¿æŒMock**:
- æ¨¡å—4: è§†é¢‘åˆ†æï¼ˆæœ€åå®ç°ï¼‰
- æ¨¡å—11: è§†é¢‘éªŒè¯ï¼ˆæœ€åå®ç°ï¼‰

**æˆæœ**: 
- å®Œæ•´çš„7æ­¥é—­ç¯
- é•¿æœŸè®°å¿†å’Œè¶‹åŠ¿åˆ†æ
- é‡Œç¨‹ç¢‘æ£€æµ‹

**å¹¶è¡Œå¼€å‘**:
- 3ä¸ªæ¨¡å—å¯å¹¶è¡Œå¼€å‘

---

#### ç¬¬13-16å‘¨ï¼šæ›¿æ¢æœ€åçš„çœŸå®å®ç°

**ç›®æ ‡**: å…¨åŠŸèƒ½

**ä¼˜å…ˆæ›¿æ¢**:
- âœ… æ¨¡å—4: è§†é¢‘åˆ†æçœŸå®å®ç°
- âœ… æ¨¡å—11: è§†é¢‘éªŒè¯çœŸå®å®ç°
- âœ… æ¨¡å—15: å¯¹è¯åŠ©æ‰‹çœŸå®å®ç°
- âœ… æ¨¡å—16: å¯è§†åŒ–æŠ¥å‘ŠçœŸå®å®ç°

**æˆæœ**: 
- æ‰€æœ‰åŠŸèƒ½å®Œæ•´
- è§†é¢‘åˆ†æå¯ç”¨
- å¯¹è¯åŠ©æ‰‹å¯ç”¨

---

### 4.2 ä¾èµ–æ³¨å…¥ä¸é…ç½®åˆ‡æ¢

#### æœåŠ¡å®¹å™¨

```python
# services/container.py
from typing import Dict, Any

class ServiceContainer:
    _instance = None

    def __new__(cls):
        if cls._instance is None:
            cls._instance = super().__new__(cls)
            cls._instance._services: Dict[str, Any] = {}
        return cls._instance

    def register(self, name: str, implementation: Any) -> None:
        self._services[name] = implementation

    def get(self, name: str) -> Any:
        return self._services.get(name)

container = ServiceContainer()
```

#### ç¯å¢ƒé…ç½®

```python
# app/config.py
from pydantic_settings import BaseSettings

class Settings(BaseSettings):
    SQLITE_MODE: str = "mock"  # "mock" | "real"
    GRAPHITI_MODE: str = "mock"
    RAG_MODE: str = "mock"
    VIDEO_MODE: str = "mock"
    SPEECH_MODE: str = "mock"
    DOCUMENT_MODE: str = "mock"
    LLM_MODE: str = "mock"

    class Config:
        env_file = ".env"

settings = Settings()
```

#### æœåŠ¡å·¥å‚

```python
# services/factory.py
from app.config import settings
from services.mock.sqlite_mock import SQLiteMock
from services.impl.sqlite_impl import SQLiteImpl

def create_sqlite_service() -> ISQLiteService:
    if settings.SQLITE_MODE == "real":
        return SQLiteImpl()
    return SQLiteMock()

# åˆå§‹åŒ–
container.register("sqlite_service", create_sqlite_service())
```

#### ä½¿ç”¨æ–¹å¼

```bash
# å…¨éƒ¨ä½¿ç”¨Mockï¼ˆç¬¬1å‘¨ï¼‰
npm run dev

# ä½¿ç”¨çœŸå®SQLiteå’ŒRAGï¼ˆç¬¬2-4å‘¨ï¼‰
USE_REAL_SQLITE=true USE_REAL_RAG=true npm run dev

# é€æ­¥å¢åŠ çœŸå®æ¨¡å—ï¼ˆç¬¬5-16å‘¨ï¼‰
USE_REAL_SQLITE=true USE_REAL_RAG=true USE_REAL_SPEECH=true npm run dev
```

---

### 4.3 LangGraphèŠ‚ç‚¹è°ƒç”¨æ¥å£

**å…³é”®**: èŠ‚ç‚¹åªä¾èµ–æ¥å£ï¼Œä¸ä¾èµ–å…·ä½“å®ç°

```python
# graph/nodes/assessment.py
from services.container import container

async def assessment_node(state: dict) -> dict:
    # ä»å®¹å™¨è·å–æœåŠ¡ï¼ˆå¯èƒ½æ˜¯Mockï¼Œä¹Ÿå¯èƒ½æ˜¯çœŸå®ï¼‰
    document_parser = container.get("document_parser")
    assessment_service = container.get("assessment_service")
    sqlite_service = container.get("sqlite_service")

    # è°ƒç”¨æ¥å£æ–¹æ³•
    parsed_report = await document_parser.parse_report(state["report_path"], "pdf")
    portrait = await assessment_service.build_portrait(parsed_report)
    await sqlite_service.save_child({**state["child_profile"], "portrait": portrait})

    return {
        "child_profile": {**state["child_profile"], "portrait": portrait},
        "current_step": "weekly_plan"
    }
```

**ä¼˜åŠ¿**:
- èŠ‚ç‚¹ä»£ç ä¸éœ€è¦ä¿®æ”¹
- é€šè¿‡é…ç½®åˆ‡æ¢Mock/çœŸå®
- æ˜“äºæµ‹è¯•å’Œè°ƒè¯•

---

### 4.4 å¼€å‘æ—¶é—´çº¿ï¼ˆä¿®è®¢ç‰ˆï¼‰

```
æœˆä»½        Week 1    Week 2    Week 3    Week 4
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ç¬¬1ä¸ªæœˆ     [æ¥å£å®šä¹‰ + å…¨Mock + æ¡†æ¶æ­å»º]
                      [æ›¿æ¢SQLite + æ–‡æ¡£è§£æ + RAG]

ç¬¬2ä¸ªæœˆ     [æ›¿æ¢è¯„ä¼° + å‘¨è®¡åˆ’]
                      [æ›¿æ¢è¯­éŸ³ + æŒ‡å¼• + è§‚å¯Ÿ + æ€»ç»“]

ç¬¬3ä¸ªæœˆ     [ç»§ç»­æ›¿æ¢ä¸šåŠ¡æ¨¡å—]
                      [æ›¿æ¢Graphiti + è®°å¿† + å†è¯„ä¼°]

ç¬¬4ä¸ªæœˆ     [æ›¿æ¢è§†é¢‘åˆ†æ + å¯¹è¯åŠ©æ‰‹ + å¯è§†åŒ–]
                      [å®Œå–„å’Œä¼˜åŒ–]

ç¬¬5ä¸ªæœˆ     [å‰ç«¯å¼€å‘ - 4ä¸ªé¡µé¢å¹¶è¡Œ]

ç¬¬6ä¸ªæœˆ     [é›†æˆæµ‹è¯•ä¸ä¼˜åŒ–]
```

---

### 4.5 å…³é”®è·¯å¾„åˆ†æï¼ˆä¿®è®¢ç‰ˆï¼‰

**æ–°çš„å…³é”®è·¯å¾„**:

```
Week 1: æ¥å£å®šä¹‰ + å…¨Mock â†’ èƒ½è·‘
    â†“
Week 2-4: æ›¿æ¢3ä¸ªæ ¸å¿ƒæ¨¡å— â†’ èƒ½ç”¨
    â†“
Week 5-8: æ›¿æ¢5ä¸ªé‡è¦æ¨¡å— â†’ èƒ½ç©
    â†“
Week 9-12: æ›¿æ¢3ä¸ªå®Œå–„æ¨¡å— â†’ å®Œæ•´é—­ç¯
    â†“
Week 13-16: æ›¿æ¢4ä¸ªé”¦ä¸Šæ·»èŠ±æ¨¡å— â†’ å…¨åŠŸèƒ½
    â†“
Week 17-20: å‰ç«¯å¼€å‘
    â†“
Week 21-24: æµ‹è¯•ä¸Šçº¿
```

**å¹¶è¡Œæœºä¼š**:
- Week 1: æ¥å£å®šä¹‰å’ŒMockå®ç°å¯å¹¶è¡Œ
- Week 2-4: 3ä¸ªæ ¸å¿ƒæ¨¡å—å¯å¹¶è¡Œå¼€å‘
- Week 5-8: 5ä¸ªé‡è¦æ¨¡å—å¯å¹¶è¡Œå¼€å‘
- Week 9-12: 3ä¸ªå®Œå–„æ¨¡å—å¯å¹¶è¡Œå¼€å‘
- Week 13-16: 4ä¸ªé”¦ä¸Šæ·»èŠ±æ¨¡å—å¯å¹¶è¡Œå¼€å‘

**é£é™©æ§åˆ¶**:
- æ¯å‘¨éƒ½æœ‰å¯è¿è¡Œçš„ç‰ˆæœ¬
- éšæ—¶å¯ä»¥å›é€€åˆ°Mock
- é™ä½æŠ€æœ¯é£é™©
- æé«˜å›¢é˜Ÿå£«æ°”

---

## 5. LangGraphé›†æˆæ–¹æ¡ˆ

### 5.1 Stateç»“æ„è®¾è®¡

**Stateæ˜¯æ•´ä¸ªå·¥ä½œæµçš„æ ¸å¿ƒæ•°æ®ç»“æ„ï¼ŒåŒ…å«ä»¥ä¸‹éƒ¨åˆ†**:

#### å­©å­ä¿¡æ¯
- å­©å­ID
- å­©å­ç”»åƒï¼ˆä»SQLiteåŠ è½½ï¼ŒåŒ…å«6å¤§ç»´åº¦ã€ä¼˜åŠ¿ã€çŸ­æ¿ã€å…´è¶£ç­‰ï¼‰

#### å½“å‰ä¼šè¯
- ä¼šè¯ID
- æ¸¸æˆID
- ä¼šè¯çŠ¶æ€ï¼ˆæœªå¼€å§‹ã€è¿›è¡Œä¸­ã€å·²ç»“æŸã€åˆ†æä¸­ï¼‰
- å¼€å§‹æ—¶é—´ã€ç»“æŸæ—¶é—´
- å¿«æ·è§‚å¯Ÿè®°å½•åˆ—è¡¨
- è¯­éŸ³è§‚å¯Ÿè®°å½•åˆ—è¡¨
- æ˜¯å¦æœ‰è§†é¢‘
- è§†é¢‘åˆ†æç»“æœï¼ˆå¦‚æœæœ‰ï¼‰
- å·²éªŒè¯çš„è§‚å¯Ÿè®°å½•ï¼ˆå¦‚æœæœ‰ï¼‰
- åˆæ­¥æ€»ç»“ï¼ˆå¦‚æœæœ‰ï¼‰
- åé¦ˆè¡¨ï¼ˆå¦‚æœæœ‰ï¼‰
- å®¶é•¿åé¦ˆï¼ˆå¦‚æœæœ‰ï¼‰
- æœ€ç»ˆæ€»ç»“ï¼ˆå¦‚æœæœ‰ï¼‰
- å½’æ¡£æ•°æ®ï¼ˆå¦‚æœæœ‰ï¼‰

#### Graphitiä¸Šä¸‹æ–‡ï¼ˆç¼“å­˜ï¼‰
- å„ç»´åº¦çš„è¶‹åŠ¿åˆ†æ
- é‡Œç¨‹ç¢‘åˆ—è¡¨
- å…³æ³¨ç‚¹åˆ—è¡¨
- æœ€è¿‘è®°å¿†
- æœ€åæ›´æ–°æ—¶é—´

#### æ—¶åºæŒ‡æ ‡ï¼ˆç¼“å­˜ï¼‰
- å„ç»´åº¦çš„æŒ‡æ ‡æ•°æ®ç‚¹
- æœ€åæ›´æ–°æ—¶é—´

#### ä¼šè¯å†å²ï¼ˆç¼“å­˜ï¼‰
- å†å²ä¼šè¯åˆ—è¡¨

#### å‘¨è®¡åˆ’
- å½“å‰å‘¨è®¡åˆ’ï¼ˆå¦‚æœæœ‰ï¼‰

#### å¯¹è¯å†å²
- å¯¹è¯æ¶ˆæ¯åˆ—è¡¨

#### å·¥ä½œæµæ§åˆ¶
- å½“å‰èŠ‚ç‚¹åç§°
- ä¸‹ä¸€ä¸ªèŠ‚ç‚¹åç§°
- æ˜¯å¦HITLæš‚åœ
- Checkpoint ID

---

### 5.2 ä¸»å·¥ä½œæµè®¾è®¡

**å·¥ä½œæµæ˜¯ä¸€ä¸ªæœ‰å‘å›¾ï¼ŒåŒ…å«ä»¥ä¸‹èŠ‚ç‚¹å’Œè¾¹**:

#### èŠ‚ç‚¹åˆ—è¡¨

1. **è¯„ä¼°èŠ‚ç‚¹**: è°ƒç”¨æ¨¡å—7ï¼ˆåˆå§‹è¯„ä¼°ï¼‰
2. **å‘¨è®¡åˆ’ç”ŸæˆèŠ‚ç‚¹**: è°ƒç”¨æ¨¡å—8ï¼ˆå‘¨è®¡åˆ’æ¨èï¼‰
3. **æ¸¸æˆå¼€å§‹èŠ‚ç‚¹**: åˆ›å»ºä¼šè¯ï¼Œåˆå§‹åŒ–ä¼šè¯æ•°æ®
4. **æ¸¸æˆæŒ‡å¼•èŠ‚ç‚¹**: è°ƒç”¨æ¨¡å—9ï¼ˆå®æ—¶æŒ‡å¼•ï¼‰
5. **æ¸¸æˆç»“æŸèŠ‚ç‚¹**: æ ‡è®°ä¼šè¯ç»“æŸ
6. **è§†é¢‘ä¸Šä¼ èŠ‚ç‚¹**: ç­‰å¾…å®¶é•¿ä¸Šä¼ è§†é¢‘ï¼ˆå¯é€‰ï¼‰
7. **è§†é¢‘åˆ†æèŠ‚ç‚¹**: è°ƒç”¨æ¨¡å—11ï¼ˆè§†é¢‘åˆ†æä¸éªŒè¯ï¼‰
8. **è§‚å¯ŸéªŒè¯èŠ‚ç‚¹**: éªŒè¯å¿«æ·è®°å½•
9. **åˆæ­¥æ€»ç»“èŠ‚ç‚¹**: è°ƒç”¨æ¨¡å—12ï¼ˆç”Ÿæˆåˆæ­¥æ€»ç»“ï¼‰
10. **åé¦ˆè¡¨ç”ŸæˆèŠ‚ç‚¹**: è°ƒç”¨æ¨¡å—12ï¼ˆç”Ÿæˆåé¦ˆè¡¨ï¼‰
11. **HITLæš‚åœèŠ‚ç‚¹**: ç­‰å¾…å®¶é•¿å¡«å†™åé¦ˆè¡¨
12. **æœ€ç»ˆæ€»ç»“èŠ‚ç‚¹**: è°ƒç”¨æ¨¡å—12ï¼ˆç”Ÿæˆæœ€ç»ˆæ€»ç»“ï¼‰
13. **è®°å¿†æ›´æ–°èŠ‚ç‚¹**: è°ƒç”¨æ¨¡å—13ï¼ˆè®°å¿†æ›´æ–°ï¼‰
14. **å†è¯„ä¼°èŠ‚ç‚¹**: è°ƒç”¨æ¨¡å—14ï¼ˆå†è¯„ä¼°ï¼‰

#### è¾¹çš„æµè½¬é€»è¾‘

```
è¯„ä¼°èŠ‚ç‚¹ â†’ å‘¨è®¡åˆ’ç”ŸæˆèŠ‚ç‚¹ â†’ æ¸¸æˆå¼€å§‹èŠ‚ç‚¹ â†’ æ¸¸æˆæŒ‡å¼•èŠ‚ç‚¹ â†’ æ¸¸æˆç»“æŸèŠ‚ç‚¹

æ¸¸æˆç»“æŸèŠ‚ç‚¹ â†’ [æ¡ä»¶åˆ¤æ–­]
    - å¦‚æœæœ‰è§†é¢‘ â†’ è§†é¢‘åˆ†æèŠ‚ç‚¹ â†’ è§‚å¯ŸéªŒè¯èŠ‚ç‚¹
    - å¦‚æœæ— è§†é¢‘ â†’ åˆæ­¥æ€»ç»“èŠ‚ç‚¹

è§‚å¯ŸéªŒè¯èŠ‚ç‚¹ â†’ åˆæ­¥æ€»ç»“èŠ‚ç‚¹

åˆæ­¥æ€»ç»“èŠ‚ç‚¹ â†’ åé¦ˆè¡¨ç”ŸæˆèŠ‚ç‚¹ â†’ HITLæš‚åœèŠ‚ç‚¹

HITLæš‚åœèŠ‚ç‚¹ â†’ æœ€ç»ˆæ€»ç»“èŠ‚ç‚¹ â†’ è®°å¿†æ›´æ–°èŠ‚ç‚¹ â†’ å†è¯„ä¼°èŠ‚ç‚¹

å†è¯„ä¼°èŠ‚ç‚¹ â†’ [æ¡ä»¶åˆ¤æ–­]
    - å¦‚æœéœ€è¦è°ƒæ•´è®¡åˆ’ â†’ å‘¨è®¡åˆ’ç”ŸæˆèŠ‚ç‚¹
    - å¦‚æœä¸éœ€è¦è°ƒæ•´ â†’ ç»“æŸ
```

---

### 5.3 HITLæš‚åœæœºåˆ¶

**ç›®çš„**: åœ¨éœ€è¦å®¶é•¿è¾“å…¥æ—¶æš‚åœå·¥ä½œæµ

**å®ç°æ–¹å¼**:
1. å·¥ä½œæµæ‰§è¡Œåˆ°HITLæš‚åœèŠ‚ç‚¹æ—¶ï¼Œä¿å­˜å½“å‰Stateåˆ°Checkpoint
2. æ ‡è®°å·¥ä½œæµä¸ºæš‚åœçŠ¶æ€
3. è¿”å›ç»™å‰ç«¯ï¼Œæç¤ºå®¶é•¿å¡«å†™åé¦ˆè¡¨
4. å®¶é•¿æäº¤åé¦ˆåï¼Œå‰ç«¯è°ƒç”¨æ¢å¤API
5. ä»Checkpointæ¢å¤Stateï¼Œæ›´æ–°å®¶é•¿åé¦ˆæ•°æ®
6. ç»§ç»­æ‰§è¡Œå·¥ä½œæµ

---

### 5.4 Checkpointæœºåˆ¶

**ç›®çš„**: æ”¯æŒå·¥ä½œæµçš„æš‚åœå’Œæ¢å¤

**å®ç°æ–¹å¼**:
- ä½¿ç”¨LangGraphçš„SQLite Checkpointer
- æ¯ä¸ªä¼šè¯æœ‰å”¯ä¸€çš„thread_idï¼ˆå¦‚"session-{sessionId}"ï¼‰
- åœ¨HITLæš‚åœç‚¹è‡ªåŠ¨ä¿å­˜Checkpoint
- æ¢å¤æ—¶ä½¿ç”¨ç›¸åŒçš„thread_idç»§ç»­æ‰§è¡Œ

---

### 5.5 Stateæ•°æ®ä¼˜åŒ–ç­–ç•¥

**æ ¸å¿ƒåŸåˆ™**: å°½é‡å°‘çš„function callï¼Œå¤šç”¨Stateæ•°æ®

**ä¼˜åŒ–æªæ–½**:

1. **Graphitiæ•°æ®ç¼“å­˜**:
   - åœ¨å‘¨è®¡åˆ’ç”ŸæˆèŠ‚ç‚¹ï¼Œä»Graphitiè·å–ä¸Šä¸‹æ–‡å’ŒæŒ‡æ ‡ï¼Œç¼“å­˜åˆ°State
   - åç»­èŠ‚ç‚¹ï¼ˆæ€»ç»“ç”Ÿæˆã€å†è¯„ä¼°ï¼‰ç›´æ¥ä»Stateè¯»å–ï¼Œä¸å†è°ƒç”¨Graphiti
   - åªåœ¨è®°å¿†æ›´æ–°èŠ‚ç‚¹æ›´æ–°Graphitiï¼Œå¹¶åˆ·æ–°Stateç¼“å­˜

2. **SQLiteæ•°æ®ç¼“å­˜**:
   - åœ¨å·¥ä½œæµå¼€å§‹æ—¶ï¼Œä»SQLiteåŠ è½½å­©å­ç”»åƒå’Œä¼šè¯å†å²ï¼Œç¼“å­˜åˆ°State
   - åç»­èŠ‚ç‚¹ç›´æ¥ä»Stateè¯»å–
   - åªåœ¨éœ€è¦æŒä¹…åŒ–æ—¶å†™å…¥SQLite

3. **æ‰¹é‡æ“ä½œ**:
   - Graphitiå†™å…¥ä½¿ç”¨æ‰¹é‡APIï¼Œä¸€æ¬¡æ€§å†™å…¥æ‰€æœ‰èŠ‚ç‚¹å’Œè¾¹
   - SQLiteå†™å…¥å°½é‡åˆå¹¶ï¼Œå‡å°‘IOæ¬¡æ•°

4. **æŒ‰éœ€åŠ è½½**:
   - åªåœ¨éœ€è¦æ—¶æ‰åŠ è½½æ•°æ®
   - ä¾‹å¦‚ï¼Œå¦‚æœæ²¡æœ‰è§†é¢‘ï¼Œå°±ä¸åŠ è½½è§†é¢‘åˆ†æç›¸å…³æ•°æ®

---

### 5.6 LangGraphå¦‚ä½•è°ƒç”¨æ¨¡å—

**æ ¸å¿ƒç†è§£**: æ ¹æ®ä¸šåŠ¡åœºæ™¯çµæ´»é€‰æ‹©è°ƒç”¨æ–¹å¼

#### ä¸¤ç§è°ƒç”¨æ–¹å¼

**æ–¹å¼1: å¼ºåˆ¶æ€§è°ƒç”¨ï¼ˆç¡®å®šæ€§æµç¨‹ï¼‰**

é€‚ç”¨åœºæ™¯ï¼šæµç¨‹å›ºå®šã€é€»è¾‘æ˜ç¡®ã€ä¸éœ€è¦æ™ºèƒ½å†³ç­–çš„åœºæ™¯

èŠ‚ç‚¹å‡½æ•°ç›´æ¥è°ƒç”¨ä¸šåŠ¡æ¨¡å—ï¼š
```
èŠ‚ç‚¹å‡½æ•°çš„èŒè´£ï¼š
1. ä»Stateä¸­è¯»å–éœ€è¦çš„æ•°æ®
2. ç›´æ¥è°ƒç”¨ä¸€ä¸ªæˆ–å¤šä¸ªä¸šåŠ¡æ¨¡å—
3. å¤„ç†æ¨¡å—è¿”å›çš„ç»“æœ
4. æ›´æ–°State
5. è¿”å›Stateçš„æ›´æ–°éƒ¨åˆ†
```

**å…¸å‹åœºæ™¯**ï¼š
- è¯„ä¼°èŠ‚ç‚¹ï¼šå¿…é¡»è§£ææŠ¥å‘Š â†’ å¿…é¡»æ„å»ºç”»åƒ
- è®°å¿†æ›´æ–°èŠ‚ç‚¹ï¼šå¿…é¡»å†™å…¥Graphiti â†’ å¿…é¡»æ›´æ–°ä¸Šä¸‹æ–‡
- è§†é¢‘åˆ†æèŠ‚ç‚¹ï¼šå¿…é¡»åˆ†æè§†é¢‘ â†’ å¿…é¡»éªŒè¯è§‚å¯Ÿ

**ç¤ºä¾‹: è¯„ä¼°èŠ‚ç‚¹ï¼ˆå¼ºåˆ¶æ€§è°ƒç”¨ï¼‰**
```
è¯„ä¼°èŠ‚ç‚¹å‡½æ•°ï¼š
  1. ä»Stateè¯»å–: æŠ¥å‘Šæ–‡ä»¶è·¯å¾„
  2. ç›´æ¥è°ƒç”¨æ¨¡å—6: æ–‡æ¡£è§£ææ¨¡å—.è§£ææŠ¥å‘Š(æ–‡ä»¶è·¯å¾„)
  3. ç›´æ¥è°ƒç”¨æ¨¡å—7: åˆå§‹è¯„ä¼°æ¨¡å—.æ„å»ºç”»åƒ(è§£æç»“æœ)
  4. ç›´æ¥è°ƒç”¨æ¨¡å—1: SQLiteæ¨¡å—.ä¿å­˜ç”»åƒ(å­©å­ID, ç”»åƒ)
  5. æ›´æ–°State: childProfile = ç”»åƒ
  6. è¿”å›: {childProfile: ç”»åƒ, workflow: {nextNode: "å‘¨è®¡åˆ’ç”Ÿæˆ"}}
```

---

**æ–¹å¼2: é€‰æ‹©æ€§è°ƒç”¨ï¼ˆæ™ºèƒ½å†³ç­–æµç¨‹ï¼‰**

é€‚ç”¨åœºæ™¯ï¼šéœ€è¦æ ¹æ®ä¸Šä¸‹æ–‡æ™ºèƒ½å†³ç­–ã€çµæ´»é€‰æ‹©å·¥å…·çš„åœºæ™¯

**å®ç°æœºåˆ¶ï¼šä½¿ç”¨LLMçš„Function Callèƒ½åŠ›**

å°†æ¨¡å—å°è£…ä¸ºå·¥å…·ï¼Œè®©LLMé€šè¿‡Function Callå†³å®šè°ƒç”¨å“ªäº›å·¥å…·ï¼š

```
å®ç°æ­¥éª¤ï¼š
1. å°†æ¨¡å—æ–¹æ³•å°è£…ä¸ºå·¥å…·å®šä¹‰ï¼ˆåŒ…å«nameã€descriptionã€parameters schemaï¼‰
2. åœ¨èŠ‚ç‚¹å‡½æ•°ä¸­ï¼Œå°†å·¥å…·åˆ—è¡¨å’Œä»»åŠ¡æè¿°ä¼ ç»™LLM
3. LLMåˆ†æä»»åŠ¡ï¼Œè¿”å›éœ€è¦è°ƒç”¨çš„å·¥å…·å’Œå‚æ•°ï¼ˆFunction Callï¼‰
4. èŠ‚ç‚¹å‡½æ•°æ‰§è¡ŒLLMæŒ‡å®šçš„å·¥å…·è°ƒç”¨
5. å°†å·¥å…·æ‰§è¡Œç»“æœè¿”å›ç»™LLM
6. LLMåŸºäºå·¥å…·ç»“æœç”Ÿæˆæœ€ç»ˆè¾“å‡º
7. æ›´æ–°State
```

**æŠ€æœ¯å®ç°**ï¼š
- ä½¿ç”¨LangChainçš„`bind_tools()`æ–¹æ³•ç»‘å®šå·¥å…·åˆ°LLM
- æˆ–ä½¿ç”¨OpenAI/DeepSeekçš„åŸç”ŸFunction Call API
- LangGraphä¼šè‡ªåŠ¨å¤„ç†å·¥å…·è°ƒç”¨å¾ªç¯ï¼ˆLLM â†’ å·¥å…· â†’ LLMï¼‰

**å…¸å‹åœºæ™¯**ï¼š
- å¯¹è¯åŠ©æ‰‹èŠ‚ç‚¹ï¼šæ ¹æ®é—®é¢˜ç±»å‹æ™ºèƒ½é€‰æ‹©æŸ¥è¯¢å“ªä¸ªçŸ¥è¯†åº“
- å‘¨è®¡åˆ’æ¨èèŠ‚ç‚¹ï¼šæ ¹æ®å­©å­æƒ…å†µæ™ºèƒ½é€‰æ‹©æ£€ç´¢ç­–ç•¥
- æ€»ç»“ç”ŸæˆèŠ‚ç‚¹ï¼šæ ¹æ®æ•°æ®å®Œæ•´æ€§æ™ºèƒ½é€‰æ‹©åˆ†æç»´åº¦

**ç¤ºä¾‹: å¯¹è¯åŠ©æ‰‹èŠ‚ç‚¹ï¼ˆé€‰æ‹©æ€§è°ƒç”¨ï¼‰**
```
å¯¹è¯åŠ©æ‰‹èŠ‚ç‚¹å‡½æ•°ï¼š
  1. ä»Stateè¯»å–: ç”¨æˆ·é—®é¢˜, å­©å­ç”»åƒ, å¯¹è¯å†å²
  
  2. å®šä¹‰å·¥å…·ï¼ˆå°è£…æ¨¡å—æ–¹æ³•ï¼‰:
     å·¥å…·å®šä¹‰æ ¼å¼ï¼š
     {
       name: "search_methodology_knowledge",
       description: "æ£€ç´¢åœ°æ¿æ—¶å…‰æ–¹æ³•è®ºçŸ¥è¯†åº“ã€‚å½“ç”¨æˆ·è¯¢é—®åœ°æ¿æ—¶å…‰ç†è®ºã€å¹²é¢„åŸåˆ™ã€ä¸“ä¸šæœ¯è¯­æ—¶ä½¿ç”¨ã€‚",
       parameters: {
         type: "object",
         properties: {
           query: {type: "string", description: "æ£€ç´¢æŸ¥è¯¢æ–‡æœ¬"},
           topK: {type: "number", description: "è¿”å›ç»“æœæ•°é‡", default: 5}
         },
         required: ["query"]
       },
       function: async (query, topK) => {
         // è°ƒç”¨æ¨¡å—3çš„æ–¹æ³•
         return await knowledgeRAG.searchMethodology(query, topK);
       }
     }
     
     ç±»ä¼¼åœ°å®šä¹‰å…¶ä»–å·¥å…·:
     - search_game_knowledge: æ£€ç´¢æ¸¸æˆçŸ¥è¯†åº“
     - search_scale_knowledge: æ£€ç´¢é‡è¡¨çŸ¥è¯†åº“
     - query_child_memory: æŸ¥è¯¢å­©å­Graphitiè®°å¿†
     - get_child_trends: è·å–å­©å­è¶‹åŠ¿æ•°æ®
  
  3. æ„å»ºæç¤ºè¯:
     system_prompt = """
     ä½ æ˜¯åœ°æ¿æ—¶å…‰ä¸“å®¶åŠ©æ‰‹ã€‚
     
     ç”¨æˆ·ä¿¡æ¯:
     - å­©å­å¹´é¾„: {å¹´é¾„}
     - å­©å­æƒ…å†µ: {ç”»åƒæ‘˜è¦}
     
     ä½ çš„ä»»åŠ¡æ˜¯å›ç­”ç”¨æˆ·é—®é¢˜ã€‚æ ¹æ®é—®é¢˜ç±»å‹ï¼Œä½¿ç”¨åˆé€‚çš„å·¥å…·è·å–ä¿¡æ¯ï¼š
     - ä¸“ä¸šç†è®ºé—®é¢˜ â†’ ä½¿ç”¨ search_methodology_knowledge
     - æ¸¸æˆç›¸å…³é—®é¢˜ â†’ ä½¿ç”¨ search_game_knowledge
     - å­©å­è¿›æ­¥é—®é¢˜ â†’ ä½¿ç”¨ query_child_memory å’Œ get_child_trends
     - é‡è¡¨è¯„ä¼°é—®é¢˜ â†’ ä½¿ç”¨ search_scale_knowledge
     
     å¯ä»¥ç»„åˆä½¿ç”¨å¤šä¸ªå·¥å…·ã€‚åŸºäºå·¥å…·è¿”å›çš„ä¿¡æ¯ç”Ÿæˆå‡†ç¡®ã€ä¸ªæ€§åŒ–çš„å›ç­”ã€‚
     """
     
     user_message = ç”¨æˆ·é—®é¢˜
  
  4. ä½¿ç”¨LangChainè°ƒç”¨LLM with tools:
     ```
     from langchain_core.messages import HumanMessage, SystemMessage
     from langchain_openai import ChatOpenAI
     
     # åˆ›å»ºLLMå®ä¾‹
     llm = ChatOpenAI(model="deepseek-chat")
     
     # ç»‘å®šå·¥å…·
     llm_with_tools = llm.bind_tools(tools)
     
     # æ„å»ºæ¶ˆæ¯
     messages = [
       SystemMessage(content=system_prompt),
       ...å¯¹è¯å†å²...,
       HumanMessage(content=user_message)
     ]
     
     # è°ƒç”¨LLMï¼ˆLLMä¼šè¿”å›Function Callè¯·æ±‚ï¼‰
     response = await llm_with_tools.ainvoke(messages)
     
     # LangGraphè‡ªåŠ¨å¤„ç†å·¥å…·è°ƒç”¨å¾ªç¯ï¼š
     # - å¦‚æœresponseåŒ…å«tool_callsï¼Œæ‰§è¡Œå·¥å…·
     # - å°†å·¥å…·ç»“æœæ·»åŠ åˆ°messages
     # - å†æ¬¡è°ƒç”¨LLM
     # - é‡å¤ç›´åˆ°LLMè¿”å›æœ€ç»ˆç­”æ¡ˆï¼ˆä¸å†è°ƒç”¨å·¥å…·ï¼‰
     ```
  
  5. LLMçš„å†³ç­–è¿‡ç¨‹ï¼ˆè‡ªåŠ¨ï¼‰:
     - LLMåˆ†æé—®é¢˜: "å­©å­æœ€è¿‘çœ¼ç¥æ¥è§¦æœ‰è¿›æ­¥å—ï¼Ÿ"
     - LLMå†³å®šè°ƒç”¨å·¥å…·:
       â†’ tool_call_1: query_child_memory(childId, "çœ¼ç¥æ¥è§¦")
       â†’ tool_call_2: get_child_trends(childId, "eye_contact")
     - æ‰§è¡Œå·¥å…·ï¼Œè·å–ç»“æœ
     - LLMåŸºäºç»“æœç”Ÿæˆå›ç­”: "æ ¹æ®è®°å½•ï¼Œå­©å­åœ¨è¿‡å»ä¸¤å‘¨..."
  
  6. å¦ä¸€ä¸ªä¾‹å­:
     - ç”¨æˆ·é—®é¢˜: "åœ°æ¿æ—¶å…‰çš„æ ¸å¿ƒåŸåˆ™æ˜¯ä»€ä¹ˆï¼Ÿ"
     - LLMå†³å®šè°ƒç”¨:
       â†’ tool_call: search_methodology_knowledge("åœ°æ¿æ—¶å…‰æ ¸å¿ƒåŸåˆ™")
     - æ‰§è¡Œå·¥å…·ï¼Œè·å–çŸ¥è¯†åº“å†…å®¹
     - LLMåŸºäºçŸ¥è¯†åº“ç”Ÿæˆå›ç­”
  
  7. æ›´æ–°State: 
     conversationHistory.append(user_message, assistant_response)
  
  8. è¿”å›: {answer: å›ç­”, sources: å·¥å…·è°ƒç”¨æ¥æº}
```

**ç¤ºä¾‹: å‘¨è®¡åˆ’æ¨èèŠ‚ç‚¹ï¼ˆé€‰æ‹©æ€§è°ƒç”¨ï¼‰**
```
å‘¨è®¡åˆ’æ¨èèŠ‚ç‚¹å‡½æ•°ï¼š
  1. ä»Stateè¯»å–: å­©å­ç”»åƒ, å½“å‰è¶‹åŠ¿, ä¸Šå‘¨å®Œæˆæƒ…å†µ
  
  2. å®šä¹‰å·¥å…·:
     {
       name: "search_games_by_dimension",
       description: "æŒ‰ç›®æ ‡ç»´åº¦æ£€ç´¢æ¸¸æˆã€‚ç”¨äºæŸ¥æ‰¾èƒ½æå‡ç‰¹å®šèƒ½åŠ›ç»´åº¦çš„æ¸¸æˆã€‚",
       parameters: {
         dimension: {type: "string", description: "ç›®æ ‡ç»´åº¦ï¼Œå¦‚eye_contact"},
         difficulty: {type: "string", enum: ["easy", "medium", "hard"]},
         topK: {type: "number", default: 10}
       },
       function: async (dimension, difficulty, topK) => {
         return await knowledgeRAG.searchGamesByDimension(dimension, difficulty, topK);
       }
     }
     
     ç±»ä¼¼åœ°å®šä¹‰:
     - search_games_by_interest: æŒ‰å…´è¶£æ£€ç´¢æ¸¸æˆ
     - get_similar_games: è·å–ç›¸ä¼¼æ¸¸æˆ
     - check_game_history: æ£€æŸ¥æ¸¸æˆå†å²ï¼ˆé¿å…é‡å¤ï¼‰
  
  3. æ„å»ºæç¤ºè¯:
     system_prompt = """
     ä½ æ˜¯æ¸¸æˆæ¨èä¸“å®¶ã€‚
     
     å­©å­æƒ…å†µ:
     - å¹´é¾„: {å¹´é¾„}
     - éœ€è¦æå‡çš„ç»´åº¦: {çŸ­æ¿ç»´åº¦åˆ—è¡¨}
     - å…´è¶£: {å…´è¶£åˆ—è¡¨}
     - ä¸Šå‘¨å®Œæˆæƒ…å†µ: {å®Œæˆç‡ã€è¿›æ­¥æƒ…å†µ}
     
     ä»»åŠ¡: ä¸ºæœ¬å‘¨ç”Ÿæˆ7å¤©æ¸¸æˆè®¡åˆ’
     
     è¦æ±‚:
     1. é‡ç‚¹æå‡1-2ä¸ªçŸ­æ¿ç»´åº¦
     2. ç»“åˆå­©å­å…´è¶£æé«˜å‚ä¸åº¦
     3. æ¸è¿›å¼éš¾åº¦ï¼ˆå‘¨ä¸€ç®€å• â†’ å‘¨æ—¥é€‚åº¦æŒ‘æˆ˜ï¼‰
     4. åŒä¸€æ¸¸æˆå¯é‡å¤2-3æ¬¡å·©å›º
     5. é¿å…ä¸ä¸Šå‘¨é‡å¤å¤ªå¤š
     
     æ­¥éª¤:
     1. ä½¿ç”¨å·¥å…·æ£€ç´¢å€™é€‰æ¸¸æˆï¼ˆæŒ‰ç»´åº¦ã€å…´è¶£ã€éš¾åº¦ï¼‰
     2. ä½¿ç”¨check_game_historyæ’é™¤æœ€è¿‘ç©è¿‡çš„
     3. ç”Ÿæˆ7å¤©æ¸¸æˆåºåˆ—ï¼ˆJSONæ ¼å¼ï¼‰
     
     è¾“å‡ºæ ¼å¼:
     {
       weeklyGoal: "æœ¬å‘¨æ€»ç›®æ ‡",
       dailyPlans: [
         {day: "å‘¨ä¸€", game: "æ¸¸æˆå", goal: "ä»Šæ—¥ç›®æ ‡", reasoning: "ä¸ºä»€ä¹ˆé€‰è¿™ä¸ª"},
         ...
       ]
     }
     """
  
  4. ä½¿ç”¨LangChainè°ƒç”¨LLM with tools:
     llm_with_tools = llm.bind_tools(tools)
     response = await llm_with_tools.ainvoke(messages)
  
  5. LLMçš„å†³ç­–è¿‡ç¨‹ï¼ˆè‡ªåŠ¨ï¼‰:
     - LLMåˆ†æ: å­©å­éœ€è¦æå‡"eye_contact"å’Œ"two_way_communication"
     - LLMå†³å®šè°ƒç”¨:
       â†’ search_games_by_dimension("eye_contact", "easy", 10)
       â†’ search_games_by_dimension("two_way_communication", "easy", 10)
       â†’ search_games_by_interest("ç§¯æœ¨", 5)  // å¦‚æœå­©å­å–œæ¬¢ç§¯æœ¨
     - è·å–å€™é€‰æ¸¸æˆåˆ—è¡¨
     - LLMå†è°ƒç”¨:
       â†’ check_game_history(childId, game1.id)
       â†’ check_game_history(childId, game2.id)
       ...
     - æ’é™¤æœ€è¿‘ç©è¿‡çš„
     - LLMåŸºäºå€™é€‰æ¸¸æˆç”Ÿæˆ7å¤©åºåˆ—ï¼ˆè€ƒè™‘éš¾åº¦é€’è¿›ã€é‡å¤ç»ƒä¹ ï¼‰
  
  6. è§£æLLMè¾“å‡ºçš„JSON
  
  7. è°ƒç”¨æ¨¡å—1: ä¿å­˜å‘¨è®¡åˆ’åˆ°SQLiteï¼ˆå¼ºåˆ¶æ€§è°ƒç”¨ï¼‰
  
  8. æ›´æ–°State: currentWeeklyPlan
  
  9. è¿”å›: {weeklyPlan: è®¡åˆ’}
```

**Function Callçš„ä¼˜åŠ¿**:
- âœ… LLMæ™ºèƒ½å†³ç­–ï¼šæ ¹æ®ä¸Šä¸‹æ–‡é€‰æ‹©æœ€åˆé€‚çš„å·¥å…·ç»„åˆ
- âœ… çµæ´»æ€§é«˜ï¼šå¯ä»¥åŠ¨æ€è°ƒæ•´æ£€ç´¢ç­–ç•¥
- âœ… å¯è§£é‡Šæ€§ï¼šå¯ä»¥çœ‹åˆ°LLMè°ƒç”¨äº†å“ªäº›å·¥å…·
- âœ… å‡å°‘ç¡¬ç¼–ç ï¼šä¸éœ€è¦å†™å¤æ‚çš„if-elseé€»è¾‘

**Function Callçš„æˆæœ¬**:
- âš ï¸ å¢åŠ LLMè°ƒç”¨æ¬¡æ•°ï¼ˆæ¯æ¬¡å·¥å…·è°ƒç”¨éƒ½éœ€è¦LLMå†³ç­–ï¼‰
- âš ï¸ å¢åŠ å»¶è¿Ÿï¼ˆå¤šè½®LLMè°ƒç”¨ï¼‰
- âš ï¸ å¢åŠ æˆæœ¬ï¼ˆæ›´å¤štokenæ¶ˆè€—ï¼‰

**å› æ­¤é€‰æ‹©æ€§è°ƒç”¨åªç”¨äºçœŸæ­£éœ€è¦æ™ºèƒ½å†³ç­–çš„åœºæ™¯**

---

#### å¦‚ä½•é€‰æ‹©è°ƒç”¨æ–¹å¼

**ä½¿ç”¨å¼ºåˆ¶æ€§è°ƒç”¨çš„åœºæ™¯**:
- âœ… æµç¨‹å›ºå®šï¼Œæ¯æ¬¡éƒ½è¦æ‰§è¡Œç›¸åŒçš„æ­¥éª¤
- âœ… ä¸éœ€è¦æ™ºèƒ½å†³ç­–ï¼Œé€»è¾‘æ˜ç¡®
- âœ… è¿½æ±‚é€Ÿåº¦å’Œæˆæœ¬æ•ˆç‡
- âœ… éœ€è¦ä¸¥æ ¼æ§åˆ¶æµç¨‹

**ç¤ºä¾‹**:
- è¯„ä¼°èŠ‚ç‚¹ï¼šå¿…é¡»è§£ææŠ¥å‘Š â†’ æ„å»ºç”»åƒ
- è®°å¿†æ›´æ–°èŠ‚ç‚¹ï¼šå¿…é¡»å†™å…¥Graphiti
- è§†é¢‘åˆ†æèŠ‚ç‚¹ï¼šå¿…é¡»åˆ†æè§†é¢‘
- æ¸¸æˆå¼€å§‹/ç»“æŸèŠ‚ç‚¹ï¼šå¿…é¡»åˆ›å»º/ç»“æŸä¼šè¯

**ä½¿ç”¨é€‰æ‹©æ€§è°ƒç”¨çš„åœºæ™¯**:
- âœ… éœ€è¦æ ¹æ®ä¸Šä¸‹æ–‡æ™ºèƒ½å†³ç­–
- âœ… å·¥å…·é€‰æ‹©ä¸ç¡®å®šï¼Œéœ€è¦çµæ´»ç»„åˆ
- âœ… éœ€è¦LLMç†è§£å’Œæ¨ç†
- âœ… è¿½æ±‚æ™ºèƒ½åŒ–å’Œçµæ´»æ€§

**ç¤ºä¾‹**:
- å¯¹è¯åŠ©æ‰‹èŠ‚ç‚¹ï¼šæ ¹æ®é—®é¢˜ç±»å‹é€‰æ‹©çŸ¥è¯†åº“
- å‘¨è®¡åˆ’æ¨èèŠ‚ç‚¹ï¼šæ ¹æ®å­©å­æƒ…å†µé€‰æ‹©æ£€ç´¢ç­–ç•¥
- æ€»ç»“ç”ŸæˆèŠ‚ç‚¹ï¼šæ ¹æ®æ•°æ®å®Œæ•´æ€§é€‰æ‹©åˆ†æç»´åº¦
- å†è¯„ä¼°èŠ‚ç‚¹ï¼šæ ¹æ®è¿›å±•æƒ…å†µé€‰æ‹©åˆ†æé‡ç‚¹

---

#### æ··åˆä½¿ç”¨ç­–ç•¥

**åŒä¸€ä¸ªèŠ‚ç‚¹å¯ä»¥æ··åˆä½¿ç”¨ä¸¤ç§æ–¹å¼**:

**ç¤ºä¾‹: æ€»ç»“ç”ŸæˆèŠ‚ç‚¹ï¼ˆæ··åˆï¼‰**
```
æ€»ç»“ç”ŸæˆèŠ‚ç‚¹å‡½æ•°ï¼š
  1. å¼ºåˆ¶æ€§è°ƒç”¨: ä»SQLiteè·å–ä¼šè¯æ•°æ®ï¼ˆå¿…é¡»ï¼‰
  2. å¼ºåˆ¶æ€§è°ƒç”¨: ä»Stateè¯»å–å†å²æ•°æ®ï¼ˆå¿…é¡»ï¼‰
  
  3. é€‰æ‹©æ€§è°ƒç”¨: è®©LLMå†³å®šåˆ†æå“ªäº›ç»´åº¦
     - å®šä¹‰å·¥å…·:
       - analyze_expression_changes() - åˆ†æè¡¨æƒ…å˜åŒ–
       - analyze_eye_contact_trends() - åˆ†æçœ¼ç¥è¶‹åŠ¿
       - analyze_interaction_quality() - åˆ†æäº’åŠ¨è´¨é‡
       - compare_with_history() - ä¸å†å²å¯¹æ¯”
     
     - LLMæ ¹æ®æ•°æ®å®Œæ•´æ€§é€‰æ‹©è°ƒç”¨å“ªäº›åˆ†æå·¥å…·
     - ä¾‹å¦‚: å¦‚æœæœ‰è§†é¢‘ â†’ è°ƒç”¨æ‰€æœ‰å·¥å…·
     - ä¾‹å¦‚: å¦‚æœåªæœ‰å¿«æ·è®°å½• â†’ åªè°ƒç”¨éƒ¨åˆ†å·¥å…·
  
  4. å¼ºåˆ¶æ€§è°ƒç”¨: ä¿å­˜æ€»ç»“åˆ°SQLiteï¼ˆå¿…é¡»ï¼‰
  
  5. è¿”å›æ€»ç»“
```

---

#### å·¥å…·å°è£…æ–¹å¼

**å°†æ¨¡å—å°è£…ä¸ºLangGraphå·¥å…·**:

æ¯ä¸ªä¸šåŠ¡æ¨¡å—å¯ä»¥æä¾›å¤šä¸ªå·¥å…·å‡½æ•°ï¼š

```
æ¨¡å—3: çŸ¥è¯†åº“RAG
  æä¾›çš„å·¥å…·:
    - search_methodology_knowledge(query, topK)
    - search_game_knowledge(query, filters, topK)
    - search_scale_knowledge(query, topK)
    - search_games_by_dimension(dimension, difficulty, topK)
    - search_games_by_interest(interest, topK)

æ¨¡å—2: Graphitiè®°å¿†ç½‘ç»œ
  æä¾›çš„å·¥å…·:
    - query_child_memory(childId, query, timeRange)
    - get_child_trends(childId, dimension, timeRange)
    - get_milestones(childId, timeRange)
    - check_plateau(childId, dimension)

æ¨¡å—1: SQLiteæ•°æ®ç®¡ç†
  æä¾›çš„å·¥å…·:
    - get_child_profile(childId)
    - get_session_history(childId, filters)
    - check_game_history(childId, gameId)
```

å·¥å…·å®šä¹‰åŒ…å«:
- å·¥å…·åç§°
- å·¥å…·æè¿°ï¼ˆè®©LLMç†è§£ä½•æ—¶ä½¿ç”¨ï¼‰
- å‚æ•°schema
- æ‰§è¡Œå‡½æ•°ï¼ˆè°ƒç”¨å®é™…çš„æ¨¡å—æ–¹æ³•ï¼‰

#### æ¨¡å—è°ƒç”¨çš„å…·ä½“å½¢å¼

**1. å¼ºåˆ¶æ€§è°ƒç”¨ï¼šæ¨¡å—ä»¥ç±»æˆ–å‡½æ•°çš„å½¢å¼æä¾›æ¥å£**

```
æ¨¡å—1: SQLiteæ•°æ®ç®¡ç†
  - æä¾›ç±»: SQLiteManager
  - æ–¹æ³•: getChild(childId), saveSession(session), ...
  - èŠ‚ç‚¹ä¸­ç›´æ¥è°ƒç”¨: const child = await sqliteManager.getChild(childId)

æ¨¡å—2: Graphitiè®°å¿†ç½‘ç»œ
  - æä¾›ç±»: GraphitiManager
  - æ–¹æ³•: addMemories(memories), analyzeTrends(childId), ...
  - èŠ‚ç‚¹ä¸­ç›´æ¥è°ƒç”¨: const trends = await graphitiManager.analyzeTrends(childId)
```

**2. é€‰æ‹©æ€§è°ƒç”¨ï¼šæ¨¡å—æä¾›å·¥å…·å®šä¹‰**

```
æ¨¡å—3: çŸ¥è¯†åº“RAG
  - æä¾›å·¥å…·åˆ—è¡¨:
    [
      {
        name: "search_methodology_knowledge",
        description: "æ£€ç´¢åœ°æ¿æ—¶å…‰æ–¹æ³•è®ºçŸ¥è¯†åº“ï¼Œç”¨äºå›ç­”ä¸“ä¸šç†è®ºé—®é¢˜",
        parameters: {query: string, topK: number},
        function: (query, topK) => knowledgeRAG.searchMethodology(query, topK)
      },
      {
        name: "search_game_knowledge",
        description: "æ£€ç´¢æ¸¸æˆçŸ¥è¯†åº“ï¼Œç”¨äºæŸ¥æ‰¾æ¸¸æˆä¿¡æ¯å’Œç©æ³•",
        parameters: {query: string, filters: object, topK: number},
        function: (query, filters, topK) => knowledgeRAG.searchGames(query, filters, topK)
      },
      ...
    ]
  
  - èŠ‚ç‚¹ä¸­ä½¿ç”¨: 
    1. å°†å·¥å…·åˆ—è¡¨ä¼ ç»™LLM
    2. LLMå†³å®šè°ƒç”¨å“ªäº›å·¥å…·
    3. æ‰§è¡Œå·¥å…·è°ƒç”¨
```

---

### 5.7 å®Œæ•´å·¥ä½œæµæ‰§è¡Œç¤ºä¾‹

#### åœºæ™¯: å®Œæˆä¸€æ¬¡æ¸¸æˆå¹²é¢„çš„å®Œæ•´æµç¨‹

**å‰ç½®æ¡ä»¶**: å­©å­å·²å®Œæˆåˆå§‹è¯„ä¼°ï¼Œæœ¬å‘¨è®¡åˆ’å·²ç”Ÿæˆ

**æ‰§è¡Œæµç¨‹**:

```
æ­¥éª¤1: å‰ç«¯è§¦å‘"å¼€å§‹æ¸¸æˆ"
  â†“
æ­¥éª¤2: è°ƒç”¨LangGraphå·¥ä½œæµAPI
  - ä¼ å…¥: childId, gameId
  - å·¥ä½œæµä»"æ¸¸æˆå¼€å§‹èŠ‚ç‚¹"å¯åŠ¨
  â†“
æ­¥éª¤3: æ¸¸æˆå¼€å§‹èŠ‚ç‚¹æ‰§è¡Œ
  èŠ‚ç‚¹å‡½æ•°:
    1. ä»Stateè¯»å–: childId, currentWeeklyPlan
    2. è°ƒç”¨æ¨¡å—1: sessionService.createSession(childId, gameId)
    3. è°ƒç”¨æ¨¡å—1: sessionService.startSession(sessionId)
    4. æ›´æ–°State: currentSession = {sessionId, gameId, status: "in_progress", ...}
    5. è¿”å›: {currentSession, workflow: {nextNode: "æ¸¸æˆæŒ‡å¼•"}}
  â†“
æ­¥éª¤4: æ¸¸æˆæŒ‡å¼•èŠ‚ç‚¹æ‰§è¡Œ
  èŠ‚ç‚¹å‡½æ•°:
    1. ä»Stateè¯»å–: gameId, childProfile
    2. è°ƒç”¨æ¨¡å—9: guidanceService.getStepGuidance(gameId, step=1, context)
    3. è°ƒç”¨æ¨¡å—5: speechService.textToSpeech(æŒ‡å¼•æ–‡å­—)
    4. è¿”å›æŒ‡å¼•ç»™å‰ç«¯ï¼ˆæ–‡å­—+è¯­éŸ³ï¼‰
    5. ç­‰å¾…å‰ç«¯é€šçŸ¥"è¿›å…¥ä¸‹ä¸€æ­¥"æˆ–"ç»“æŸæ¸¸æˆ"
  â†“
æ­¥éª¤5: æ¸¸æˆè¿›è¡Œä¸­ï¼ˆå‰ç«¯å¾ªç¯ï¼‰
  - å®¶é•¿ç‚¹å‡»å¿«æ·æŒ‰é’® â†’ è°ƒç”¨API â†’ æ¨¡å—10.captureQuickObservation()
  - å®¶é•¿æŒ‰ä½è¯´è¯ â†’ ä¸Šä¼ éŸ³é¢‘ â†’ è°ƒç”¨API â†’ æ¨¡å—10.captureVoiceObservation()
  - å®¶é•¿ç‚¹å‡»"ä¸‹ä¸€æ­¥" â†’ è¿”å›æ­¥éª¤4è·å–ä¸‹ä¸€æ­¥æŒ‡å¼•
  - å®¶é•¿ç‚¹å‡»"ç»“æŸæ¸¸æˆ" â†’ è¿›å…¥æ­¥éª¤6
  â†“
æ­¥éª¤6: æ¸¸æˆç»“æŸèŠ‚ç‚¹æ‰§è¡Œ
  èŠ‚ç‚¹å‡½æ•°:
    1. ä»Stateè¯»å–: sessionId
    2. è°ƒç”¨æ¨¡å—1: sessionService.endSession(sessionId)
    3. æ›´æ–°State: currentSession.status = "ended", currentSession.endTime = now
    4. è¿”å›: {currentSession, workflow: {nextNode: "è§†é¢‘ä¸Šä¼ åˆ¤æ–­"}}
  â†“
æ­¥éª¤7: æ¡ä»¶è¾¹åˆ¤æ–­ï¼ˆæ˜¯å¦ä¸Šä¼ è§†é¢‘ï¼‰
  æ¡ä»¶å‡½æ•°:
    1. å‰ç«¯è¯¢é—®å®¶é•¿æ˜¯å¦ä¸Šä¼ è§†é¢‘
    2. å¦‚æœä¸Šä¼  â†’ æ›´æ–°State.currentSession.hasVideo = true â†’ è¿”å›"è§†é¢‘åˆ†æèŠ‚ç‚¹"
    3. å¦‚æœè·³è¿‡ â†’ æ›´æ–°State.currentSession.hasVideo = false â†’ è¿”å›"åˆæ­¥æ€»ç»“èŠ‚ç‚¹"
  
  å‡è®¾å®¶é•¿é€‰æ‹©ä¸Šä¼ è§†é¢‘ â†“
  
æ­¥éª¤8: è§†é¢‘åˆ†æèŠ‚ç‚¹æ‰§è¡Œï¼ˆåå°å¼‚æ­¥ï¼‰
  èŠ‚ç‚¹å‡½æ•°:
    1. ä»Stateè¯»å–: sessionId, videoPath, quickObservations
    2. è°ƒç”¨æ¨¡å—11: videoAnalysisService.analyzeVideo(sessionId, videoPath)
       - æ¨¡å—11å†…éƒ¨è°ƒç”¨æ¨¡å—4: AIè§†é¢‘è§£æ
    3. è°ƒç”¨æ¨¡å—11: videoAnalysisService.crossValidate(quickObservations, è§†é¢‘ç»“æœ)
    4. æ›´æ–°State: currentSession.videoAnalysisResult = ç»“æœ
    5. æ›´æ–°State: currentSession.validatedObservations = å·²éªŒè¯çš„è§‚å¯Ÿ
    6. è¿”å›: {currentSession, workflow: {nextNode: "åˆæ­¥æ€»ç»“"}}
  â†“
æ­¥éª¤9: åˆæ­¥æ€»ç»“èŠ‚ç‚¹æ‰§è¡Œ
  èŠ‚ç‚¹å‡½æ•°:
    1. ä»Stateè¯»å–: sessionId, currentSession, metrics, currentContext
    2. è°ƒç”¨æ¨¡å—12: summaryService.generatePreliminarySummary(sessionId)
       - æ¨¡å—12å†…éƒ¨ä»Stateè¯»å–å†å²æ•°æ®ï¼ˆä¸å†è°ƒç”¨Graphitiï¼‰
    3. æ›´æ–°State: currentSession.preliminarySummary = åˆæ­¥æ€»ç»“
    4. è¿”å›: {currentSession, workflow: {nextNode: "åé¦ˆè¡¨ç”Ÿæˆ"}}
  â†“
æ­¥éª¤10: åé¦ˆè¡¨ç”ŸæˆèŠ‚ç‚¹æ‰§è¡Œ
  èŠ‚ç‚¹å‡½æ•°:
    1. ä»Stateè¯»å–: preliminarySummary
    2. è°ƒç”¨æ¨¡å—12: summaryService.generateFeedbackForm(preliminarySummary)
    3. æ›´æ–°State: currentSession.feedbackForm = åé¦ˆè¡¨
    4. è¿”å›: {currentSession, workflow: {nextNode: "HITLæš‚åœ", isHITLPaused: true}}
  â†“
æ­¥éª¤11: HITLæš‚åœèŠ‚ç‚¹æ‰§è¡Œ
  èŠ‚ç‚¹å‡½æ•°:
    1. ä¿å­˜Checkpointåˆ°SQLite
    2. è¿”å›åé¦ˆè¡¨ç»™å‰ç«¯
    3. å·¥ä½œæµæš‚åœï¼Œç­‰å¾…å®¶é•¿å¡«å†™
  â†“
æ­¥éª¤12: å®¶é•¿å¡«å†™åé¦ˆè¡¨ï¼ˆå‰ç«¯ï¼‰
  - å®¶é•¿å¡«å†™3-5ä¸ªé—®é¢˜
  - ç‚¹å‡»"æäº¤"
  - å‰ç«¯è°ƒç”¨æ¢å¤APIï¼Œä¼ å…¥parentFeedback
  â†“
æ­¥éª¤13: å·¥ä½œæµæ¢å¤ï¼Œæœ€ç»ˆæ€»ç»“èŠ‚ç‚¹æ‰§è¡Œ
  èŠ‚ç‚¹å‡½æ•°:
    1. ä»Checkpointæ¢å¤State
    2. æ›´æ–°State: currentSession.parentFeedback = å®¶é•¿åé¦ˆ
    3. è°ƒç”¨æ¨¡å—12: summaryService.generateFinalSummary(sessionId, parentFeedback)
       - æ¨¡å—12èåˆæ‰€æœ‰æ•°æ®ï¼ˆè§‚å¯Ÿã€è§†é¢‘ã€åé¦ˆã€Stateä¸­çš„å†å²æ•°æ®ï¼‰
    4. æ›´æ–°State: currentSession.finalSummary = æœ€ç»ˆæ€»ç»“
    5. è¿”å›: {currentSession, workflow: {nextNode: "è®°å¿†æ›´æ–°"}}
  â†“
æ­¥éª¤14: è®°å¿†æ›´æ–°èŠ‚ç‚¹æ‰§è¡Œ
  èŠ‚ç‚¹å‡½æ•°:
    1. ä»Stateè¯»å–: childId, currentSessionï¼ˆåŒ…å«æ‰€æœ‰æ•°æ®ï¼‰
    2. è°ƒç”¨æ¨¡å—13: memoryService.saveSessionMemory(childId, sessionData)
       - æ¨¡å—13å†…éƒ¨è°ƒç”¨æ¨¡å—2: Graphitiæ‰¹é‡å†™å…¥
    3. è°ƒç”¨æ¨¡å—13: memoryService.buildContext(childId)
       - é‡æ–°æ„å»ºä¸Šä¸‹æ–‡
    4. æ›´æ–°State: currentContext = æ–°ä¸Šä¸‹æ–‡, metrics = æ–°æŒ‡æ ‡
    5. è¿”å›: {currentContext, metrics, workflow: {nextNode: "å†è¯„ä¼°"}}
  â†“
æ­¥éª¤15: å†è¯„ä¼°èŠ‚ç‚¹æ‰§è¡Œ
  èŠ‚ç‚¹å‡½æ•°:
    1. ä»Stateè¯»å–: childId, currentSession, currentContext, metrics
    2. è°ƒç”¨æ¨¡å—14: reassessmentService.reassessChild(childId, sessionData)
       - æ¨¡å—14ä¸»è¦ä»Stateè¯»å–æ•°æ®ï¼Œåªåœ¨å¿…è¦æ—¶è°ƒç”¨Graphiti
    3. è°ƒç”¨æ¨¡å—14: reassessmentService.detectMilestones(childId)
    4. è°ƒç”¨æ¨¡å—14: reassessmentService.updatePortrait(childId)
    5. æ›´æ–°State: childProfile = æ›´æ–°åçš„ç”»åƒ
    6. åˆ¤æ–­æ˜¯å¦éœ€è¦è°ƒæ•´è®¡åˆ’
    7. è¿”å›: {childProfile, needsAdjustment: false, workflow: {nextNode: "END"}}
  â†“
æ­¥éª¤16: æ¡ä»¶è¾¹åˆ¤æ–­ï¼ˆæ˜¯å¦éœ€è¦è°ƒæ•´è®¡åˆ’ï¼‰
  æ¡ä»¶å‡½æ•°:
    1. ä»Stateè¯»å–: needsAdjustment
    2. å¦‚æœ needsAdjustment == true â†’ è¿”å›"å‘¨è®¡åˆ’ç”ŸæˆèŠ‚ç‚¹"
    3. å¦‚æœ needsAdjustment == false â†’ è¿”å›"END"
  
  å‡è®¾ä¸éœ€è¦è°ƒæ•´ â†“
  
æ­¥éª¤17: å·¥ä½œæµç»“æŸ
  - è¿”å›æœ€ç»ˆStateç»™å‰ç«¯
  - å‰ç«¯å±•ç¤ºæœ€ç»ˆæ€»ç»“
  - å‰ç«¯æ›´æ–°æ—¥å†ï¼ˆæ ‡è®°ä»Šæ—¥æ¸¸æˆå®Œæˆâœ…ï¼‰
```

#### å…³é”®è§‚å¯Ÿç‚¹

1. **çµæ´»é€‰æ‹©è°ƒç”¨æ–¹å¼**: æ ¹æ®ä¸šåŠ¡åœºæ™¯é€‰æ‹©å¼ºåˆ¶æ€§æˆ–é€‰æ‹©æ€§è°ƒç”¨
2. **èŠ‚ç‚¹å‡½æ•°èŒè´£æ¸…æ™°**: ç¼–æ’é€»è¾‘åœ¨èŠ‚ç‚¹ï¼Œä¸šåŠ¡é€»è¾‘åœ¨æ¨¡å—
3. **Stateæ˜¯ä¸­å¿ƒ**: æ‰€æœ‰æ•°æ®é€šè¿‡Stateæµè½¬
4. **å‡å°‘å¤–éƒ¨è°ƒç”¨**: ä¼˜å…ˆä»Stateè¯»å–ï¼Œåªåœ¨å¿…è¦æ—¶è°ƒç”¨å¤–éƒ¨ç³»ç»Ÿ
5. **æ‰¹é‡æ“ä½œ**: Graphitiå†™å…¥åœ¨è®°å¿†æ›´æ–°èŠ‚ç‚¹ä¸€æ¬¡æ€§å®Œæˆ
6. **HITLæš‚åœ**: ä½¿ç”¨Checkpointæœºåˆ¶å®ç°æš‚åœå’Œæ¢å¤
7. **æ™ºèƒ½ä¸ç¡®å®šæ€§ç»“åˆ**: ç¡®å®šæ€§æµç¨‹ç”¨å¼ºåˆ¶è°ƒç”¨ï¼Œéœ€è¦å†³ç­–çš„ç”¨é€‰æ‹©æ€§è°ƒç”¨

#### å®é™…åº”ç”¨å»ºè®®

**ä¸»å·¥ä½œæµä¸­çš„èŠ‚ç‚¹åˆ†ç±»**:

**ç¡®å®šæ€§èŠ‚ç‚¹ï¼ˆå¼ºåˆ¶æ€§è°ƒç”¨ï¼‰**:
- è¯„ä¼°èŠ‚ç‚¹
- æ¸¸æˆå¼€å§‹/ç»“æŸèŠ‚ç‚¹
- è§†é¢‘åˆ†æèŠ‚ç‚¹
- è®°å¿†æ›´æ–°èŠ‚ç‚¹
- HITLæš‚åœèŠ‚ç‚¹

**æ™ºèƒ½å†³ç­–èŠ‚ç‚¹ï¼ˆé€‰æ‹©æ€§è°ƒç”¨ï¼‰**:
- å‘¨è®¡åˆ’æ¨èèŠ‚ç‚¹ï¼ˆæ™ºèƒ½é€‰æ‹©æ¸¸æˆæ£€ç´¢ç­–ç•¥ï¼‰
- æ€»ç»“ç”ŸæˆèŠ‚ç‚¹ï¼ˆæ™ºèƒ½é€‰æ‹©åˆ†æç»´åº¦ï¼‰
- å†è¯„ä¼°èŠ‚ç‚¹ï¼ˆæ™ºèƒ½é€‰æ‹©è¯„ä¼°é‡ç‚¹ï¼‰

**ç‹¬ç«‹æ™ºèƒ½èŠ‚ç‚¹ï¼ˆé€‰æ‹©æ€§è°ƒç”¨ï¼‰**:
- å¯¹è¯åŠ©æ‰‹èŠ‚ç‚¹ï¼ˆæ™ºèƒ½é€‰æ‹©çŸ¥è¯†åº“å’ŒæŸ¥è¯¢ç­–ç•¥ï¼‰

---

### 5.8 ç‹¬ç«‹æµç¨‹

**å¯¹è¯åŠ©æ‰‹å’Œå¯è§†åŒ–æŠ¥å‘Šä¸åœ¨ä¸»å·¥ä½œæµä¸­ï¼Œè€Œæ˜¯ç‹¬ç«‹çš„API**:

#### å¯¹è¯åŠ©æ‰‹API
- æ¥æ”¶ç”¨æˆ·æ¶ˆæ¯
- è°ƒç”¨æ¨¡å—15ï¼ˆå¯¹è¯åŠ©æ‰‹ï¼‰
- è¿”å›å›ç­”

#### å¯è§†åŒ–æŠ¥å‘ŠAPI
- æ¥æ”¶æŸ¥è¯¢å‚æ•°ï¼ˆå­©å­IDã€æ—¶é—´èŒƒå›´ç­‰ï¼‰
- è°ƒç”¨æ¨¡å—16ï¼ˆå¯è§†åŒ–ä¸æŠ¥å‘Šï¼‰
- è¿”å›å¯è§†åŒ–æ•°æ®æˆ–PDFæ–‡ä»¶

---

## 6. æ€»ç»“

### 6.0 çŸ¥è¯†åº“æ•°æ®ç»„ç»‡è¯¦ç»†è®¾è®¡

#### æ•°æ®åº“è¡¨ç»“æ„

**æ–¹æ³•è®ºçŸ¥è¯†è¡¨ (methodology_knowledge)**
- id: çŸ¥è¯†æ¡ç›®ID
- title: æ ‡é¢˜
- content: å†…å®¹
- category: åˆ†ç±»ï¼ˆç†è®º/åŸåˆ™/è§‚å¯Ÿ/æŒ‡å¯¼/æœ¯è¯­ï¼‰
- tags: æ ‡ç­¾ï¼ˆæ•°ç»„ï¼‰
- embedding: å‘é‡ï¼ˆpgvectorï¼‰
- metadata: å…ƒæ•°æ®ï¼ˆJSONï¼‰

**æ¸¸æˆçŸ¥è¯†è¡¨ (game_knowledge)**
- id: æ¸¸æˆID
- name: æ¸¸æˆåç§°
- description: æ¸¸æˆæè¿°
- age_range: é€‚ç”¨å¹´é¾„èŒƒå›´
- target_dimensions: ç›®æ ‡ç»´åº¦ï¼ˆæ•°ç»„ï¼‰
- difficulty_level: éš¾åº¦ç­‰çº§ï¼ˆ1-5ï¼‰
- required_props: æ‰€éœ€é“å…·ï¼ˆæ•°ç»„ï¼‰
- steps: ç©æ³•æ­¥éª¤ï¼ˆJSONæ•°ç»„ï¼‰
- variations: æ¸¸æˆå˜ä½“ï¼ˆJSONæ•°ç»„ï¼‰
- tips: æ³¨æ„äº‹é¡¹ï¼ˆæ•°ç»„ï¼‰
- embedding: å‘é‡ï¼ˆpgvectorï¼‰
- metadata: å…ƒæ•°æ®ï¼ˆJSONï¼‰

**é‡è¡¨çŸ¥è¯†è¡¨ (scale_knowledge)**
- id: é‡è¡¨æ¡ç›®ID
- scale_type: é‡è¡¨ç±»å‹ï¼ˆCARS-2/ADOS-2/ATECï¼‰
- item_number: é¢˜ç›®ç¼–å·
- question: é¢˜ç›®å†…å®¹
- scoring_criteria: è¯„åˆ†æ ‡å‡†ï¼ˆJSONï¼‰
- interpretation: è§£è¯»è¯´æ˜
- embedding: å‘é‡ï¼ˆpgvectorï¼‰
- metadata: å…ƒæ•°æ®ï¼ˆJSONï¼‰

**æ¡ˆä¾‹çŸ¥è¯†è¡¨ (case_knowledge)** - å¯é€‰
- id: æ¡ˆä¾‹ID
- title: æ¡ˆä¾‹æ ‡é¢˜
- description: æ¡ˆä¾‹æè¿°
- child_age: å­©å­å¹´é¾„
- problem_type: é—®é¢˜ç±»å‹
- intervention: å¹²é¢„æ–¹æ³•
- outcome: å¹²é¢„ç»“æœ
- lessons: ç»éªŒæ•™è®­
- embedding: å‘é‡ï¼ˆpgvectorï¼‰
- metadata: å…ƒæ•°æ®ï¼ˆJSONï¼‰

#### æ£€ç´¢ç­–ç•¥è¯¦è§£

**1. å•å±‚æ£€ç´¢**
- æŒ‡å®šçŸ¥è¯†å±‚çº§ï¼ˆå¦‚åªæ£€ç´¢æ¸¸æˆçŸ¥è¯†åº“ï¼‰
- ä½¿ç”¨å‘é‡ç›¸ä¼¼åº¦æ’åº
- å¯æ·»åŠ è¿‡æ»¤æ¡ä»¶ï¼ˆå¦‚å¹´é¾„ã€éš¾åº¦ã€ç»´åº¦ï¼‰

**2. è·¨å±‚æ£€ç´¢**
- åŒæ—¶æ£€ç´¢å¤šä¸ªçŸ¥è¯†å±‚çº§
- å¯¹ä¸åŒå±‚çº§çš„ç»“æœè¿›è¡ŒåŠ æƒèåˆ
- æ ¹æ®é—®é¢˜ç±»å‹åŠ¨æ€è°ƒæ•´æƒé‡

**3. æ··åˆæ£€ç´¢**
- å‘é‡æ£€ç´¢ï¼ˆè¯­ä¹‰ç›¸ä¼¼åº¦ï¼‰
- å…³é”®è¯è¿‡æ»¤ï¼ˆç²¾ç¡®åŒ¹é…ï¼‰
- å…ƒæ•°æ®è¿‡æ»¤ï¼ˆå¹´é¾„ã€éš¾åº¦ç­‰ï¼‰
- å¤šç§ç­–ç•¥ç»„åˆ

**4. ä¸Šä¸‹æ–‡å¢å¼ºæ£€ç´¢**
- ç»“åˆå­©å­ç”»åƒï¼ˆä¼˜åŠ¿ã€çŸ­æ¿ã€å…´è¶£ï¼‰
- ç»“åˆå½“å‰ç›®æ ‡ï¼ˆæœ¬å‘¨è¦æå‡çš„ç»´åº¦ï¼‰
- ç»“åˆå†å²æ•°æ®ï¼ˆä¹‹å‰ç©è¿‡çš„æ¸¸æˆï¼‰
- åŠ¨æ€è°ƒæ•´æ£€ç´¢ç»“æœ

#### çŸ¥è¯†åº“åˆå§‹åŒ–

**æ–¹æ³•è®ºçŸ¥è¯†åº“**ï¼ˆçº¦100-200æ¡ï¼‰
- åœ°æ¿æ—¶å…‰æ ¸å¿ƒæ–‡æ¡£
- ä¸“ä¸šä¹¦ç±ç« èŠ‚
- ä¸“å®¶æŒ‡å¯¼æ‰‹å†Œ
- å¸¸è§é—®é¢˜è§£ç­”

**æ¸¸æˆçŸ¥è¯†åº“**ï¼ˆMVPé˜¶æ®µ50ä¸ªæ¸¸æˆï¼‰
- æŒ‰å¹´é¾„åˆ†ç»„ï¼ˆ1-2å²ã€2-3å²ã€3-4å²ã€4-5å²ï¼‰
- æŒ‰ç»´åº¦åˆ†ç»„ï¼ˆ6å¤§ç»´åº¦å„8-10ä¸ªæ¸¸æˆï¼‰
- æŒ‰éš¾åº¦åˆ†çº§ï¼ˆç®€å•ã€ä¸­ç­‰ã€å›°éš¾ï¼‰

**é‡è¡¨çŸ¥è¯†åº“**ï¼ˆ3å¥—é‡è¡¨ï¼‰
- CARS-2å®Œæ•´é¢˜ç›®å’Œè¯„åˆ†æ ‡å‡†
- ADOS-2å®Œæ•´é¢˜ç›®å’Œè¯„åˆ†æ ‡å‡†
- ATECå®Œæ•´é¢˜ç›®å’Œè¯„åˆ†æ ‡å‡†

#### çŸ¥è¯†åº“æ›´æ–°ç­–ç•¥

**é™æ€çŸ¥è¯†**ï¼ˆæ–¹æ³•è®ºã€é‡è¡¨ï¼‰
- åˆå§‹åŒ–æ—¶ä¸€æ¬¡æ€§å¯¼å…¥
- å®šæœŸäººå·¥å®¡æ ¸å’Œæ›´æ–°
- ç‰ˆæœ¬æ§åˆ¶

**åŠ¨æ€çŸ¥è¯†**ï¼ˆæ¸¸æˆã€æ¡ˆä¾‹ï¼‰
- åˆå§‹åŒ–æ—¶å¯¼å…¥åŸºç¡€æ¸¸æˆ
- åæœŸå¯æŒç»­æ·»åŠ æ–°æ¸¸æˆ
- å¯æ ¹æ®ä½¿ç”¨åé¦ˆä¼˜åŒ–æ¸¸æˆæè¿°

---

### 6.1 æ¨¡å—åŒ–ä¼˜åŠ¿

1. **æ¸…æ™°çš„èŒè´£åˆ’åˆ†**: æ¯ä¸ªæ¨¡å—èŒè´£å•ä¸€ï¼Œè¾¹ç•Œæ¸…æ™°
2. **è§£è€¦åˆ**: æ¨¡å—é—´é€šè¿‡æ¥å£é€šä¿¡ï¼Œä¾èµ–å…³ç³»æ˜ç¡®
3. **å¯å¹¶è¡Œå¼€å‘**: åŒå±‚æ¨¡å—å¯ä»¥å¹¶è¡Œå¼€å‘ï¼ŒåŠ å¿«è¿›åº¦
4. **æ˜“äºæµ‹è¯•**: æ¯ä¸ªæ¨¡å—å¯ä»¥ç‹¬ç«‹æµ‹è¯•
5. **æ˜“äºç»´æŠ¤**: æ¨¡å—è¾¹ç•Œæ¸…æ™°ï¼Œä¾¿äºåç»­è¿­ä»£
6. **æ˜“äºé›†æˆ**: æ‰€æœ‰æ¨¡å—æœ€ç»ˆé›†æˆåˆ°LangGraphæ¡†æ¶

### 6.2 å¼€å‘å»ºè®®ï¼ˆé¢å‘æ¥å£ï¼‰

1. **æ¥å£å…ˆè¡Œ**: ç¬¬1å‘¨å°±å®šä¹‰å¥½æ‰€æœ‰æ¥å£ï¼Œä¸è¦è¾¹å¼€å‘è¾¹å®šä¹‰
2. **Mockå¿«é€ŸéªŒè¯**: ç”¨Mockå¿«é€Ÿè·‘é€šæµç¨‹ï¼ŒéªŒè¯æ¶æ„è®¾è®¡
3. **æ¸è¿›å¼æ›¿æ¢**: ä¸€ä¸ªä¸ªæ›¿æ¢çœŸå®å®ç°ï¼Œä¸è¦ä¸€æ¬¡æ€§å…¨æ¢
4. **æŒç»­é›†æˆ**: æ¯æ›¿æ¢ä¸€ä¸ªæ¨¡å—å°±æµ‹è¯•ï¼Œç¡®ä¿ç³»ç»Ÿå¯è¿è¡Œ
5. **çµæ´»é…ç½®**: é€šè¿‡ç¯å¢ƒå˜é‡æ§åˆ¶ä½¿ç”¨Mockè¿˜æ˜¯çœŸå®
6. **å¹¶è¡Œå¼€å‘**: æ¡†æ¶ç»„å’Œæ¨¡å—ç»„å¯ä»¥å¹¶è¡Œå·¥ä½œ

### 6.3 é£é™©æ§åˆ¶ï¼ˆé¢å‘æ¥å£ï¼‰

1. **æŠ€æœ¯éªŒè¯**: å¯¹Graphitiã€è§†é¢‘åˆ†æç­‰æ–°æŠ€æœ¯æå‰éªŒè¯ï¼ˆå¯ä»¥å…ˆMockï¼‰
2. **éšæ—¶å›é€€**: å¦‚æœçœŸå®å®ç°æœ‰é—®é¢˜ï¼Œå¯ä»¥ç«‹å³å›é€€åˆ°Mock
3. **å®šæœŸReview**: æ¯å‘¨Reviewè¿›åº¦ï¼Œæ£€æŸ¥Mockæ›¿æ¢æƒ…å†µ
4. **åŠæ—¶æ²Ÿé€š**: æ¥å£å®šä¹‰éœ€è¦å›¢é˜Ÿå…±è¯†ï¼ŒåŠæ—¶æ²Ÿé€šè°ƒæ•´

### 6.4 å…³é”®è®¾è®¡åŸåˆ™ï¼ˆé¢å‘æ¥å£ï¼‰

1. **ä¾èµ–æ¥å£ä¸ä¾èµ–å®ç°**: LangGraphèŠ‚ç‚¹åªè°ƒç”¨æ¥å£
2. **ä¾èµ–æ³¨å…¥**: é€šè¿‡å®¹å™¨ç®¡ç†æœåŠ¡å®ä¾‹
3. **é…ç½®é©±åŠ¨**: é€šè¿‡é…ç½®åˆ‡æ¢Mock/çœŸå®
4. **Mockæ•°æ®çœŸå®**: Mockè¿”å›çš„æ•°æ®ç»“æ„è¦å’ŒçœŸå®ä¸€è‡´
5. **æ¥å£ç¨³å®š**: æ¥å£ä¸€æ—¦å®šä¹‰ï¼Œå°½é‡ä¸è¦ä¿®æ”¹

---

**æ–‡æ¡£ç»“æŸ**
