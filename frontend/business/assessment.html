<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>初始评估服务 - 测试页面</title>
    <link rel="stylesheet" href="../common/styles.css">
</head>
<body>
    <div class="header">
        <div class="container">
            <a href="../index.html" class="back-link">← 返回导航</a>
            <h1>初始评估服务</h1>
            <div class="subtitle">构建孩子画像,创建观察框架 | 模块 7</div>
        </div>
    </div>

    <div class="container">
        <!-- 接口 1: 构建孩子画像 -->
        <div class="card">
            <div class="card-header">1. 构建孩子画像</div>
            <div class="card-description">根据解析后的评估数据构建孩子的综合画像</div>

            <form id="form-build-portrait">
                <div class="form-group">
                    <label class="form-label">解析后的数据 (JSON) *</label>
                    <textarea class="form-textarea" name="parsed_data" rows="15" placeholder='输入 JSON 格式的解析数据' required></textarea>
                    <div class="form-hint">包含孩子的基本信息、诊断信息、能力评估等</div>
                </div>

                <div class="btn-group">
                    <button type="button" class="btn btn-primary" onclick="testBuildPortrait()">执行请求</button>
                    <button type="button" class="btn btn-secondary" onclick="fillExampleBuildPortrait()">填充示例</button>
                    <button type="reset" class="btn btn-secondary">清空</button>
                </div>
            </form>

            <div id="request-build-portrait"></div>
            <div id="response-build-portrait"></div>
        </div>

        <!-- 接口 2: 创建观察框架 -->
        <div class="card">
            <div class="card-header">2. 创建观察框架</div>
            <div class="card-description">基于孩子画像创建个性化的观察框架</div>

            <form id="form-create-framework">
                <div class="form-group">
                    <label class="form-label">孩子画像 (JSON) *</label>
                    <textarea class="form-textarea" name="portrait" rows="12" placeholder='输入 JSON 格式的孩子画像数据' required></textarea>
                    <div class="form-hint">使用构建画像接口返回的数据</div>
                </div>

                <div class="btn-group">
                    <button type="button" class="btn btn-primary" onclick="testCreateFramework()">执行请求</button>
                    <button type="button" class="btn btn-secondary" onclick="fillExampleCreateFramework()">填充示例</button>
                    <button type="reset" class="btn btn-secondary">清空</button>
                </div>
            </form>

            <div id="request-create-framework"></div>
            <div id="response-create-framework"></div>
        </div>
    </div>

    <script src="../common/api-client.js"></script>
    <script>
        // 示例数据
        const examples = {
            buildPortrait: {
                parsed_data: {
                    child_id: "child-001",
                    basic_info: {
                        name: "辰辰",
                        age: 36,
                        gender: "男",
                        birth_date: "2023-01-15"
                    },
                    diagnosis: {
                        type: "ASD",
                        severity: "轻度",
                        diagnosis_date: "2024-06-15",
                        diagnosing_institution: "XX儿童医院"
                    },
                    ability_assessment: {
                        eye_contact: 5.0,
                        joint_attention: 4.5,
                        imitation: 4.0,
                        emotion_understanding: 3.5,
                        social_interaction: 4.0,
                        language_expression: 5.5,
                        language_comprehension: 6.0
                    },
                    behavioral_characteristics: {
                        interests: ["旋转物体", "水流", "积木"],
                        strengths: ["专注力好", "记忆力强", "视觉能力优秀"],
                        challenges: ["主动社交困难", "情绪表达单一", "共同注意力弱"],
                        sensory_sensitivities: ["对突然的噪音敏感", "喜欢触摸柔软物品"]
                    },
                    family_context: {
                        primary_caregiver: "妈妈",
                        caregiver_availability: "全天",
                        home_environment: "安静,有独立游戏空间",
                        family_goals: "提高孩子的社交互动能力"
                    }
                }
            },
            createFramework: {
                portrait: {
                    child_id: "child-001",
                    name: "辰辰",
                    age: 36,
                    key_dimensions: [
                        {
                            dimension: "eye_contact",
                            current_level: 5.0,
                            target_level: 6.5,
                            priority: "high"
                        },
                        {
                            dimension: "joint_attention",
                            current_level: 4.5,
                            target_level: 6.0,
                            priority: "high"
                        },
                        {
                            dimension: "social_interaction",
                            current_level: 4.0,
                            target_level: 5.5,
                            priority: "medium"
                        }
                    ],
                    strengths: ["专注力好", "记忆力强"],
                    challenges: ["主动社交困难", "情绪表达单一"],
                    interests: ["旋转物体", "水流", "积木"]
                }
            }
        };

        // 测试函数
        async function testBuildPortrait() {
            const formData = getFormData('form-build-portrait');
            const data = { parsed_data: formData.parsed_data };
            displayRequest('request-build-portrait', '/api/business/assessment/build-portrait', data);
            showLoading('response-build-portrait');
            const response = await apiClient.post('/api/business/assessment/build-portrait', data);
            displayResponse('response-build-portrait', response);
        }

        async function testCreateFramework() {
            const formData = getFormData('form-create-framework');
            const data = { portrait: formData.portrait };
            displayRequest('request-create-framework', '/api/business/assessment/create-observation-framework', data);
            showLoading('response-create-framework');
            const response = await apiClient.post('/api/business/assessment/create-observation-framework', data);
            displayResponse('response-create-framework', response);
        }

        // 填充示例函数
        function fillExampleBuildPortrait() {
            document.querySelector('#form-build-portrait [name="parsed_data"]').value = JSON.stringify(examples.buildPortrait.parsed_data, null, 2);
        }

        function fillExampleCreateFramework() {
            document.querySelector('#form-create-framework [name="portrait"]').value = JSON.stringify(examples.createFramework.portrait, null, 2);
        }
    </script>
</body>
</html>
