<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>对话助手服务 - 测试页面</title>
    <link rel="stylesheet" href="../common/styles.css">
</head>
<body>
    <div class="header">
        <div class="container">
            <a href="../index.html" class="back-link">← 返回导航</a>
            <h1>对话助手服务</h1>
            <div class="subtitle">智能对话和查询路由 | 模块 15</div>
        </div>
    </div>

    <div class="container">
        <!-- 接口 1: 对话 -->
        <div class="card">
            <div class="card-header">1. 对话</div>
            <div class="card-description">与AI助手进行智能对话,获取个性化建议和解答</div>

            <form id="form-chat">
                <div class="form-group">
                    <label class="form-label">孩子 ID *</label>
                    <input type="text" class="form-input" name="child_id" placeholder="例如: child-001" required>
                </div>

                <div class="form-group">
                    <label class="form-label">用户消息 *</label>
                    <textarea class="form-textarea" name="user_message" rows="3" placeholder='输入您的问题或消息' required></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label">对话历史 (JSON) *</label>
                    <textarea class="form-textarea" name="conversation_history" rows="8" placeholder='输入 JSON 格式的对话历史' required></textarea>
                    <div class="form-hint">包含之前的对话记录,用于保持上下文</div>
                </div>

                <div class="btn-group">
                    <button type="button" class="btn btn-primary" onclick="testChat()">执行请求</button>
                    <button type="button" class="btn btn-secondary" onclick="fillExampleChat()">填充示例</button>
                    <button type="reset" class="btn btn-secondary">清空</button>
                </div>
            </form>

            <div id="request-chat"></div>
            <div id="response-chat"></div>
        </div>

        <!-- 接口 2: 路由查询 -->
        <div class="card">
            <div class="card-header">2. 路由查询</div>
            <div class="card-description">判断用户查询的类型,以便正确路由到相应处理模块</div>

            <form id="form-route-query">
                <div class="form-group">
                    <label class="form-label">查询内容 *</label>
                    <textarea class="form-textarea" name="query" rows="3" placeholder='输入需要路由的查询内容' required></textarea>
                    <div class="form-hint">系统会自动判断查询类型(数据查询、建议请求、通用问答等)</div>
                </div>

                <div class="btn-group">
                    <button type="button" class="btn btn-primary" onclick="testRouteQuery()">执行请求</button>
                    <button type="button" class="btn btn-secondary" onclick="fillExampleRouteQuery()">填充示例</button>
                    <button type="reset" class="btn btn-secondary">清空</button>
                </div>
            </form>

            <div id="request-route-query"></div>
            <div id="response-route-query"></div>
        </div>
    </div>

    <script src="../common/api-client.js"></script>
    <script>
        // 示例数据
        const examples = {
            chat: {
                child_id: "child-001",
                user_message: "辰辰最近在眼神接触方面有什么进步吗?",
                conversation_history: [
                    {
                        role: "user",
                        content: "你好,我想了解一下辰辰的干预进展",
                        timestamp: "2026-01-27T10:00:00Z"
                    },
                    {
                        role: "assistant",
                        content: "您好!辰辰目前已经完成了12周的干预,整体表现很好。眼神接触和共同注意力都有明显进步。您想了解哪方面的具体情况呢?",
                        timestamp: "2026-01-27T10:00:05Z"
                    }
                ]
            },
            routeQuery: {
                query: "辰辰上周的训练数据是什么?"
            }
        };

        // 预设更多查询示例
        const queryExamples = [
            "辰辰上周的训练数据是什么?",
            "如何帮助孩子提高眼神接触?",
            "ASD干预的基本原则有哪些?",
            "辰辰的进步趋势如何?",
            "在家如何进行共同注意力训练?",
            "孩子不愿意配合时该怎么办?"
        ];

        // 测试函数
        async function testChat() {
            const formData = getFormData('form-chat');
            const data = {
                child_id: formData.child_id,
                user_message: formData.user_message,
                conversation_history: formData.conversation_history
            };
            displayRequest('request-chat', '/api/business/chat-assistant/chat', data);
            showLoading('response-chat');
            const response = await apiClient.post('/api/business/chat-assistant/chat', data);
            displayResponse('response-chat', response);
        }

        async function testRouteQuery() {
            const data = getFormData('form-route-query');
            displayRequest('request-route-query', '/api/business/chat-assistant/route-query', data);
            showLoading('response-route-query');
            const response = await apiClient.post('/api/business/chat-assistant/route-query', data);
            displayResponse('response-route-query', response);
        }

        // 填充示例函数
        function fillExampleChat() {
            document.querySelector('#form-chat [name="child_id"]').value = examples.chat.child_id;
            document.querySelector('#form-chat [name="user_message"]').value = examples.chat.user_message;
            document.querySelector('#form-chat [name="conversation_history"]').value = JSON.stringify(examples.chat.conversation_history, null, 2);
        }

        function fillExampleRouteQuery() {
            // 随机选择一个查询示例
            const randomQuery = queryExamples[Math.floor(Math.random() * queryExamples.length)];
            document.querySelector('#form-route-query [name="query"]').value = randomQuery;
        }
    </script>
</body>
</html>
