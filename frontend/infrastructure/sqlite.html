<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SQLite æ•°æ®ç®¡ç†æœåŠ¡ - æµ‹è¯•é¡µé¢</title>
    <link rel="stylesheet" href="../common/styles.css">
</head>
<body>
    <div class="header">
        <div class="container">
            <a href="../index.html" class="back-link">â† è¿”å›å¯¼èˆª</a>
            <h1>ğŸ“Š SQLite æ•°æ®ç®¡ç†æœåŠ¡</h1>
            <div class="subtitle">å­©å­æ¡£æ¡ˆã€ä¼šè¯è®°å½•ã€å‘¨è®¡åˆ’ã€è§‚å¯Ÿè®°å½•çš„æŒä¹…åŒ–å­˜å‚¨ | æ¨¡å— 1</div>
        </div>
    </div>

    <div class="container">
        <!-- æ¥å£ 1: è·å–å­©å­æ¡£æ¡ˆ -->
        <div class="card">
            <div class="card-header">1. è·å–å­©å­æ¡£æ¡ˆ</div>
            <div class="card-description">æ ¹æ®å­©å­IDè·å–å®Œæ•´çš„æ¡£æ¡ˆä¿¡æ¯</div>

            <form id="form-get-child">
                <div class="form-group">
                    <label class="form-label">å­©å­ ID *</label>
                    <input type="text" class="form-input" name="child_id" placeholder="ä¾‹å¦‚: child-001" required>
                    <div class="form-hint">è¾“å…¥å­©å­çš„å”¯ä¸€æ ‡è¯†ç¬¦</div>
                </div>

                <div class="btn-group">
                    <button type="button" class="btn btn-primary" onclick="testGetChild()">æ‰§è¡Œè¯·æ±‚</button>
                    <button type="button" class="btn btn-secondary" onclick="fillExampleGetChild()">å¡«å……ç¤ºä¾‹</button>
                    <button type="reset" class="btn btn-secondary">æ¸…ç©º</button>
                </div>
            </form>

            <div id="request-get-child"></div>
            <div id="response-get-child"></div>
        </div>

        <!-- æ¥å£ 2: ä¿å­˜å­©å­æ¡£æ¡ˆ -->
        <div class="card">
            <div class="card-header">2. ä¿å­˜å­©å­æ¡£æ¡ˆ</div>
            <div class="card-description">åˆ›å»ºæˆ–æ›´æ–°å­©å­çš„æ¡£æ¡ˆä¿¡æ¯</div>

            <form id="form-save-child">
                <div class="form-group">
                    <label class="form-label">æ¡£æ¡ˆæ•°æ® (JSON) *</label>
                    <textarea class="form-textarea" name="profile" rows="10" placeholder='è¾“å…¥ JSON æ ¼å¼çš„æ¡£æ¡ˆæ•°æ®' required></textarea>
                    <div class="form-hint">å¿…é¡»åŒ…å« child_id å­—æ®µ</div>
                </div>

                <div class="btn-group">
                    <button type="button" class="btn btn-primary" onclick="testSaveChild()">æ‰§è¡Œè¯·æ±‚</button>
                    <button type="button" class="btn btn-secondary" onclick="fillExampleSaveChild()">å¡«å……ç¤ºä¾‹</button>
                    <button type="reset" class="btn btn-secondary">æ¸…ç©º</button>
                </div>
            </form>

            <div id="request-save-child"></div>
            <div id="response-save-child"></div>
        </div>

        <!-- æ¥å£ 3: åˆ›å»ºä¼šè¯ -->
        <div class="card">
            <div class="card-header">3. åˆ›å»ºå¹²é¢„ä¼šè¯</div>
            <div class="card-description">ä¸ºå­©å­åˆ›å»ºä¸€ä¸ªæ–°çš„å¹²é¢„ä¼šè¯</div>

            <form id="form-create-session">
                <div class="form-group">
                    <label class="form-label">å­©å­ ID *</label>
                    <input type="text" class="form-input" name="child_id" placeholder="ä¾‹å¦‚: child-001" required>
                </div>

                <div class="form-group">
                    <label class="form-label">æ¸¸æˆ ID *</label>
                    <input type="text" class="form-input" name="game_id" placeholder="ä¾‹å¦‚: game-001" required>
                </div>

                <div class="btn-group">
                    <button type="button" class="btn btn-primary" onclick="testCreateSession()">æ‰§è¡Œè¯·æ±‚</button>
                    <button type="button" class="btn btn-secondary" onclick="fillExampleCreateSession()">å¡«å……ç¤ºä¾‹</button>
                    <button type="reset" class="btn btn-secondary">æ¸…ç©º</button>
                </div>
            </form>

            <div id="request-create-session"></div>
            <div id="response-create-session"></div>
        </div>

        <!-- æ¥å£ 4: è·å–ä¼šè¯ä¿¡æ¯ -->
        <div class="card">
            <div class="card-header">4. è·å–ä¼šè¯ä¿¡æ¯</div>
            <div class="card-description">æ ¹æ®ä¼šè¯IDè·å–ä¼šè¯è¯¦ç»†ä¿¡æ¯</div>

            <form id="form-get-session">
                <div class="form-group">
                    <label class="form-label">ä¼šè¯ ID *</label>
                    <input type="text" class="form-input" name="session_id" placeholder="ä¾‹å¦‚: session-abc123" required>
                </div>

                <div class="btn-group">
                    <button type="button" class="btn btn-primary" onclick="testGetSession()">æ‰§è¡Œè¯·æ±‚</button>
                    <button type="button" class="btn btn-secondary" onclick="fillExampleGetSession()">å¡«å……ç¤ºä¾‹</button>
                    <button type="reset" class="btn btn-secondary">æ¸…ç©º</button>
                </div>
            </form>

            <div id="request-get-session"></div>
            <div id="response-get-session"></div>
        </div>

        <!-- æ¥å£ 5: æ›´æ–°ä¼šè¯ä¿¡æ¯ -->
        <div class="card">
            <div class="card-header">5. æ›´æ–°ä¼šè¯ä¿¡æ¯</div>
            <div class="card-description">æ›´æ–°ä¼šè¯çš„çŠ¶æ€å’Œæ•°æ®</div>

            <form id="form-update-session">
                <div class="form-group">
                    <label class="form-label">ä¼šè¯ ID *</label>
                    <input type="text" class="form-input" name="session_id" placeholder="ä¾‹å¦‚: session-abc123" required>
                </div>

                <div class="form-group">
                    <label class="form-label">æ›´æ–°æ•°æ® (JSON) *</label>
                    <textarea class="form-textarea" name="data" rows="8" placeholder='è¾“å…¥è¦æ›´æ–°çš„æ•°æ®' required></textarea>
                </div>

                <div class="btn-group">
                    <button type="button" class="btn btn-primary" onclick="testUpdateSession()">æ‰§è¡Œè¯·æ±‚</button>
                    <button type="button" class="btn btn-secondary" onclick="fillExampleUpdateSession()">å¡«å……ç¤ºä¾‹</button>
                    <button type="reset" class="btn btn-secondary">æ¸…ç©º</button>
                </div>
            </form>

            <div id="request-update-session"></div>
            <div id="response-update-session"></div>
        </div>

        <!-- æ¥å£ 6: ä¿å­˜å‘¨è®¡åˆ’ -->
        <div class="card">
            <div class="card-header">6. ä¿å­˜å‘¨è®¡åˆ’</div>
            <div class="card-description">ä¿å­˜å­©å­çš„å‘¨å¹²é¢„è®¡åˆ’</div>

            <form id="form-save-weekly-plan">
                <div class="form-group">
                    <label class="form-label">å‘¨è®¡åˆ’æ•°æ® (JSON) *</label>
                    <textarea class="form-textarea" name="plan" rows="10" placeholder='è¾“å…¥ JSON æ ¼å¼çš„å‘¨è®¡åˆ’æ•°æ®' required></textarea>
                </div>

                <div class="btn-group">
                    <button type="button" class="btn btn-primary" onclick="testSaveWeeklyPlan()">æ‰§è¡Œè¯·æ±‚</button>
                    <button type="button" class="btn btn-secondary" onclick="fillExampleSaveWeeklyPlan()">å¡«å……ç¤ºä¾‹</button>
                    <button type="reset" class="btn btn-secondary">æ¸…ç©º</button>
                </div>
            </form>

            <div id="request-save-weekly-plan"></div>
            <div id="response-save-weekly-plan"></div>
        </div>

        <!-- æ¥å£ 7: è·å–å‘¨è®¡åˆ’ -->
        <div class="card">
            <div class="card-header">7. è·å–å‘¨è®¡åˆ’</div>
            <div class="card-description">æ ¹æ®è®¡åˆ’IDè·å–å‘¨è®¡åˆ’è¯¦æƒ…</div>

            <form id="form-get-weekly-plan">
                <div class="form-group">
                    <label class="form-label">è®¡åˆ’ ID *</label>
                    <input type="text" class="form-input" name="plan_id" placeholder="ä¾‹å¦‚: plan-xyz789" required>
                </div>

                <div class="btn-group">
                    <button type="button" class="btn btn-primary" onclick="testGetWeeklyPlan()">æ‰§è¡Œè¯·æ±‚</button>
                    <button type="button" class="btn btn-secondary" onclick="fillExampleGetWeeklyPlan()">å¡«å……ç¤ºä¾‹</button>
                    <button type="reset" class="btn btn-secondary">æ¸…ç©º</button>
                </div>
            </form>

            <div id="request-get-weekly-plan"></div>
            <div id="response-get-weekly-plan"></div>
        </div>

        <!-- æ¥å£ 8: ä¿å­˜è§‚å¯Ÿè®°å½• -->
        <div class="card">
            <div class="card-header">8. ä¿å­˜è§‚å¯Ÿè®°å½•</div>
            <div class="card-description">ä¿å­˜ä¼šè¯ä¸­çš„è§‚å¯Ÿè®°å½•</div>

            <form id="form-save-observation">
                <div class="form-group">
                    <label class="form-label">è§‚å¯Ÿè®°å½• (JSON) *</label>
                    <textarea class="form-textarea" name="observation" rows="10" placeholder='è¾“å…¥ JSON æ ¼å¼çš„è§‚å¯Ÿè®°å½•' required></textarea>
                </div>

                <div class="btn-group">
                    <button type="button" class="btn btn-primary" onclick="testSaveObservation()">æ‰§è¡Œè¯·æ±‚</button>
                    <button type="button" class="btn btn-secondary" onclick="fillExampleSaveObservation()">å¡«å……ç¤ºä¾‹</button>
                    <button type="reset" class="btn btn-secondary">æ¸…ç©º</button>
                </div>
            </form>

            <div id="request-save-observation"></div>
            <div id="response-save-observation"></div>
        </div>

        <!-- æ¥å£ 9: è·å–ä¼šè¯å†å² -->
        <div class="card">
            <div class="card-header">9. è·å–ä¼šè¯å†å²</div>
            <div class="card-description">è·å–å­©å­çš„å†å²ä¼šè¯è®°å½•</div>

            <form id="form-get-session-history">
                <div class="form-group">
                    <label class="form-label">å­©å­ ID *</label>
                    <input type="text" class="form-input" name="child_id" placeholder="ä¾‹å¦‚: child-001" required>
                </div>

                <div class="form-group">
                    <label class="form-label">æ•°é‡é™åˆ¶</label>
                    <input type="number" class="form-input" name="limit" placeholder="é»˜è®¤: 10" value="10">
                </div>

                <div class="btn-group">
                    <button type="button" class="btn btn-primary" onclick="testGetSessionHistory()">æ‰§è¡Œè¯·æ±‚</button>
                    <button type="button" class="btn btn-secondary" onclick="fillExampleGetSessionHistory()">å¡«å……ç¤ºä¾‹</button>
                    <button type="reset" class="btn btn-secondary">æ¸…ç©º</button>
                </div>
            </form>

            <div id="request-get-session-history"></div>
            <div id="response-get-session-history"></div>
        </div>
    </div>

    <script src="../common/api-client.js"></script>
    <script>
        // ç¤ºä¾‹æ•°æ®
        const examples = {
            getChild: { child_id: "child-001" },
            saveChild: {
                profile: {
                    child_id: "child-001",
                    name: "è¾°è¾°",
                    age: 36,
                    gender: "ç”·",
                    birth_date: "2023-01-15",
                    diagnosis: "ASDè½»åº¦",
                    eye_contact: 5.0,
                    joint_attention: 4.5,
                    interests: ["æ—‹è½¬ç‰©ä½“", "æ°´æµ", "ç§¯æœ¨"],
                    strengths: ["ä¸“æ³¨åŠ›å¥½", "è®°å¿†åŠ›å¼º"]
                }
            },
            createSession: {
                child_id: "child-001",
                game_id: "game-001"
            },
            getSession: { session_id: "session-abc123" },
            updateSession: {
                session_id: "session-abc123",
                data: {
                    status: "in_progress",
                    quick_observations: [
                        { type: "smile", timestamp: new Date().toISOString() }
                    ]
                }
            },
            saveWeeklyPlan: {
                plan: {
                    child_id: "child-001",
                    week_start: "2026-01-27",
                    week_end: "2026-02-02",
                    weekly_goal: "æå‡çœ¼ç¥æ¥è§¦é¢‘ç‡å’Œæ—¶é•¿",
                    priority_dimensions: ["eye_contact", "joint_attention"],
                    daily_plans: [
                        {
                            day: 1,
                            game_id: "game-001",
                            focus: "çœ¼ç¥æ¥è§¦"
                        }
                    ]
                }
            },
            getWeeklyPlan: { plan_id: "plan-xyz789" },
            saveObservation: {
                observation: {
                    session_id: "session-abc123",
                    child_id: "child-001",
                    observation_type: "quick",
                    timestamp: new Date().toISOString(),
                    content: "å­©å­ä¸»åŠ¨ä¸å®¶é•¿çœ¼ç¥æ¥è§¦ï¼ŒæŒç»­çº¦2ç§’"
                }
            },
            getSessionHistory: { child_id: "child-001" }
        };

        // æµ‹è¯•å‡½æ•°
        async function testGetChild() {
            const data = getFormData('form-get-child');
            displayRequest('request-get-child', '/api/infrastructure/sqlite/get-child', data);
            showLoading('response-get-child');
            const response = await apiClient.post('/api/infrastructure/sqlite/get-child', data);
            displayResponse('response-get-child', response);
        }

        async function testSaveChild() {
            const formData = getFormData('form-save-child');
            const data = { profile: formData.profile };
            displayRequest('request-save-child', '/api/infrastructure/sqlite/save-child', data);
            showLoading('response-save-child');
            const response = await apiClient.post('/api/infrastructure/sqlite/save-child', data);
            displayResponse('response-save-child', response);
        }

        async function testCreateSession() {
            const data = getFormData('form-create-session');
            displayRequest('request-create-session', '/api/infrastructure/sqlite/create-session', data);
            showLoading('response-create-session');
            const response = await apiClient.post('/api/infrastructure/sqlite/create-session', data);
            displayResponse('response-create-session', response);
        }

        async function testGetSession() {
            const data = getFormData('form-get-session');
            displayRequest('request-get-session', '/api/infrastructure/sqlite/get-session', data);
            showLoading('response-get-session');
            const response = await apiClient.post('/api/infrastructure/sqlite/get-session', data);
            displayResponse('response-get-session', response);
        }

        async function testUpdateSession() {
            const formData = getFormData('form-update-session');
            const data = {
                session_id: formData.session_id,
                data: formData.data
            };
            displayRequest('request-update-session', '/api/infrastructure/sqlite/update-session', data);
            showLoading('response-update-session');
            const response = await apiClient.post('/api/infrastructure/sqlite/update-session', data);
            displayResponse('response-update-session', response);
        }

        async function testSaveWeeklyPlan() {
            const formData = getFormData('form-save-weekly-plan');
            const data = { plan: formData.plan };
            displayRequest('request-save-weekly-plan', '/api/infrastructure/sqlite/save-weekly-plan', data);
            showLoading('response-save-weekly-plan');
            const response = await apiClient.post('/api/infrastructure/sqlite/save-weekly-plan', data);
            displayResponse('response-save-weekly-plan', response);
        }

        async function testGetWeeklyPlan() {
            const data = getFormData('form-get-weekly-plan');
            displayRequest('request-get-weekly-plan', '/api/infrastructure/sqlite/get-weekly-plan', data);
            showLoading('response-get-weekly-plan');
            const response = await apiClient.post('/api/infrastructure/sqlite/get-weekly-plan', data);
            displayResponse('response-get-weekly-plan', response);
        }

        async function testSaveObservation() {
            const formData = getFormData('form-save-observation');
            const data = { observation: formData.observation };
            displayRequest('request-save-observation', '/api/infrastructure/sqlite/save-observation', data);
            showLoading('response-save-observation');
            const response = await apiClient.post('/api/infrastructure/sqlite/save-observation', data);
            displayResponse('response-save-observation', response);
        }

        async function testGetSessionHistory() {
            const formData = getFormData('form-get-session-history');
            const url = `/api/infrastructure/sqlite/session-history/${formData.child_id}?limit=${formData.limit || 10}`;
            displayRequest('request-get-session-history', url, {});
            showLoading('response-get-session-history');
            const response = await apiClient.get(url);
            displayResponse('response-get-session-history', response);
        }

        // å¡«å……ç¤ºä¾‹å‡½æ•°
        function fillExampleGetChild() { fillFormData('form-get-child', examples.getChild); }
        function fillExampleSaveChild() {
            document.querySelector('#form-save-child [name="profile"]').value = JSON.stringify(examples.saveChild.profile, null, 2);
        }
        function fillExampleCreateSession() { fillFormData('form-create-session', examples.createSession); }
        function fillExampleGetSession() { fillFormData('form-get-session', examples.getSession); }
        function fillExampleUpdateSession() {
            document.querySelector('#form-update-session [name="session_id"]').value = examples.updateSession.session_id;
            document.querySelector('#form-update-session [name="data"]').value = JSON.stringify(examples.updateSession.data, null, 2);
        }
        function fillExampleSaveWeeklyPlan() {
            document.querySelector('#form-save-weekly-plan [name="plan"]').value = JSON.stringify(examples.saveWeeklyPlan.plan, null, 2);
        }
        function fillExampleGetWeeklyPlan() { fillFormData('form-get-weekly-plan', examples.getWeeklyPlan); }
        function fillExampleSaveObservation() {
            document.querySelector('#form-save-observation [name="observation"]').value = JSON.stringify(examples.saveObservation.observation, null, 2);
        }
        function fillExampleGetSessionHistory() { fillFormData('form-get-session-history', examples.getSessionHistory); }
    </script>
</body>
</html>
