<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI 视频解析服务 - 测试页面</title>
    <link rel="stylesheet" href="../common/styles.css">
</head>
<body>
    <div class="header">
        <h1>AI 视频解析服务</h1>
        <p>多模态AI驱动的视频分析与关键片段提取</p>
        <a href="../index.html" class="back-link">← 返回首页</a>
    </div>

    <div class="container">
        <!-- 接口1: 分析视频 -->
        <div class="api-section">
            <h2>1. 分析视频</h2>
            <p class="description">分析干预会话视频，提取行为观察</p>

            <div class="form-group">
                <label>视频路径</label>
                <input type="text" id="analyze-video-path" placeholder="/path/to/video.mp4">
            </div>

            <div class="form-group">
                <label>上下文信息 (JSON)</label>
                <textarea id="analyze-context" rows="8" placeholder='{
  "child_id": "child_001",
  "session_id": "session_001",
  "game_id": "game_001",
  "focus_dimensions": ["attention", "interaction"]
}'></textarea>
            </div>

            <div class="button-group">
                <button onclick="analyzeVideo()">执行</button>
                <button onclick="fillAnalyzeExample()">填充示例</button>
                <button onclick="clearAnalyze()">清空</button>
            </div>

            <div id="analyze-result" class="result-container"></div>
        </div>

        <!-- 接口2: 提取关键片段 -->
        <div class="api-section">
            <h2>2. 提取关键片段</h2>
            <p class="description">根据分析结果提取关键时间段</p>

            <div class="form-group">
                <label>视频路径</label>
                <input type="text" id="extract-video-path" placeholder="/path/to/video.mp4">
            </div>

            <div class="form-group">
                <label>分析结果 (JSON)</label>
                <textarea id="extract-analysis-result" rows="10" placeholder='{
  "observations": [
    {
      "timestamp": "00:02:30",
      "type": "milestone",
      "description": "主动发起互动"
    },
    {
      "timestamp": "00:05:15",
      "type": "challenge",
      "description": "注意力分散"
    }
  ]
}'></textarea>
            </div>

            <div class="button-group">
                <button onclick="extractHighlights()">执行</button>
                <button onclick="fillExtractExample()">填充示例</button>
                <button onclick="clearExtract()">清空</button>
            </div>

            <div id="extract-result" class="result-container"></div>
        </div>
    </div>

    <script src="../common/api-client.js"></script>
    <script>
        const client = new APIClient();

        // 接口1: 分析视频
        async function analyzeVideo() {
            const data = {
                video_path: document.getElementById('analyze-video-path').value,
                context: JSON.parse(document.getElementById('analyze-context').value || '{}')
            };
            await client.post('/api/infrastructure/video-analysis/analyze-video', data, 'analyze-result');
        }

        function fillAnalyzeExample() {
            document.getElementById('analyze-video-path').value = '/videos/session_001.mp4';
            document.getElementById('analyze-context').value = `{
  "child_id": "child_001",
  "session_id": "session_001",
  "game_id": "game_building_blocks",
  "focus_dimensions": ["attention", "interaction", "emotion"],
  "observation_framework": {
    "attention": ["主动注意", "注意持续时长", "视线跟随"],
    "interaction": ["互动回应", "主动发起", "共同关注"],
    "emotion": ["情绪表达", "情绪调节"]
  }
}`;
        }

        function clearAnalyze() {
            document.getElementById('analyze-video-path').value = '';
            document.getElementById('analyze-context').value = '';
            document.getElementById('analyze-result').innerHTML = '';
        }

        // 接口2: 提取关键片段
        async function extractHighlights() {
            const data = {
                video_path: document.getElementById('extract-video-path').value,
                analysis_result: JSON.parse(document.getElementById('extract-analysis-result').value || '{}')
            };
            await client.post('/api/infrastructure/video-analysis/extract-highlights', data, 'extract-result');
        }

        function fillExtractExample() {
            document.getElementById('extract-video-path').value = '/videos/session_001.mp4';
            document.getElementById('extract-analysis-result').value = `{
  "observations": [
    {
      "timestamp": "00:02:30",
      "type": "milestone",
      "dimension": "interaction",
      "description": "主动发起互动，拉起家长的手指向积木",
      "importance": "high"
    },
    {
      "timestamp": "00:05:15",
      "type": "challenge",
      "dimension": "attention",
      "description": "注意力分散，开始环顾四周",
      "importance": "medium"
    },
    {
      "timestamp": "00:08:45",
      "type": "progress",
      "dimension": "emotion",
      "description": "成功完成任务后露出笑容",
      "importance": "high"
    }
  ]
}`;
        }

        function clearExtract() {
            document.getElementById('extract-video-path').value = '';
            document.getElementById('extract-analysis-result').value = '';
            document.getElementById('extract-result').innerHTML = '';
        }
    </script>
</body>
</html>
