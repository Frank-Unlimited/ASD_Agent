<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>文档解析服务 - 测试页面</title>
    <link rel="stylesheet" href="../common/styles.css">
</head>
<body>
    <div class="header">
        <h1>文档解析服务</h1>
        <p>医院报告与量表数据解析</p>
        <a href="../index.html" class="back-link">← 返回首页</a>
    </div>

    <div class="container">
        <!-- 接口1: 解析医院报告 -->
        <div class="api-section">
            <h2>1. 解析医院报告</h2>
            <p class="description">解析诊断报告、评估报告等医疗文档</p>

            <div class="form-group">
                <label>文件路径</label>
                <input type="text" id="report-file-path" placeholder="/path/to/report.pdf">
            </div>

            <div class="form-group">
                <label>文件类型</label>
                <select id="report-file-type">
                    <option value="pdf">PDF</option>
                    <option value="image">图片</option>
                    <option value="docx">Word文档</option>
                </select>
            </div>

            <div class="button-group">
                <button onclick="parseReport()">执行</button>
                <button onclick="fillReportExample()">填充示例</button>
                <button onclick="clearReport()">清空</button>
            </div>

            <div id="report-result" class="result-container"></div>
        </div>

        <!-- 接口2: 解析量表数据 -->
        <div class="api-section">
            <h2>2. 解析量表数据</h2>
            <p class="description">解析评估量表（ABC、CARS等）</p>

            <div class="form-group">
                <label>量表类型</label>
                <select id="scale-type">
                    <option value="ABC">ABC量表</option>
                    <option value="CARS">CARS量表</option>
                    <option value="PEP-3">PEP-3量表</option>
                    <option value="ADOS">ADOS量表</option>
                </select>
            </div>

            <div class="form-group">
                <label>量表数据 (JSON)</label>
                <textarea id="scale-data" rows="12" placeholder='{
  "test_date": "2025-01-15",
  "tester": "张医生",
  "items": [
    {"item_id": 1, "score": 3, "notes": "..."},
    {"item_id": 2, "score": 2, "notes": "..."}
  ]
}'></textarea>
            </div>

            <div class="button-group">
                <button onclick="parseScale()">执行</button>
                <button onclick="fillScaleExample()">填充示例</button>
                <button onclick="clearScale()">清空</button>
            </div>

            <div id="scale-result" class="result-container"></div>
        </div>
    </div>

    <script src="../common/api-client.js"></script>
    <script>
        const client = new APIClient();

        // 接口1: 解析医院报告
        async function parseReport() {
            const data = {
                file_path: document.getElementById('report-file-path').value,
                file_type: document.getElementById('report-file-type').value
            };
            await client.post('/api/infrastructure/document-parser/parse-report', data, 'report-result');
        }

        function fillReportExample() {
            document.getElementById('report-file-path').value = '/documents/diagnosis_report_20250115.pdf';
            document.getElementById('report-file-type').value = 'pdf';
        }

        function clearReport() {
            document.getElementById('report-file-path').value = '';
            document.getElementById('report-file-type').value = 'pdf';
            document.getElementById('report-result').innerHTML = '';
        }

        // 接口2: 解析量表数据
        async function parseScale() {
            const data = {
                scale_data: JSON.parse(document.getElementById('scale-data').value || '{}'),
                scale_type: document.getElementById('scale-type').value
            };
            await client.post('/api/infrastructure/document-parser/parse-scale', data, 'scale-result');
        }

        function fillScaleExample() {
            document.getElementById('scale-type').value = 'ABC';
            document.getElementById('scale-data').value = `{
  "child_id": "child_001",
  "test_date": "2025-01-15",
  "tester": "张医生",
  "scale_type": "ABC",
  "items": [
    {
      "item_id": 1,
      "domain": "感觉",
      "description": "旋转物体",
      "score": 3,
      "notes": "经常旋转玩具车轮"
    },
    {
      "item_id": 2,
      "domain": "交往",
      "description": "视线接触",
      "score": 2,
      "notes": "偶尔有眼神接触"
    },
    {
      "item_id": 3,
      "domain": "语言",
      "description": "重复语言",
      "score": 2,
      "notes": "会重复简单词汇"
    },
    {
      "item_id": 4,
      "domain": "躯体运动",
      "description": "刻板动作",
      "score": 1,
      "notes": "偶尔拍手"
    }
  ],
  "total_score": 8,
  "severity_level": "轻度"
}`;
        }

        function clearScale() {
            document.getElementById('scale-type').value = 'ABC';
            document.getElementById('scale-data').value = '';
            document.getElementById('scale-result').innerHTML = '';
        }
    </script>
</body>
</html>
