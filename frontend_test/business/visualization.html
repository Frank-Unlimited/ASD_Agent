<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>可视化与报告服务 - 测试页面</title>
    <link rel="stylesheet" href="../common/styles.css">
</head>
<body>
    <div class="header">
        <div class="container">
            <a href="../index.html" class="back-link">← 返回导航</a>
            <h1>可视化与报告服务</h1>
            <div class="subtitle">生成雷达图、时间线、趋势图和报告 | 模块 16</div>
        </div>
    </div>

    <div class="container">
        <!-- 接口 1: 生成雷达图数据 -->
        <div class="card">
            <div class="card-header">1. 生成雷达图数据</div>
            <div class="card-description">生成孩子能力维度的雷达图可视化数据</div>

            <form id="form-radar-chart">
                <div class="form-group">
                    <label class="form-label">孩子 ID *</label>
                    <input type="text" class="form-input" name="child_id" placeholder="例如: child-001" required>
                </div>

                <div class="form-group">
                    <label class="form-label">指标数据 (JSON) *</label>
                    <textarea class="form-textarea" name="metrics" rows="8" placeholder='输入 JSON 格式的指标数据' required></textarea>
                </div>

                <div class="btn-group">
                    <button type="button" class="btn btn-primary" onclick="testRadarChart()">执行请求</button>
                    <button type="button" class="btn btn-secondary" onclick="fillExampleRadarChart()">填充示例</button>
                    <button type="reset" class="btn btn-secondary">清空</button>
                </div>
            </form>

            <div id="request-radar-chart"></div>
            <div id="response-radar-chart"></div>
        </div>

        <!-- 接口 2: 生成时间线数据 -->
        <div class="card">
            <div class="card-header">2. 生成时间线数据</div>
            <div class="card-description">生成孩子成长里程碑的时间线可视化数据</div>

            <form id="form-timeline">
                <div class="form-group">
                    <label class="form-label">孩子 ID *</label>
                    <input type="text" class="form-input" name="child_id" placeholder="例如: child-001" required>
                </div>

                <div class="form-group">
                    <label class="form-label">里程碑列表 (JSON) *</label>
                    <textarea class="form-textarea" name="milestones" rows="10" placeholder='输入 JSON 格式的里程碑数据' required></textarea>
                </div>

                <div class="btn-group">
                    <button type="button" class="btn btn-primary" onclick="testTimeline()">执行请求</button>
                    <button type="button" class="btn btn-secondary" onclick="fillExampleTimeline()">填充示例</button>
                    <button type="reset" class="btn btn-secondary">清空</button>
                </div>
            </form>

            <div id="request-timeline"></div>
            <div id="response-timeline"></div>
        </div>

        <!-- 接口 3: 生成趋势图数据 -->
        <div class="card">
            <div class="card-header">3. 生成趋势图数据</div>
            <div class="card-description">生成特定维度在时间范围内的趋势图数据</div>

            <form id="form-trend-chart">
                <div class="form-group">
                    <label class="form-label">孩子 ID *</label>
                    <input type="text" class="form-input" name="child_id" placeholder="例如: child-001" required>
                </div>

                <div class="form-group">
                    <label class="form-label">维度 *</label>
                    <select class="form-input" name="dimension" required>
                        <option value="">选择维度</option>
                        <option value="eye_contact">眼神接触</option>
                        <option value="joint_attention">共同注意</option>
                        <option value="imitation">模仿能力</option>
                        <option value="emotion_understanding">情绪理解</option>
                        <option value="social_interaction">社交互动</option>
                        <option value="language_expression">语言表达</option>
                        <option value="language_comprehension">语言理解</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">时间范围 *</label>
                    <select class="form-input" name="time_range" required>
                        <option value="">选择时间范围</option>
                        <option value="1week">最近1周</option>
                        <option value="1month">最近1月</option>
                        <option value="3months">最近3月</option>
                        <option value="6months">最近6月</option>
                        <option value="1year">最近1年</option>
                    </select>
                </div>

                <div class="btn-group">
                    <button type="button" class="btn btn-primary" onclick="testTrendChart()">执行请求</button>
                    <button type="button" class="btn btn-secondary" onclick="fillExampleTrendChart()">填充示例</button>
                    <button type="reset" class="btn btn-secondary">清空</button>
                </div>
            </form>

            <div id="request-trend-chart"></div>
            <div id="response-trend-chart"></div>
        </div>

        <!-- 接口 4: 生成家长版报告 -->
        <div class="card">
            <div class="card-header">4. 生成家长版报告</div>
            <div class="card-description">生成适合家长阅读的PDF报告</div>

            <form id="form-parent-report">
                <div class="form-group">
                    <label class="form-label">孩子 ID *</label>
                    <input type="text" class="form-input" name="child_id" placeholder="例如: child-001" required>
                </div>

                <div class="form-group">
                    <label class="form-label">时间范围 *</label>
                    <select class="form-input" name="time_range" required>
                        <option value="">选择时间范围</option>
                        <option value="1week">最近1周</option>
                        <option value="1month">最近1月</option>
                        <option value="3months">最近3月</option>
                        <option value="6months">最近6月</option>
                    </select>
                </div>

                <div class="btn-group">
                    <button type="button" class="btn btn-primary" onclick="testParentReport()">执行请求</button>
                    <button type="button" class="btn btn-secondary" onclick="fillExampleParentReport()">填充示例</button>
                    <button type="reset" class="btn btn-secondary">清空</button>
                </div>
            </form>

            <div id="request-parent-report"></div>
            <div id="response-parent-report"></div>
        </div>

        <!-- 接口 5: 生成医生版报告 -->
        <div class="card">
            <div class="card-header">5. 生成医生版报告</div>
            <div class="card-description">生成适合医疗专业人士的详细PDF报告</div>

            <form id="form-medical-report">
                <div class="form-group">
                    <label class="form-label">孩子 ID *</label>
                    <input type="text" class="form-input" name="child_id" placeholder="例如: child-001" required>
                </div>

                <div class="form-group">
                    <label class="form-label">时间范围 *</label>
                    <select class="form-input" name="time_range" required>
                        <option value="">选择时间范围</option>
                        <option value="1month">最近1月</option>
                        <option value="3months">最近3月</option>
                        <option value="6months">最近6月</option>
                        <option value="1year">最近1年</option>
                    </select>
                </div>

                <div class="btn-group">
                    <button type="button" class="btn btn-primary" onclick="testMedicalReport()">执行请求</button>
                    <button type="button" class="btn btn-secondary" onclick="fillExampleMedicalReport()">填充示例</button>
                    <button type="reset" class="btn btn-secondary">清空</button>
                </div>
            </form>

            <div id="request-medical-report"></div>
            <div id="response-medical-report"></div>
        </div>
    </div>

    <script src="../common/api-client.js"></script>
    <script>
        // 示例数据
        const examples = {
            radarChart: {
                child_id: "child-001",
                metrics: {
                    eye_contact: 5.8,
                    joint_attention: 5.2,
                    imitation: 4.5,
                    emotion_understanding: 4.0,
                    social_interaction: 4.3,
                    language_expression: 5.8,
                    language_comprehension: 6.3
                }
            },
            timeline: {
                child_id: "child-001",
                milestones: [
                    {
                        date: "2025-10-15",
                        title: "开始干预",
                        description: "首次评估,建立基线",
                        type: "start"
                    },
                    {
                        date: "2025-11-20",
                        title: "首次主动眼神接触",
                        description: "在游戏中主动寻求眼神交流",
                        type: "breakthrough"
                    },
                    {
                        date: "2025-12-10",
                        title: "开始模仿动作",
                        description: "成功模仿简单手势",
                        type: "skill_acquired"
                    },
                    {
                        date: "2026-01-05",
                        title: "语言能力提升",
                        description: "词汇量增加到50个",
                        type: "progress"
                    },
                    {
                        date: "2026-01-27",
                        title: "3个月再评估",
                        description: "多项指标显著改善",
                        type: "assessment"
                    }
                ]
            },
            trendChart: {
                child_id: "child-001",
                dimension: "eye_contact",
                time_range: "3months"
            },
            parentReport: {
                child_id: "child-001",
                time_range: "1month"
            },
            medicalReport: {
                child_id: "child-001",
                time_range: "3months"
            }
        };

        // 测试函数
        async function testRadarChart() {
            const formData = getFormData('form-radar-chart');
            const data = {
                child_id: formData.child_id,
                metrics: formData.metrics
            };
            displayRequest('request-radar-chart', '/api/business/visualization/generate-radar-chart', data);
            showLoading('response-radar-chart');
            const response = await apiClient.post('/api/business/visualization/generate-radar-chart', data);
            displayResponse('response-radar-chart', response);
        }

        async function testTimeline() {
            const formData = getFormData('form-timeline');
            const data = {
                child_id: formData.child_id,
                milestones: formData.milestones
            };
            displayRequest('request-timeline', '/api/business/visualization/generate-timeline', data);
            showLoading('response-timeline');
            const response = await apiClient.post('/api/business/visualization/generate-timeline', data);
            displayResponse('response-timeline', response);
        }

        async function testTrendChart() {
            const data = getFormData('form-trend-chart');
            displayRequest('request-trend-chart', '/api/business/visualization/generate-trend-chart', data);
            showLoading('response-trend-chart');
            const response = await apiClient.post('/api/business/visualization/generate-trend-chart', data);
            displayResponse('response-trend-chart', response);
        }

        async function testParentReport() {
            const data = getFormData('form-parent-report');
            displayRequest('request-parent-report', '/api/business/visualization/generate-parent-report', data);
            showLoading('response-parent-report');
            const response = await apiClient.post('/api/business/visualization/generate-parent-report', data);
            displayResponse('response-parent-report', response);
        }

        async function testMedicalReport() {
            const data = getFormData('form-medical-report');
            displayRequest('request-medical-report', '/api/business/visualization/generate-medical-report', data);
            showLoading('response-medical-report');
            const response = await apiClient.post('/api/business/visualization/generate-medical-report', data);
            displayResponse('response-medical-report', response);
        }

        // 填充示例函数
        function fillExampleRadarChart() {
            document.querySelector('#form-radar-chart [name="child_id"]').value = examples.radarChart.child_id;
            document.querySelector('#form-radar-chart [name="metrics"]').value = JSON.stringify(examples.radarChart.metrics, null, 2);
        }

        function fillExampleTimeline() {
            document.querySelector('#form-timeline [name="child_id"]').value = examples.timeline.child_id;
            document.querySelector('#form-timeline [name="milestones"]').value = JSON.stringify(examples.timeline.milestones, null, 2);
        }

        function fillExampleTrendChart() {
            fillFormData('form-trend-chart', examples.trendChart);
        }

        function fillExampleParentReport() {
            fillFormData('form-parent-report', examples.parentReport);
        }

        function fillExampleMedicalReport() {
            fillFormData('form-medical-report', examples.medicalReport);
        }
    </script>
</body>
</html>
